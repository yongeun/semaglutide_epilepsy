========= IPWT Analysis: GLP1 vs SGLT2 - Epilepsy/Seizure =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 7034 
Treatment distribution: 4922 2112 

Raw outcome variable ( epilepsy_or_seizure_start_date ) summary:
Total patients with outcome dates: 503 
Total patients without outcome dates: 6531 
Outcome date range: 6498 to 19631 
===========================

Before excluding pre-existing Epilepsy/Seizure patients: 7034 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Epilepsy/Seizure diagnosed BEFORE index date (excluding): 378 
Patients eligible for analysis: 6656 
=======================================
After excluding pre-existing Epilepsy/Seizure patients: 6656 (excluded: 378 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 125 
Treatment distribution after exclusion: 4660 1996 
Outcome date range after exclusion: 17701 to 19631 
Outcomes occurring AFTER index date: 123 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                6619                      5                 106.
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  6095                     31                 198.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 6656 
Patients with outcome dates: 125 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: epilepsy_or_seizure_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: FALSE 
- Input data rows: 6656 
- Patients with outcome dates: 125 
- Outcome date range: 17701 to 19631 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 5497 
- Raw events (before late-onset filter): 96 
- Events after time >= 0 filter: 96 
- Patients filtered out due to event_time < 0: 817 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2085 
- Mean event_time: 879.4891 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 18                                  96 
No event - administrative censoring 
                               5725 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 5839 
Patients with events (event = 1): 96 
Patients without events (event = 0): 5743 
Event distribution by treatment:
   
       0    1
  0 3985   81
  1 1758   15

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   559.0   833.0   879.5  1215.0  2085.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 96 
Final events: 96 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  4066     34.3   7.62       33.3          35
2         1  1773     37.7   8.25       36.4           2

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          15    294        926    1134      883       779   35
  1           0     40        249     444      453       585    2

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  4066       8.22     1.83          7.9           311
2         1  1773       7.67     1.87          7.3           123

Total sample size: 5839 
Total events: 96 

Index Year Distribution:

2018 2019 2020 2021 
 720 1279 1483 2357 
Note: Dropping 464 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          3725              35.5
2         1          1650              35.9

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 11 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        7.12       0.00261
 2         0 Normal           169.         0.0619 
 3         0 Overweight       558.         0.205  
 4         0 Obese I          723.         0.265  
 5         0 Obese II         605.         0.222  
 6         0 Obese III        663.         0.243  
 7         1 Normal            89.6        0.0338 
 8         1 Overweight       477.         0.180  
 9         1 Obese I          755.         0.285  
10         1 Obese II         693.         0.261  
11         1 Obese III        636.         0.240  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            3725                8.08
2         1            1650                8.12
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_GLP1_vs_SGLT2_Epilepsy_Seizure.csv 

Standardized Mean Differences - Before Weighting (Top 10):
         variable std_diff
1    baseline_bmi   0.4081
2  baseline_hba1c  -0.2989
3             age  -0.2815
4      index_year  -0.2633
5            chf1  -0.2490
6             mi1  -0.2196
7             rd1  -0.1755
8         Statin1  -0.1639
9          income  -0.1620
10          RAAS1  -0.1503

Standardized Mean Differences - After Weighting (Top 10):
            variable std_diff
1       baseline_bmi   0.0404
2         index_year   0.0343
3            cancer1  -0.0289
4                mc1  -0.0281
5  raceethnicity_cat  -0.0280
6          Diuretic1  -0.0275
7                mi1  -0.0242
8            Statin1  -0.0225
9              DPP41   0.0206
10              cvd1  -0.0197

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5300  0.6347  0.7590  1.0000  1.0621  4.2661 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  3725     75      2724.            53.5  0.0201        0.0196 
2         1  1650     14      2651.            23.5  0.00848       0.00886

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 5375, number of events= 89 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)  
treatment -0.8044    0.4473   0.2476    0.3293 -2.443   0.0146 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.4473      2.235    0.2346     0.853

Concordance= 0.581  (se = 0.039 )
Likelihood ratio test= 11.46  on 1 df,   p=7e-04
Wald test            = 5.97  on 1 df,   p=0.01
Score (logrank) test = 11.14  on 1 df,   p=8e-04,   Robust = 9.08  p=0.003

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: GLP1 vs SGLT2 - Epilepsy/Seizure 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
baseline_bmi                  0.4081     0.0404     0.4081     0.0404
baseline_hba1c               -0.2989     0.0197     0.2989     0.0197
age                          -0.2815    -0.0053     0.2815     0.0053
index_year                   -0.2633     0.0343     0.2633     0.0343
chf1                         -0.2490    -0.0070     0.2490     0.0070
mi1                          -0.2196    -0.0242     0.2196     0.0242
rd1                          -0.1755    -0.0019     0.1755     0.0019
Statin1                      -0.1639    -0.0225     0.1639     0.0225
income                       -0.1620    -0.0143     0.1620     0.0143
RAAS1                        -0.1503     0.0008     0.1503     0.0008
cvd1                         -0.1242    -0.0197     0.1242     0.0197
BB1                          -0.1236    -0.0092     0.1236     0.0092
Insulin1                     -0.1130     0.0118     0.1130     0.0118
pvd1                         -0.1107    -0.0135     0.1107     0.0135
SU1                          -0.1015     0.0050     0.1015     0.0050
Diuretic1                    -0.0897    -0.0275     0.0897     0.0275
cancer1                      -0.0890    -0.0289     0.0890     0.0289
Antiplatelet1                -0.0798    -0.0073     0.0798     0.0073
Biguanide1                   -0.0784    -0.0101     0.0784     0.0101
mc1                          -0.0782    -0.0281     0.0782     0.0281
pud1                         -0.0730    -0.0187     0.0730     0.0187
raceethnicity_cat            -0.0718    -0.0280     0.0718     0.0280
Anticoagulant1               -0.0664    -0.0182     0.0664     0.0182
ph1                          -0.0531    -0.0185     0.0531     0.0185
CCB1                         -0.0523     0.0060     0.0523     0.0060
TZD1                         -0.0505    -0.0097     0.0505     0.0097
DPP41                        -0.0461     0.0206     0.0461     0.0206
ctd1                          0.0429    -0.0096     0.0429     0.0096
mld1                         -0.0394     0.0005     0.0394     0.0005
dem1                          0.0378    -0.0025     0.0378     0.0025
OtherHTN1                     0.0311     0.0154     0.0311     0.0154
hiv1                         -0.0273     0.0062     0.0273     0.0062
sex_cat                      -0.0228     0.0025     0.0228     0.0025
msld1                        -0.0215    -0.0093     0.0215     0.0093
cpd1                          0.0214     0.0028     0.0214     0.0028
Ezetimibe1                   -0.0206    -0.0039     0.0206     0.0039
education                    -0.0187     0.0057     0.0187     0.0057
MRA1                         -0.0169    -0.0049     0.0169     0.0049
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 15
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 38
Mean |SMD| before: 0.1072
Mean |SMD| after: 0.0135
Maximum |SMD| before: 0.4081 (baseline_bmi)
Maximum |SMD| after: 0.0404 (baseline_bmi)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_GLP1_vs_SGLT2_Epilepsy_Seizure.csv 

Debug: weighted_df columns: person_id glp1_idx sglt2_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 5375 
Debug: event_time_months range: 0 68.4954 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_GLP1_vs_SGLT2_Epilepsy_Seizure.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for GLP1 vs SGLT2 - Epilepsy/Seizure :
- Initial cohort (T2DM): 7034 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 5839 (excluded: 817 )
- After age filtering: 5375 (excluded: 0 )
- Final events: 89 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for Epilepsy/Seizure ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 5375 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, glp1_idx, sglt2_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       2947             2.45                 2947
2         1       1320             2.33                 1320
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 4267 out of 5375 
Patients with baseline HbA1c data: 5375 
Patients with weighted mean HbA1c data: 4267 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.05 SD: 1.86 
Weighted Mean HbA1c - Mean: 7.61 SD: 1.55 
Correlation between baseline and weighted mean: 0.758 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 5150 
Total events: 80 

Diagnostic after HbA1c filtering:
Remaining patients: 5150 
Remaining events: 80 
Events by treatment: 
   
       0    1
  0 3490   68
  1 1580   12

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
              Estimate Std. Error   t value     Pr(>|t|)
(Intercept)  8.8016046 0.13849385 63.552312 0.000000e+00
treatment   -0.2725466 0.04796046 -5.682736 1.417127e-08
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                 Estimate Std. Error   z value    Pr(>|z|)
treatment      -0.6777050 0.28360486 -2.389610 0.016866270
hba1c_mean_6mo  0.1905293 0.07152766  2.663715 0.007728305

=== IPWT Mediation Analysis Summary for Epilepsy/Seizure ===
A path (Treatment -> HbA1c): -0.2725466 p = 1.417127e-08 
B path (HbA1c -> Outcome): 0.1905293 p = 0.007728305 
C path (Direct Effect): -0.677705 p = 0.01686627 
Indirect Effect (A*B): -0.05192812 p = 0.01586983 (Sobel test)
Total Effect (C + A*B): -0.7296331 

--- HbA1c Mediation Analysis End for Epilepsy/Seizure ---

========= HbA1c Trajectory Analysis: GLP1 vs SGLT2 - Epilepsy/Seizure =========
Rows: 1126922 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): person_id, A1c
date (1): date_of_measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Baseline HbA1c means (unweighted):
# A tibble: 2 × 3
  treatment unweighted_baseline n_baseline
      <dbl>               <dbl>      <int>
1         0                8.22       3725
2         1                7.67       1650


Linear Mixed Model Results (unweighted, adjusted for baseline HbA1c):
                         Estimate  Std. Error       df     t value
(Intercept)            1.25218130 0.035140318 6333.529  35.6337501
baseline_a1c           0.83232444 0.004102916 6242.748 202.8616812
years_since           -0.36918925 0.020345301 4394.307 -18.1461677
treatment             -0.12299378 0.016994645 6645.606  -7.2372081
years_since:treatment -0.02102166 0.036541124 4423.171  -0.5752877
                           Pr(>|t|)
(Intercept)           1.223842e-253
baseline_a1c           0.000000e+00
years_since            5.090971e-71
treatment              5.095143e-13
years_since:treatment  5.651260e-01

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 27015' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 27015)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 27015' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 27015)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 27015' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 27015)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 27015' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 27015)' or larger];
but be warned that this may result in large computation time and memory use.



==== HbA1c Trajectory LMM Results for Epilepsy/Seizure (IPWT) ====
                         Estimate  Std. Error      Pr(>|t|)
(Intercept)            1.25218130 0.035140318 1.223842e-253
baseline_a1c           0.83232444 0.004102916  0.000000e+00
years_since           -0.36918925 0.020345301  5.090971e-71
treatment             -0.12299378 0.016994645  5.095143e-13
years_since:treatment -0.02102166 0.036541124  5.651260e-01
# A tibble: 5 × 9
  effect term    estimate std.error statistic    df   p.value conf.low conf.high
  <chr>  <chr>      <dbl>     <dbl>     <dbl> <dbl>     <dbl>    <dbl>     <dbl>
1 fixed  (Inter…   1.25     0.0351     35.6   6334. 1.22e-253   1.18      1.32  
2 fixed  baseli…   0.832    0.00410   203.    6243. 0           0.824     0.840 
3 fixed  years_…  -0.369    0.0203    -18.1   4394. 5.09e- 71  -0.409    -0.329 
4 fixed  treatm…  -0.123    0.0170     -7.24  6646. 5.10e- 13  -0.156    -0.0897
5 fixed  years_…  -0.0210   0.0365     -0.575 4423. 5.65e-  1  -0.0927    0.0506

Estimated marginal means by time and treatment:
years_since = 0:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  8.020 0.00926 Inf     8.002     8.038
         1  7.897 0.01420 Inf     7.869     7.925

years_since = 1:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.651 0.01970 Inf     7.613     7.690
         1  7.507 0.02930 Inf     7.450     7.564

years_since = 2:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.282 0.03890 Inf     7.206     7.358
         1  7.117 0.05790 Inf     7.003     7.230

Degrees-of-freedom method: asymptotic 
Confidence level used: 0.95 

Treatment Effect (Baseline HbA1c difference): -0.123 (p = 5.1e-13 )
Time×Treatment Interaction (HbA1c change over time): -0.021 (p = 0.565 )

Cohort sizes for HbA1c trajectory analysis:
# A tibble: 2 × 3
  treatment     n weighted_n
      <dbl> <int>      <dbl>
1         0  3725      2724.
2         1  1650      2651.

========= IPWT Analysis: GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 7034 
Treatment distribution: 4922 2112 

Raw outcome variable ( epilepsy_or_seizure_start_date ) summary:
Total patients with outcome dates: 503 
Total patients without outcome dates: 6531 
Outcome date range: 6498 to 19631 
===========================

Before excluding pre-existing Early-onset Epilepsy/Seizure patients: 7034 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Epilepsy/Seizure diagnosed BEFORE index date (excluding): 378 
Patients eligible for analysis: 6656 
=======================================
After excluding pre-existing Early-onset Epilepsy/Seizure patients: 6656 (excluded: 378 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 125 
Treatment distribution after exclusion: 4660 1996 
Outcome date range after exclusion: 17701 to 19631 
Outcomes occurring AFTER index date: 123 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                6619                      5                 106.
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  6095                     31                 198.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 6656 
Patients with outcome dates: 125 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: epilepsy_or_seizure_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: TRUE 
- Input data rows: 6656 
- Patients with outcome dates: 125 
- Outcome date range: 17701 to 19631 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 5497 
- Raw events (before late-onset filter): 96 
- Events after time >= 0 filter: 13 
- Patients filtered out due to event_time < 0: 817 
- Early-onset applied: events with age < 50: 13 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2085 
- Mean event_time: 879.4891 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 18                                  96 
No event - administrative censoring 
                               5725 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 5839 
Patients with events (event = 1): 13 
Patients without events (event = 0): 5826 
Event distribution by treatment:
   
       0    1
  0 4057    9
  1 1769    4

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   559.0   833.0   879.5  1215.0  2085.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 96 
Final events: 13 
Early onset filter applied (age < 50)
Events with age_at_event < 50: 13 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  4066     34.3   7.62       33.3          35
2         1  1773     37.7   8.25       36.4           2

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          15    294        926    1134      883       779   35
  1           0     40        249     444      453       585    2

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  4066       8.22     1.83          7.9           311
2         1  1773       7.67     1.87          7.3           123

Total sample size: 5839 
Total events: 13 

Index Year Distribution:

2018 2019 2020 2021 
 720 1279 1483 2357 
Note: Dropping 464 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          3725              35.5
2         1          1650              35.9

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 11 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        7.12       0.00261
 2         0 Normal           169.         0.0619 
 3         0 Overweight       558.         0.205  
 4         0 Obese I          723.         0.265  
 5         0 Obese II         605.         0.222  
 6         0 Obese III        663.         0.243  
 7         1 Normal            89.6        0.0338 
 8         1 Overweight       477.         0.180  
 9         1 Obese I          755.         0.285  
10         1 Obese II         693.         0.261  
11         1 Obese III        636.         0.240  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            3725                8.08
2         1            1650                8.12
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_GLP1_vs_SGLT2_Early-onset_Epilepsy_Seizure.csv 

Standardized Mean Differences - Before Weighting (Top 10):
         variable std_diff
1    baseline_bmi   0.4081
2  baseline_hba1c  -0.2989
3             age  -0.2815
4      index_year  -0.2633
5            chf1  -0.2490
6             mi1  -0.2196
7             rd1  -0.1755
8         Statin1  -0.1639
9          income  -0.1620
10          RAAS1  -0.1503

Standardized Mean Differences - After Weighting (Top 10):
            variable std_diff
1       baseline_bmi   0.0404
2         index_year   0.0343
3            cancer1  -0.0289
4                mc1  -0.0281
5  raceethnicity_cat  -0.0280
6          Diuretic1  -0.0275
7                mi1  -0.0242
8            Statin1  -0.0225
9              DPP41   0.0206
10              cvd1  -0.0197

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5300  0.6347  0.7590  1.0000  1.0621  4.2661 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  3725      9      2724.            8.29  0.00242       0.00304
2         1  1650      4      2651.            4.95  0.00242       0.00187

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 5375, number of events= 13 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)
treatment -0.4942    0.6101   0.5681    0.6783 -0.728    0.466

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.6101      1.639    0.1614     2.306

Concordance= 0.56  (se = 0.09 )
Likelihood ratio test= 0.78  on 1 df,   p=0.4
Wald test            = 0.53  on 1 df,   p=0.5
Score (logrank) test = 0.77  on 1 df,   p=0.4,   Robust = 0.6  p=0.4

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
baseline_bmi                  0.4081     0.0404     0.4081     0.0404
baseline_hba1c               -0.2989     0.0197     0.2989     0.0197
age                          -0.2815    -0.0053     0.2815     0.0053
index_year                   -0.2633     0.0343     0.2633     0.0343
chf1                         -0.2490    -0.0070     0.2490     0.0070
mi1                          -0.2196    -0.0242     0.2196     0.0242
rd1                          -0.1755    -0.0019     0.1755     0.0019
Statin1                      -0.1639    -0.0225     0.1639     0.0225
income                       -0.1620    -0.0143     0.1620     0.0143
RAAS1                        -0.1503     0.0008     0.1503     0.0008
cvd1                         -0.1242    -0.0197     0.1242     0.0197
BB1                          -0.1236    -0.0092     0.1236     0.0092
Insulin1                     -0.1130     0.0118     0.1130     0.0118
pvd1                         -0.1107    -0.0135     0.1107     0.0135
SU1                          -0.1015     0.0050     0.1015     0.0050
Diuretic1                    -0.0897    -0.0275     0.0897     0.0275
cancer1                      -0.0890    -0.0289     0.0890     0.0289
Antiplatelet1                -0.0798    -0.0073     0.0798     0.0073
Biguanide1                   -0.0784    -0.0101     0.0784     0.0101
mc1                          -0.0782    -0.0281     0.0782     0.0281
pud1                         -0.0730    -0.0187     0.0730     0.0187
raceethnicity_cat            -0.0718    -0.0280     0.0718     0.0280
Anticoagulant1               -0.0664    -0.0182     0.0664     0.0182
ph1                          -0.0531    -0.0185     0.0531     0.0185
CCB1                         -0.0523     0.0060     0.0523     0.0060
TZD1                         -0.0505    -0.0097     0.0505     0.0097
DPP41                        -0.0461     0.0206     0.0461     0.0206
ctd1                          0.0429    -0.0096     0.0429     0.0096
mld1                         -0.0394     0.0005     0.0394     0.0005
dem1                          0.0378    -0.0025     0.0378     0.0025
OtherHTN1                     0.0311     0.0154     0.0311     0.0154
hiv1                         -0.0273     0.0062     0.0273     0.0062
sex_cat                      -0.0228     0.0025     0.0228     0.0025
msld1                        -0.0215    -0.0093     0.0215     0.0093
cpd1                          0.0214     0.0028     0.0214     0.0028
Ezetimibe1                   -0.0206    -0.0039     0.0206     0.0039
education                    -0.0187     0.0057     0.0187     0.0057
MRA1                         -0.0169    -0.0049     0.0169     0.0049
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 15
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 38
Mean |SMD| before: 0.1072
Mean |SMD| after: 0.0135
Maximum |SMD| before: 0.4081 (baseline_bmi)
Maximum |SMD| after: 0.0404 (baseline_bmi)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_GLP1_vs_SGLT2_Early-onset_Epilepsy_Seizure.csv 


Debug: weighted_df columns: person_id glp1_idx sglt2_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 5375 
Debug: event_time_months range: 0 68.4954 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_GLP1_vs_SGLT2_Early-onset_Epilepsy_Seizure.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure :
- Initial cohort (T2DM): 7034 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 5839 (excluded: 817 )
- After age filtering: 5375 (excluded: 0 )
- Final events: 13 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for Early-onset Epilepsy/Seizure ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 5375 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, glp1_idx, sglt2_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       2947             2.45                 2947
2         1       1320             2.33                 1320
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 4267 out of 5375 
Patients with baseline HbA1c data: 5375 
Patients with weighted mean HbA1c data: 4267 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.05 SD: 1.86 
Weighted Mean HbA1c - Mean: 7.61 SD: 1.55 
Correlation between baseline and weighted mean: 0.758 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 5150 
Total events: 80 

Diagnostic after HbA1c filtering:
Remaining patients: 5150 
Remaining events: 80 
Events by treatment: 
   
       0    1
  0 3490   68
  1 1580   12

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
              Estimate Std. Error   t value     Pr(>|t|)
(Intercept)  8.8016046 0.13849385 63.552312 0.000000e+00
treatment   -0.2725466 0.04796046 -5.682736 1.417127e-08
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                 Estimate Std. Error   z value    Pr(>|z|)
treatment      -0.6777050 0.28360486 -2.389610 0.016866270
hba1c_mean_6mo  0.1905293 0.07152766  2.663715 0.007728305

=== IPWT Mediation Analysis Summary for Early-onset Epilepsy/Seizure ===
A path (Treatment -> HbA1c): -0.2725466 p = 1.417127e-08 
B path (HbA1c -> Outcome): 0.1905293 p = 0.007728305 
C path (Direct Effect): -0.677705 p = 0.01686627 
Indirect Effect (A*B): -0.05192812 p = 0.01586983 (Sobel test)
Total Effect (C + A*B): -0.7296331 

--- HbA1c Mediation Analysis End for Early-onset Epilepsy/Seizure ---

========= HbA1c Trajectory Analysis: GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure =========
Rows: 1126922 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): person_id, A1c
date (1): date_of_measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Baseline HbA1c means (unweighted):
# A tibble: 2 × 3
  treatment unweighted_baseline n_baseline
      <dbl>               <dbl>      <int>
1         0                8.22       3725
2         1                7.67       1650


Linear Mixed Model Results (unweighted, adjusted for baseline HbA1c):
                         Estimate  Std. Error       df     t value
(Intercept)            1.25218130 0.035140318 6333.529  35.6337501
baseline_a1c           0.83232444 0.004102916 6242.748 202.8616812
years_since           -0.36918925 0.020345301 4394.307 -18.1461677
treatment             -0.12299378 0.016994645 6645.606  -7.2372081
years_since:treatment -0.02102166 0.036541124 4423.171  -0.5752877
                           Pr(>|t|)
(Intercept)           1.223842e-253
baseline_a1c           0.000000e+00
years_since            5.090971e-71
treatment              5.095143e-13
years_since:treatment  5.651260e-01

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 27015' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 27015)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 27015' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 27015)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 27015' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 27015)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 27015' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 27015)' or larger];
but be warned that this may result in large computation time and memory use.



==== HbA1c Trajectory LMM Results for Early-onset Epilepsy/Seizure (IPWT) ====
                         Estimate  Std. Error      Pr(>|t|)
(Intercept)            1.25218130 0.035140318 1.223842e-253
baseline_a1c           0.83232444 0.004102916  0.000000e+00
years_since           -0.36918925 0.020345301  5.090971e-71
treatment             -0.12299378 0.016994645  5.095143e-13
years_since:treatment -0.02102166 0.036541124  5.651260e-01
# A tibble: 5 × 9
  effect term    estimate std.error statistic    df   p.value conf.low conf.high
  <chr>  <chr>      <dbl>     <dbl>     <dbl> <dbl>     <dbl>    <dbl>     <dbl>
1 fixed  (Inter…   1.25     0.0351     35.6   6334. 1.22e-253   1.18      1.32  
2 fixed  baseli…   0.832    0.00410   203.    6243. 0           0.824     0.840 
3 fixed  years_…  -0.369    0.0203    -18.1   4394. 5.09e- 71  -0.409    -0.329 
4 fixed  treatm…  -0.123    0.0170     -7.24  6646. 5.10e- 13  -0.156    -0.0897
5 fixed  years_…  -0.0210   0.0365     -0.575 4423. 5.65e-  1  -0.0927    0.0506

Estimated marginal means by time and treatment:
years_since = 0:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  8.020 0.00926 Inf     8.002     8.038
         1  7.897 0.01420 Inf     7.869     7.925

years_since = 1:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.651 0.01970 Inf     7.613     7.690
         1  7.507 0.02930 Inf     7.450     7.564

years_since = 2:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.282 0.03890 Inf     7.206     7.358
         1  7.117 0.05790 Inf     7.003     7.230

Degrees-of-freedom method: asymptotic 
Confidence level used: 0.95 

Treatment Effect (Baseline HbA1c difference): -0.123 (p = 5.1e-13 )
Time×Treatment Interaction (HbA1c change over time): -0.021 (p = 0.565 )

Cohort sizes for HbA1c trajectory analysis:
# A tibble: 2 × 3
  treatment     n weighted_n
      <dbl> <int>      <dbl>
1         0  3725      2724.
2         1  1650      2651.

========= IPWT Analysis: GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 7034 
Treatment distribution: 4922 2112 

Raw outcome variable ( epilepsy_or_seizure_start_date ) summary:
Total patients with outcome dates: 503 
Total patients without outcome dates: 6531 
Outcome date range: 6498 to 19631 
===========================

Before excluding pre-existing Late-onset Epilepsy/Seizure patients: 7034 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Epilepsy/Seizure diagnosed BEFORE index date (excluding): 378 
Patients eligible for analysis: 6656 
=======================================
After excluding pre-existing Late-onset Epilepsy/Seizure patients: 6656 (excluded: 378 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 125 
Treatment distribution after exclusion: 4660 1996 
Outcome date range after exclusion: 17701 to 19631 
Outcomes occurring AFTER index date: 123 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                6619                      5                 106.
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  6095                     31                 198.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 6656 
Patients with outcome dates: 125 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: epilepsy_or_seizure_start_date 
- data_cut_date: 2023-10-01 
- late_onset: TRUE 
- early_onset: FALSE 
- Input data rows: 6656 
- Patients with outcome dates: 125 
- Outcome date range: 17701 to 19631 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 5497 
- Raw events (before late-onset filter): 96 
- Events after time >= 0 filter: 83 
- Patients filtered out due to event_time < 0: 817 
- Late-onset applied: events with age >= 50: 83 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2085 
- Mean event_time: 879.4891 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 18                                  96 
No event - administrative censoring 
                               5725 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 5839 
Patients with events (event = 1): 83 
Patients without events (event = 0): 5756 
Event distribution by treatment:
   
       0    1
  0 3994   72
  1 1762   11

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   559.0   833.0   879.5  1215.0  2085.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 96 
Final events: 83 
Late onset filter applied (age >= 50)
Events with age_at_event >= 50: 83 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  4066     34.3   7.62       33.3          35
2         1  1773     37.7   8.25       36.4           2

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          15    294        926    1134      883       779   35
  1           0     40        249     444      453       585    2

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  4066       8.22     1.83          7.9           311
2         1  1773       7.67     1.87          7.3           123

Total sample size: 5839 
Total events: 83 

Index Year Distribution:

2018 2019 2020 2021 
 720 1279 1483 2357 
Note: Dropping 464 rows with missing values in covariates
After age filtering (>= 50 ): samples = 4718 , events = 75 

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          3351              34.9
2         1          1367              35.2

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 11 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        7.12       0.00298
 2         0 Normal           157.         0.0656 
 3         0 Overweight       520.         0.218  
 4         0 Obese I          654.         0.274  
 5         0 Obese II         537.         0.225  
 6         0 Obese III        516.         0.216  
 7         1 Normal            86.0        0.0370 
 8         1 Overweight       446.         0.192  
 9         1 Obese I          689.         0.296  
10         1 Obese II         618.         0.266  
11         1 Obese III        487.         0.209  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            3351                8.05
2         1            1367                8.09
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_GLP1_vs_SGLT2_Late-onset_Epilepsy_Seizure.csv 

Standardized Mean Differences - Before Weighting (Top 10):
         variable std_diff
1    baseline_bmi   0.4081
2  baseline_hba1c  -0.2989
3             age  -0.2815
4      index_year  -0.2633
5            chf1  -0.2490
6             mi1  -0.2196
7             rd1  -0.1755
8         Statin1  -0.1639
9          income  -0.1620
10          RAAS1  -0.1503

Standardized Mean Differences - After Weighting (Top 10):
            variable std_diff
1       baseline_bmi   0.0404
2         index_year   0.0343
3            cancer1  -0.0289
4                mc1  -0.0281
5  raceethnicity_cat  -0.0280
6          Diuretic1  -0.0275
7                mi1  -0.0242
8            Statin1  -0.0225
9              DPP41   0.0206
10              cvd1  -0.0197

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5300  0.6275  0.7447  0.9999  1.0525  4.2661 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  3351     65      2391.            44.7  0.0194        0.0187 
2         1  1367     10      2327.            18.5  0.00732       0.00796

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 5375, number of events= 76 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)  
treatment -0.8733    0.4176   0.2758    0.3781 -2.309   0.0209 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.4176      2.395     0.199    0.8762

Concordance= 0.585  (se = 0.043 )
Likelihood ratio test= 11.03  on 1 df,   p=9e-04
Wald test            = 5.33  on 1 df,   p=0.02
Score (logrank) test = 10.68  on 1 df,   p=0.001,   Robust = 8.8  p=0.003

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
baseline_bmi                  0.4081     0.0404     0.4081     0.0404
baseline_hba1c               -0.2989     0.0197     0.2989     0.0197
age                          -0.2815    -0.0053     0.2815     0.0053
index_year                   -0.2633     0.0343     0.2633     0.0343
chf1                         -0.2490    -0.0070     0.2490     0.0070
mi1                          -0.2196    -0.0242     0.2196     0.0242
rd1                          -0.1755    -0.0019     0.1755     0.0019
Statin1                      -0.1639    -0.0225     0.1639     0.0225
income                       -0.1620    -0.0143     0.1620     0.0143
RAAS1                        -0.1503     0.0008     0.1503     0.0008
cvd1                         -0.1242    -0.0197     0.1242     0.0197
BB1                          -0.1236    -0.0092     0.1236     0.0092
Insulin1                     -0.1130     0.0118     0.1130     0.0118
pvd1                         -0.1107    -0.0135     0.1107     0.0135
SU1                          -0.1015     0.0050     0.1015     0.0050
Diuretic1                    -0.0897    -0.0275     0.0897     0.0275
cancer1                      -0.0890    -0.0289     0.0890     0.0289
Antiplatelet1                -0.0798    -0.0073     0.0798     0.0073
Biguanide1                   -0.0784    -0.0101     0.0784     0.0101
mc1                          -0.0782    -0.0281     0.0782     0.0281
pud1                         -0.0730    -0.0187     0.0730     0.0187
raceethnicity_cat            -0.0718    -0.0280     0.0718     0.0280
Anticoagulant1               -0.0664    -0.0182     0.0664     0.0182
ph1                          -0.0531    -0.0185     0.0531     0.0185
CCB1                         -0.0523     0.0060     0.0523     0.0060
TZD1                         -0.0505    -0.0097     0.0505     0.0097
DPP41                        -0.0461     0.0206     0.0461     0.0206
ctd1                          0.0429    -0.0096     0.0429     0.0096
mld1                         -0.0394     0.0005     0.0394     0.0005
dem1                          0.0378    -0.0025     0.0378     0.0025
OtherHTN1                     0.0311     0.0154     0.0311     0.0154
hiv1                         -0.0273     0.0062     0.0273     0.0062
sex_cat                      -0.0228     0.0025     0.0228     0.0025
msld1                        -0.0215    -0.0093     0.0215     0.0093
cpd1                          0.0214     0.0028     0.0214     0.0028
Ezetimibe1                   -0.0206    -0.0039     0.0206     0.0039
education                    -0.0187     0.0057     0.0187     0.0057
MRA1                         -0.0169    -0.0049     0.0169     0.0049
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 15
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 38
Mean |SMD| before: 0.1072
Mean |SMD| after: 0.0135
Maximum |SMD| before: 0.4081 (baseline_bmi)
Maximum |SMD| after: 0.0404 (baseline_bmi)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_GLP1_vs_SGLT2_Late-onset_Epilepsy_Seizure.csv 


Debug: weighted_df columns: person_id glp1_idx sglt2_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 4718 
Debug: event_time_months range: 0 68.19974 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_GLP1_vs_SGLT2_Late-onset_Epilepsy_Seizure.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure :
- Initial cohort (T2DM): 7034 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 5839 (excluded: 817 )
- After age filtering: 4718 (excluded: 657 )
- Final events: 75 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for Late-onset Epilepsy/Seizure ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 4718 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, glp1_idx, sglt2_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       2656             2.47                 2656
2         1       1102             2.35                 1102
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 3758 out of 4718 
Patients with baseline HbA1c data: 4718 
Patients with weighted mean HbA1c data: 3758 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.02 SD: 1.8 
Weighted Mean HbA1c - Mean: 7.59 SD: 1.5 
Correlation between baseline and weighted mean: 0.752 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 4527 
Total events: 70 

Diagnostic after HbA1c filtering:
Remaining patients: 4527 
Remaining events: 70 
Events by treatment: 
   
       0    1
  0 3143   61
  1 1314    9

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
              Estimate Std. Error   t value     Pr(>|t|)
(Intercept)  9.2649747 0.19219421 48.206315 0.000000e+00
treatment   -0.2632706 0.04926725 -5.343725 9.664897e-08
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                 Estimate Std. Error   z value   Pr(>|z|)
treatment      -0.7516138 0.30622208 -2.454473 0.01410912
hba1c_mean_6mo  0.1009236 0.08537626  1.182104 0.23716459

=== IPWT Mediation Analysis Summary for Late-onset Epilepsy/Seizure ===
A path (Treatment -> HbA1c): -0.2632706 p = 9.664897e-08 
B path (HbA1c -> Outcome): 0.1009236 p = 0.2371646 
C path (Direct Effect): -0.7516138 p = 0.01410912 
Indirect Effect (A*B): -0.02657021 p = 0.2484181 (Sobel test)
Total Effect (C + A*B): -0.7781841 

--- HbA1c Mediation Analysis End for Late-onset Epilepsy/Seizure ---

========= HbA1c Trajectory Analysis: GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure =========
Rows: 1126922 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): person_id, A1c
date (1): date_of_measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Baseline HbA1c means (unweighted):
# A tibble: 2 × 3
  treatment unweighted_baseline n_baseline
      <dbl>               <dbl>      <int>
1         0                8.17       3351
2         1                7.64       1367


Linear Mixed Model Results (unweighted, adjusted for baseline HbA1c):
                         Estimate  Std. Error       df     t value
(Intercept)            1.30166662 0.037533624 5514.284  34.6800140
baseline_a1c           0.82574429 0.004415575 5419.111 187.0071973
years_since           -0.35682715 0.020426248 3885.198 -17.4690500
treatment             -0.11906396 0.018098222 5833.132  -6.5787658
years_since:treatment -0.02184893 0.037678191 3898.476  -0.5798827
                           Pr(>|t|)
(Intercept)           1.437158e-238
baseline_a1c           0.000000e+00
years_since            7.622351e-66
treatment              5.157039e-11
years_since:treatment  5.620273e-01

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 24056' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 24056)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 24056' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 24056)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 24056' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 24056)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 24056' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 24056)' or larger];
but be warned that this may result in large computation time and memory use.



==== HbA1c Trajectory LMM Results for Late-onset Epilepsy/Seizure (IPWT) ====
                         Estimate  Std. Error      Pr(>|t|)
(Intercept)            1.30166662 0.037533624 1.437158e-238
baseline_a1c           0.82574429 0.004415575  0.000000e+00
years_since           -0.35682715 0.020426248  7.622351e-66
treatment             -0.11906396 0.018098222  5.157039e-11
years_since:treatment -0.02184893 0.037678191  5.620273e-01
# A tibble: 5 × 9
  effect term    estimate std.error statistic    df   p.value conf.low conf.high
  <chr>  <chr>      <dbl>     <dbl>     <dbl> <dbl>     <dbl>    <dbl>     <dbl>
1 fixed  (Inter…   1.30     0.0375     34.7   5514. 1.44e-238   1.23      1.38  
2 fixed  baseli…   0.826    0.00442   187.    5419. 0           0.817     0.834 
3 fixed  years_…  -0.357    0.0204    -17.5   3885. 7.62e- 66  -0.397    -0.317 
4 fixed  treatm…  -0.119    0.0181     -6.58  5833. 5.16e- 11  -0.155    -0.0836
5 fixed  years_…  -0.0218   0.0377     -0.580 3898. 5.62e-  1  -0.0957    0.0520

Estimated marginal means by time and treatment:
years_since = 0:
 treatment emmean     SE  df asymp.LCL asymp.UCL
         0  7.990 0.0096 Inf     7.971     8.009
         1  7.871 0.0153 Inf     7.841     7.901

years_since = 1:
 treatment emmean     SE  df asymp.LCL asymp.UCL
         0  7.633 0.0198 Inf     7.595     7.672
         1  7.492 0.0306 Inf     7.432     7.552

years_since = 2:
 treatment emmean     SE  df asymp.LCL asymp.UCL
         0  7.276 0.0390 Inf     7.200     7.353
         1  7.114 0.0604 Inf     6.995     7.232

Degrees-of-freedom method: asymptotic 
Confidence level used: 0.95 

Treatment Effect (Baseline HbA1c difference): -0.119 (p = 5.16e-11 )
Time×Treatment Interaction (HbA1c change over time): -0.022 (p = 0.562 )

Cohort sizes for HbA1c trajectory analysis:
# A tibble: 2 × 3
  treatment     n weighted_n
      <dbl> <int>      <dbl>
1         0  3351      2391.
2         1  1367      2327.

========= IPWT Analysis: GLP1 vs SGLT2 - ADRD =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 7034 
Treatment distribution: 4922 2112 

Raw outcome variable ( adrd_start_date ) summary:
Total patients with outcome dates: 456 
Total patients without outcome dates: 6578 
Outcome date range: 8894 to 19629 
===========================

Before excluding pre-existing ADRD patients: 7034 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
ADRD diagnosed BEFORE index date (excluding): 242 
Patients eligible for analysis: 6792 
=======================================
After excluding pre-existing ADRD patients: 6792 (excluded: 242 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 214 
Treatment distribution after exclusion: 4749 2043 
Outcome date range after exclusion: 17900 to 19629 
Outcomes occurring AFTER index date: 210 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                6753                      5                 107.
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  6222                     31                 202.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 6792 
Patients with outcome dates: 214 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: adrd_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: FALSE 
- Input data rows: 6792 
- Patients with outcome dates: 214 
- Outcome date range: 17900 to 19629 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 5602 
- Raw events (before late-onset filter): 159 
- Events after time >= 0 filter: 159 
- Patients filtered out due to event_time < 0: 842 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2085 
- Mean event_time: 881.3896 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 39                                 159 
No event - administrative censoring 
                               5752 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 5950 
Patients with events (event = 1): 159 
Patients without events (event = 0): 5791 
Event distribution by treatment:
   
       0    1
  0 4006  130
  1 1785   29

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   559.2   830.0   881.4  1222.0  2085.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 159 
Final events: 159 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  4136     34.3   7.65       33.4          37
2         1  1814     37.8   8.36       36.5           2

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          15    305        933    1152      897       797   37
  1           1     39        254     444      466       608    2

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  4136       8.24     1.84          7.9           313
2         1  1814       7.68     1.88          7.3           126

Total sample size: 5950 
Total events: 159 

Index Year Distribution:

2018 2019 2020 2021 
 740 1320 1487 2403 
Excluding 'dem' covariate for ADRD outcome analysis
Note: Dropping 472 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          3790              35.6
2         1          1688              35.9

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        6.99      0.00252 
 2         0 Normal           175.        0.0631  
 3         0 Overweight       562.        0.202   
 4         0 Obese I          736.        0.265   
 5         0 Obese II         615.        0.221   
 6         0 Obese III        683.        0.246   
 7         1 Underweight        1.72      0.000638
 8         1 Normal            88.3       0.0327  
 9         1 Overweight       494.        0.183   
10         1 Obese I          752.        0.278   
11         1 Obese II         711.        0.263   
12         1 Obese III        653.        0.242   

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            3790                8.09
2         1            1688                8.12
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_GLP1_vs_SGLT2_ADRD.csv 

Standardized Mean Differences - Before Weighting (Top 10):
         variable std_diff
1    baseline_bmi   0.4226
2  baseline_hba1c  -0.2997
3             age  -0.2868
4      index_year   0.2728
5            chf1  -0.2453
6             mi1  -0.2212
7             rd1  -0.1760
8         Statin1  -0.1657
9          income  -0.1639
10          RAAS1  -0.1427

Standardized Mean Differences - After Weighting (Top 10):
            variable std_diff
1       baseline_bmi   0.0402
2         index_year   0.0394
3          Diuretic1  -0.0279
4            cancer1  -0.0239
5            Statin1  -0.0239
6                mi1  -0.0232
7  raceethnicity_cat  -0.0226
8                mc1  -0.0219
9              DPP41   0.0216
10            income  -0.0204

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5295  0.6348  0.7606  1.0000  1.0605  4.2445 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  3790    129      2778.            83.1   0.0340        0.0299
2         1  1688     29      2700.            58.7   0.0172        0.0218

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 5478, number of events= 158 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)
treatment -0.3236    0.7235   0.1705    0.2268 -1.427    0.154

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.7235      1.382    0.4639     1.129

Concordance= 0.53  (se = 0.03 )
Likelihood ratio test= 3.66  on 1 df,   p=0.06
Wald test            = 2.04  on 1 df,   p=0.2
Score (logrank) test = 3.64  on 1 df,   p=0.06,   Robust = 2.48  p=0.1

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: GLP1 vs SGLT2 - ADRD 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
baseline_bmi                  0.4226     0.0402     0.4226     0.0402
baseline_hba1c               -0.2997     0.0133     0.2997     0.0133
age                          -0.2868    -0.0040     0.2868     0.0040
index_year                    0.2728     0.0394     0.2728     0.0394
chf1                         -0.2453    -0.0075     0.2453     0.0075
mi1                          -0.2212    -0.0232     0.2212     0.0232
rd1                          -0.1760     0.0026     0.1760     0.0026
Statin1                      -0.1657    -0.0239     0.1657     0.0239
income                       -0.1639    -0.0204     0.1639     0.0204
RAAS1                        -0.1427    -0.0044     0.1427     0.0044
BB1                          -0.1345    -0.0121     0.1345     0.0121
pvd1                         -0.1283    -0.0148     0.1283     0.0148
cvd1                         -0.1201    -0.0169     0.1201     0.0169
Insulin1                     -0.1087     0.0112     0.1087     0.0112
SU1                          -0.0979     0.0023     0.0979     0.0023
Diuretic1                    -0.0928    -0.0279     0.0928     0.0279
Biguanide1                   -0.0800    -0.0162     0.0800     0.0162
Antiplatelet1                -0.0797    -0.0031     0.0797     0.0031
cancer1                      -0.0762    -0.0239     0.0762     0.0239
mc1                          -0.0747    -0.0219     0.0747     0.0219
Anticoagulant1               -0.0717    -0.0180     0.0717     0.0180
pud1                         -0.0652    -0.0091     0.0652     0.0091
CCB1                         -0.0533     0.0051     0.0533     0.0051
ctd1                          0.0527    -0.0092     0.0527     0.0092
TZD1                         -0.0523    -0.0163     0.0523     0.0163
raceethnicity_cat            -0.0523    -0.0226     0.0523     0.0226
ph1                          -0.0476    -0.0154     0.0476     0.0154
DPP41                        -0.0417     0.0216     0.0417     0.0216
mld1                         -0.0389     0.0009     0.0389     0.0009
cpd1                          0.0282     0.0058     0.0282     0.0058
MRA1                         -0.0277     0.0005     0.0277     0.0005
Ezetimibe1                   -0.0263    -0.0054     0.0263     0.0054
hiv1                         -0.0244     0.0065     0.0244     0.0065
OtherHTN1                     0.0202     0.0143     0.0202     0.0143
msld1                        -0.0184    -0.0052     0.0184     0.0052
education                    -0.0138     0.0008     0.0138     0.0008
sex_cat                       0.0012     0.0053     0.0012     0.0053
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 14
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 36
Mean |SMD| before: 0.1088
Mean |SMD| after: 0.0133
Maximum |SMD| before: 0.4226 (baseline_bmi)
Maximum |SMD| after: 0.0402 (baseline_bmi)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_GLP1_vs_SGLT2_ADRD.csv 


Debug: weighted_df columns: person_id glp1_idx sglt2_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 5478 
Debug: event_time_months range: 0 68.4954 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_GLP1_vs_SGLT2_ADRD.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for GLP1 vs SGLT2 - ADRD :
- Initial cohort (T2DM): 7034 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 5950 (excluded: 842 )
- After age filtering: 5478 (excluded: 0 )
- Final events: 158 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for ADRD ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 5478 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, glp1_idx, sglt2_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       2994             2.45                 2994
2         1       1348             2.33                 1348
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 4342 out of 5478 
Patients with baseline HbA1c data: 5478 
Patients with weighted mean HbA1c data: 4342 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.06 SD: 1.87 
Weighted Mean HbA1c - Mean: 7.62 SD: 1.56 
Correlation between baseline and weighted mean: 0.756 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 5254 
Total events: 144 

Diagnostic after HbA1c filtering:
Remaining patients: 5254 
Remaining events: 144 
Events by treatment: 
   
       0    1
  0 3506  117
  1 1604   27

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
             Estimate Std. Error   t value     Pr(>|t|)
(Intercept)  8.825944 0.13639702 64.707745 0.000000e+00
treatment   -0.286971 0.04752724 -6.038031 1.695093e-09
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                 Estimate Std. Error   z value    Pr(>|z|)
treatment      -0.2390082 0.19608381 -1.218908 0.222879047
hba1c_mean_6mo  0.1712194 0.06032219  2.838414 0.004533831

=== IPWT Mediation Analysis Summary for ADRD ===
A path (Treatment -> HbA1c): -0.286971 p = 1.695093e-09 
B path (HbA1c -> Outcome): 0.1712194 p = 0.004533831 
C path (Direct Effect): -0.2390082 p = 0.222879 
Indirect Effect (A*B): -0.04913499 p = 0.01020679 (Sobel test)
Total Effect (C + A*B): -0.2881431 

--- HbA1c Mediation Analysis End for ADRD ---

========= HbA1c Trajectory Analysis: GLP1 vs SGLT2 - ADRD =========
Rows: 1126922 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): person_id, A1c
date (1): date_of_measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Baseline HbA1c means (unweighted):
# A tibble: 2 × 3
  treatment unweighted_baseline n_baseline
      <dbl>               <dbl>      <int>
1         0                8.23       3790
2         1                7.68       1688


Linear Mixed Model Results (unweighted, adjusted for baseline HbA1c):
                         Estimate  Std. Error       df     t value
(Intercept)            1.24338472 0.034919388 6463.308  35.6072889
baseline_a1c           0.83369283 0.004065474 6353.329 205.0665519
years_since           -0.36938941 0.020351728 4467.182 -18.1502730
treatment             -0.12362700 0.016957786 6800.145  -7.2902796
years_since:treatment -0.02642004 0.036488679 4497.592  -0.7240613
                           Pr(>|t|)
(Intercept)           9.869282e-254
baseline_a1c           0.000000e+00
years_since            4.331315e-71
treatment              3.443034e-13
years_since:treatment  4.690658e-01

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 27556' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 27556)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 27556' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 27556)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 27556' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 27556)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 27556' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 27556)' or larger];
but be warned that this may result in large computation time and memory use.



==== HbA1c Trajectory LMM Results for ADRD (IPWT) ====
                         Estimate  Std. Error      Pr(>|t|)
(Intercept)            1.24338472 0.034919388 9.869282e-254
baseline_a1c           0.83369283 0.004065474  0.000000e+00
years_since           -0.36938941 0.020351728  4.331315e-71
treatment             -0.12362700 0.016957786  3.443034e-13
years_since:treatment -0.02642004 0.036488679  4.690658e-01
# A tibble: 5 × 9
  effect term    estimate std.error statistic    df   p.value conf.low conf.high
  <chr>  <chr>      <dbl>     <dbl>     <dbl> <dbl>     <dbl>    <dbl>     <dbl>
1 fixed  (Inter…   1.24     0.0349     35.6   6463. 9.87e-254   1.17      1.31  
2 fixed  baseli…   0.834    0.00407   205.    6353. 0           0.826     0.842 
3 fixed  years_…  -0.369    0.0204    -18.2   4467. 4.33e- 71  -0.409    -0.329 
4 fixed  treatm…  -0.124    0.0170     -7.29  6800. 3.44e- 13  -0.157    -0.0904
5 fixed  years_…  -0.0264   0.0365     -0.724 4498. 4.69e-  1  -0.0980    0.0451

Estimated marginal means by time and treatment:
years_since = 0:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  8.037 0.00925 Inf     8.019     8.055
         1  7.913 0.01420 Inf     7.886     7.941

years_since = 1:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.668 0.01970 Inf     7.629     7.706
         1  7.518 0.02920 Inf     7.460     7.575

years_since = 2:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.298 0.03890 Inf     7.222     7.375
         1  7.122 0.05780 Inf     7.009     7.235

Degrees-of-freedom method: asymptotic 
Confidence level used: 0.95 

Treatment Effect (Baseline HbA1c difference): -0.124 (p = 3.44e-13 )
Time×Treatment Interaction (HbA1c change over time): -0.026 (p = 0.469 )

Cohort sizes for HbA1c trajectory analysis:
# A tibble: 2 × 3
  treatment     n weighted_n
      <dbl> <int>      <dbl>
1         0  3790      2778.
2         1  1688      2700.

========= IPWT Analysis: GLP1 vs SGLT2 - stroke =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 7034 
Treatment distribution: 4922 2112 

Raw outcome variable ( stroke_start_date ) summary:
Total patients with outcome dates: 897 
Total patients without outcome dates: 6137 
Outcome date range: 9400 to 19621 
===========================

Before excluding pre-existing stroke patients: 7034 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Stroke diagnosed BEFORE index date (excluding): 668 
Patients eligible for analysis: 6366 
=======================================
After excluding pre-existing stroke patients: 6366 (excluded: 668 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 229 
Treatment distribution after exclusion: 4421 1945 
Outcome date range after exclusion: 17564 to 19621 
Outcomes occurring AFTER index date: 222 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                6332                      5                 106.
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  5808                     31                 201.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 6366 
Patients with outcome dates: 229 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: stroke_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: FALSE 
- Input data rows: 6366 
- Patients with outcome dates: 229 
- Outcome date range: 17564 to 19621 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 5235 
- Raw events (before late-onset filter): 181 
- Events after time >= 0 filter: 181 
- Patients filtered out due to event_time < 0: 789 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2085 
- Mean event_time: 875.86 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 33                                 181 
No event - administrative censoring 
                               5363 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 5577 
Patients with events (event = 1): 181 
Patients without events (event = 0): 5396 
Event distribution by treatment:
   
       0    1
  0 3717  134
  1 1679   47

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   555.0   830.0   875.9  1211.0  2085.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 181 
Final events: 181 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  3851     34.4   7.71       33.4          32
2         1  1726     38.0   8.36       36.8           2

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          16    278        870    1057      842       756   32
  1           0     39        231     415      448       591    2

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  3851       8.23     1.84          7.9           310
2         1  1726       7.65     1.86          7.2           119

Total sample size: 5577 
Total events: 181 

Index Year Distribution:

2018 2019 2020 2021 
 694 1239 1386 2258 
Excluding 'cvd' covariate for Stroke outcome analysis
Note: Dropping 456 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          3514              35.7
2         1          1607              36.0

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 11 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        7.64       0.00295
 2         0 Normal           158.         0.0609 
 3         0 Overweight       523.         0.202  
 4         0 Obese I          673.         0.260  
 5         0 Obese II         575.         0.222  
 6         0 Obese III        655.         0.253  
 7         1 Normal            89.3        0.0353 
 8         1 Overweight       458.         0.181  
 9         1 Obese I          689.         0.272  
10         1 Obese II         669.         0.264  
11         1 Obese III        624.         0.247  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            3514                8.08
2         1            1607                8.12
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_GLP1_vs_SGLT2_stroke.csv 

Standardized Mean Differences - Before Weighting (Top 10):
         variable std_diff
1    baseline_bmi   0.4276
2  baseline_hba1c  -0.3130
3             age  -0.2853
4      index_year  -0.2722
5            chf1  -0.2166
6             mi1  -0.2099
7             rd1  -0.1638
8         Statin1  -0.1575
9           RAAS1  -0.1434
10         income  -0.1420

Standardized Mean Differences - After Weighting (Top 10):
            variable std_diff
1       baseline_bmi   0.0311
2         index_year  -0.0290
3                mi1  -0.0278
4  raceethnicity_cat  -0.0269
5            cancer1  -0.0258
6          Diuretic1  -0.0254
7            Statin1  -0.0218
8              DPP41   0.0205
9     baseline_hba1c   0.0190
10         OtherHTN1   0.0180

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5307  0.6356  0.7636  1.0000  1.0638  4.4453 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  3514    125      2592.            83.6   0.0356        0.0323
2         1  1607     46      2529.            89.8   0.0286        0.0355

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 5121, number of events= 171 

             coef exp(coef) se(coef) robust se     z Pr(>|z|)
treatment 0.08573   1.08951  0.15211   0.19319 0.444    0.657

          exp(coef) exp(-coef) lower .95 upper .95
treatment      1.09     0.9178    0.7461     1.591

Concordance= 0.516  (se = 0.025 )
Likelihood ratio test= 0.32  on 1 df,   p=0.6
Wald test            = 0.2  on 1 df,   p=0.7
Score (logrank) test = 0.32  on 1 df,   p=0.6,   Robust = 0.19  p=0.7

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: GLP1 vs SGLT2 - stroke 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
baseline_bmi                  0.4276     0.0311     0.4276     0.0311
baseline_hba1c               -0.3130     0.0190     0.3130     0.0190
age                          -0.2853    -0.0035     0.2853     0.0035
index_year                   -0.2722    -0.0290     0.2722     0.0290
chf1                         -0.2166    -0.0027     0.2166     0.0027
mi1                          -0.2099    -0.0278     0.2099     0.0278
rd1                          -0.1638     0.0026     0.1638     0.0026
Statin1                      -0.1575    -0.0218     0.1575     0.0218
RAAS1                        -0.1434     0.0042     0.1434     0.0042
income                       -0.1420    -0.0100     0.1420     0.0100
BB1                          -0.1199     0.0002     0.1199     0.0002
pvd1                         -0.1176    -0.0113     0.1176     0.0113
Insulin1                     -0.1082     0.0113     0.1082     0.0113
SU1                          -0.1037     0.0076     0.1037     0.0076
Diuretic1                    -0.0943    -0.0254     0.0943     0.0254
cancer1                      -0.0903    -0.0258     0.0903     0.0258
Antiplatelet1                -0.0720    -0.0106     0.0720     0.0106
raceethnicity_cat            -0.0669    -0.0269     0.0669     0.0269
Anticoagulant1               -0.0662    -0.0154     0.0662     0.0154
TZD1                         -0.0654    -0.0140     0.0654     0.0140
mc1                          -0.0608    -0.0153     0.0608     0.0153
Biguanide1                   -0.0563    -0.0035     0.0563     0.0035
DPP41                        -0.0551     0.0205     0.0551     0.0205
ctd1                          0.0543    -0.0057     0.0543     0.0057
mld1                         -0.0416     0.0035     0.0416     0.0035
dem1                          0.0404     0.0018     0.0404     0.0018
CCB1                         -0.0401     0.0175     0.0401     0.0175
pud1                         -0.0397    -0.0095     0.0397     0.0095
Ezetimibe1                   -0.0331    -0.0089     0.0331     0.0089
cpd1                          0.0326     0.0070     0.0326     0.0070
hiv1                         -0.0254     0.0056     0.0254     0.0056
OtherHTN1                     0.0173     0.0180     0.0173     0.0180
MRA1                         -0.0171    -0.0007     0.0171     0.0007
education                    -0.0136     0.0027     0.0136     0.0027
ph1                           0.0110    -0.0028     0.0110     0.0028
msld1                        -0.0076    -0.0056     0.0076     0.0056
sex_cat                      -0.0036     0.0034     0.0036     0.0034
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 14
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 36
Mean |SMD| before: 0.1023
Mean |SMD| after: 0.0117
Maximum |SMD| before: 0.4276 (baseline_bmi)
Maximum |SMD| after: 0.0311 (baseline_bmi)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_GLP1_vs_SGLT2_stroke.csv 


Debug: weighted_df columns: person_id glp1_idx sglt2_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 5121 
Debug: event_time_months range: 0 68.4954 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_GLP1_vs_SGLT2_stroke.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for GLP1 vs SGLT2 - stroke :
- Initial cohort (T2DM): 7034 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 5577 (excluded: 789 )
- After age filtering: 5121 (excluded: 0 )
- Final events: 171 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for stroke ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 5121 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, glp1_idx, sglt2_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       2775             2.45                 2775
2         1       1276             2.33                 1276
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 4051 out of 5121 
Patients with baseline HbA1c data: 5121 
Patients with weighted mean HbA1c data: 4051 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.05 SD: 1.87 
Weighted Mean HbA1c - Mean: 7.6 SD: 1.56 
Correlation between baseline and weighted mean: 0.752 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 4902 
Total events: 154 

Diagnostic after HbA1c filtering:
Remaining patients: 4902 
Remaining events: 154 
Events by treatment: 
   
       0    1
  0 3239  113
  1 1509   41

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
              Estimate Std. Error   t value     Pr(>|t|)
(Intercept)  8.8447531 0.13993443 63.206411 0.000000e+00
treatment   -0.2612398 0.04928394 -5.300709 1.217291e-07
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                Estimate Std. Error  z value     Pr(>|z|)
treatment      0.3142067 0.17886440 1.756675 7.897314e-02
hba1c_mean_6mo 0.2146842 0.04993244 4.299495 1.711881e-05

=== IPWT Mediation Analysis Summary for stroke ===
A path (Treatment -> HbA1c): -0.2612398 p = 1.217291e-07 
B path (HbA1c -> Outcome): 0.2146842 p = 1.711881e-05 
C path (Direct Effect): 0.3142067 p = 0.07897314 
Indirect Effect (A*B): -0.05608408 p = 0.0008403301 (Sobel test)
Total Effect (C + A*B): 0.2581226 

--- HbA1c Mediation Analysis End for stroke ---

========= HbA1c Trajectory Analysis: GLP1 vs SGLT2 - stroke =========
Rows: 1126922 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): person_id, A1c
date (1): date_of_measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Baseline HbA1c means (unweighted):
# A tibble: 2 × 3
  treatment unweighted_baseline n_baseline
      <dbl>               <dbl>      <int>
1         0                8.23       3514
2         1                7.65       1607


Linear Mixed Model Results (unweighted, adjusted for baseline HbA1c):
                         Estimate  Std. Error       df     t value
(Intercept)            1.25747307 0.036260209 6019.372  34.6791460
baseline_a1c           0.83109827 0.004221081 5903.655 196.8923040
years_since           -0.36904156 0.021236143 4196.220 -17.3779938
treatment             -0.11692239 0.017509758 6354.141  -6.6775559
years_since:treatment -0.01185804 0.037795041 4229.735  -0.3137459
                           Pr(>|t|)
(Intercept)           2.056733e-240
baseline_a1c           0.000000e+00
years_since            2.241686e-65
treatment              2.635444e-11
years_since:treatment  7.537295e-01

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 25645' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 25645)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 25645' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 25645)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 25645' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 25645)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 25645' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 25645)' or larger];
but be warned that this may result in large computation time and memory use.



==== HbA1c Trajectory LMM Results for stroke (IPWT) ====
                         Estimate  Std. Error      Pr(>|t|)
(Intercept)            1.25747307 0.036260209 2.056733e-240
baseline_a1c           0.83109827 0.004221081  0.000000e+00
years_since           -0.36904156 0.021236143  2.241686e-65
treatment             -0.11692239 0.017509758  2.635444e-11
years_since:treatment -0.01185804 0.037795041  7.537295e-01
# A tibble: 5 × 9
  effect term    estimate std.error statistic    df   p.value conf.low conf.high
  <chr>  <chr>      <dbl>     <dbl>     <dbl> <dbl>     <dbl>    <dbl>     <dbl>
1 fixed  (Inter…   1.26     0.0363     34.7   6019. 2.06e-240   1.19      1.33  
2 fixed  baseli…   0.831    0.00422   197.    5904. 0           0.823     0.839 
3 fixed  years_…  -0.369    0.0212    -17.4   4196. 2.24e- 65  -0.411    -0.327 
4 fixed  treatm…  -0.117    0.0175     -6.68  6354. 2.64e- 11  -0.151    -0.0826
5 fixed  years_…  -0.0119   0.0378     -0.314 4230. 7.54e-  1  -0.0860    0.0622

Estimated marginal means by time and treatment:
years_since = 0:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  8.021 0.00963 Inf     8.002     8.040
         1  7.904 0.01460 Inf     7.876     7.933

years_since = 1:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.652 0.02050 Inf     7.612     7.692
         1  7.524 0.03020 Inf     7.464     7.583

years_since = 2:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.283 0.04060 Inf     7.204     7.363
         1  7.143 0.05970 Inf     7.026     7.260

Degrees-of-freedom method: asymptotic 
Confidence level used: 0.95 

Treatment Effect (Baseline HbA1c difference): -0.117 (p = 2.64e-11 )
Time×Treatment Interaction (HbA1c change over time): -0.012 (p = 0.754 )

Cohort sizes for HbA1c trajectory analysis:
# A tibble: 2 × 3
  treatment     n weighted_n
      <dbl> <int>      <dbl>
1         0  3514      2592.
2         1  1607      2529.

========= IPWT Analysis: GLP1 vs SU_DPP4 - Epilepsy/Seizure =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 9746 
Treatment distribution: 7262 2484 

Raw outcome variable ( epilepsy_or_seizure_start_date ) summary:
Total patients with outcome dates: 714 
Total patients without outcome dates: 9032 
Outcome date range: 4253 to 19624 
===========================

Before excluding pre-existing Epilepsy/Seizure patients: 9746 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Epilepsy/Seizure diagnosed BEFORE index date (excluding): 474 
Patients eligible for analysis: 9272 
=======================================
After excluding pre-existing Epilepsy/Seizure patients: 9272 (excluded: 474 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 240 
Treatment distribution after exclusion: 6914 2358 
Outcome date range after exclusion: 17630 to 19624 
Outcomes occurring AFTER index date: 234 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                9218                      3                 87.0
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  8250                     31                 221.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 9272 
Patients with outcome dates: 240 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: epilepsy_or_seizure_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: FALSE 
- Input data rows: 9272 
- Patients with outcome dates: 240 
- Outcome date range: 17630 to 19624 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 7785 
- Raw events (before late-onset filter): 172 
- Events after time >= 0 filter: 172 
- Patients filtered out due to event_time < 0: 1056 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2098 
- Mean event_time: 978.8768 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 51                                 172 
No event - administrative censoring 
                               7993 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 8216 
Patients with events (event = 1): 172 
Patients without events (event = 0): 8044 
Event distribution by treatment:
   
       0    1
  0 5971  147
  1 2073   25

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   578.0   955.0   978.9  1425.0  2098.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 172 
Final events: 172 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  6118     33.8   7.90       32.6          49
2         1  2098     37.5   8.28       36.2           4

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          28    579       1492    1688     1154      1128   49
  1           3     59        300     534      509       689    4

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  6118       8.24     2.06          7.8           717
2         1  2098       7.74     1.86          7.4           132

Total sample size: 8216 
Total events: 172 

Index Year Distribution:

2018 2019 2020 2021 
2371 2323 1659 1863 
Note: Dropping 890 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          5362              35.0
2         1          1964              35.6

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        15.0       0.00387
 2         0 Normal            325.        0.0836 
 3         0 Overweight        853.        0.220  
 4         0 Obese I          1032.        0.266  
 5         0 Obese II          760.        0.196  
 6         0 Obese III         900.        0.232  
 7         1 Underweight        11.5       0.00336
 8         1 Normal            135.        0.0391 
 9         1 Overweight        621.        0.180  
10         1 Obese I          1006.        0.292  
11         1 Obese II          855.        0.248  
12         1 Obese III         813.        0.236  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            5362                8.13
2         1            1964                8.06
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_GLP1_vs_SU_DPP4_Epilepsy_Seizure.csv 

Standardized Mean Differences - Before Weighting (Top 10):
         variable std_diff
1      index_year  -0.8887
2    baseline_bmi   0.4405
3  baseline_hba1c  -0.2532
4          income  -0.1702
5             age  -0.1419
6             mc1  -0.1146
7            CCB1  -0.1108
8           RAAS1  -0.1030
9      Biguanide1  -0.1021
10       Insulin1   0.0968

Standardized Mean Differences - After Weighting (Top 10):
            variable std_diff
1         index_year  -0.0946
2       baseline_bmi   0.0767
3          Diuretic1  -0.0586
4               TZD1  -0.0473
5             income  -0.0473
6                rd1  -0.0423
7               CCB1  -0.0422
8                age  -0.0417
9            Statin1  -0.0377
10 raceethnicity_cat  -0.0371

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5361  0.5758  0.6914  1.0000  0.9857  6.9025 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  5362    136      3884.            89.2   0.0254        0.0230
2         1  1964     24      3442.            42.9   0.0122        0.0125

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 7326, number of events= 160 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)   
treatment -0.6792    0.5070   0.1858    0.2472 -2.748    0.006 **
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

          exp(coef) exp(-coef) lower .95 upper .95
treatment     0.507      1.972    0.3123     0.823

Concordance= 0.573  (se = 0.028 )
Likelihood ratio test= 14.21  on 1 df,   p=2e-04
Wald test            = 7.55  on 1 df,   p=0.006
Score (logrank) test = 13.88  on 1 df,   p=2e-04,   Robust = 11.17  p=8e-04

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: GLP1 vs SU_DPP4 - Epilepsy/Seizure 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
index_year                   -0.8887    -0.0946     0.8887     0.0946
baseline_bmi                  0.4405     0.0767     0.4405     0.0767
baseline_hba1c               -0.2532    -0.0330     0.2532     0.0330
income                       -0.1702    -0.0473     0.1702     0.0473
age                          -0.1419    -0.0417     0.1419     0.0417
mc1                          -0.1146    -0.0291     0.1146     0.0291
CCB1                         -0.1108    -0.0422     0.1108     0.0422
RAAS1                        -0.1030    -0.0159     0.1030     0.0159
Biguanide1                   -0.1021    -0.0200     0.1021     0.0200
Insulin1                      0.0968     0.0150     0.0968     0.0150
cpd1                          0.0859     0.0103     0.0859     0.0103
Statin1                      -0.0843    -0.0377     0.0843     0.0377
Diuretic1                    -0.0808    -0.0586     0.0808     0.0586
cvd1                         -0.0729    -0.0273     0.0729     0.0273
TZD1                         -0.0683    -0.0473     0.0683     0.0473
rd1                          -0.0660    -0.0423     0.0660     0.0423
ctd1                          0.0593     0.0176     0.0593     0.0176
BB1                          -0.0591    -0.0182     0.0591     0.0182
OtherHTN1                    -0.0444    -0.0149     0.0444     0.0149
Anticoagulant1               -0.0432    -0.0280     0.0432     0.0280
mld1                          0.0406     0.0171     0.0406     0.0171
chf1                         -0.0395    -0.0215     0.0395     0.0215
SGLT21                        0.0385     0.0154     0.0385     0.0154
Antiplatelet1                -0.0375     0.0056     0.0375     0.0056
pud1                         -0.0348     0.0004     0.0348     0.0004
pvd1                         -0.0275    -0.0241     0.0275     0.0241
sex_cat                      -0.0231     0.0241     0.0231     0.0241
cancer1                      -0.0193    -0.0035     0.0193     0.0035
mi1                          -0.0161    -0.0246     0.0161     0.0246
ph1                           0.0141     0.0248     0.0141     0.0248
MRA1                          0.0129    -0.0111     0.0129     0.0111
education                    -0.0115    -0.0187     0.0115     0.0187
dem1                          0.0103    -0.0254     0.0103     0.0254
msld1                        -0.0096    -0.0110     0.0096     0.0110
raceethnicity_cat            -0.0079    -0.0371     0.0079     0.0371
Ezetimibe1                    0.0050    -0.0093     0.0050     0.0093
hiv1                          0.0018     0.0036     0.0018     0.0036
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 9
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 28
Mean |SMD| before: 0.0929
Mean |SMD| after: 0.0269
Maximum |SMD| before: 0.8887 (index_year)
Maximum |SMD| after: 0.0946 (index_year)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_GLP1_vs_SU_DPP4_Epilepsy_Seizure.csv 


Debug: weighted_df columns: person_id glp1_idx su_dpp4_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 7326 
Debug: event_time_months range: 0 68.92247 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_GLP1_vs_SU_DPP4_Epilepsy_Seizure.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for GLP1 vs SU_DPP4 - Epilepsy/Seizure :
- Initial cohort (T2DM): 9746 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 8216 (excluded: 1056 )
- After age filtering: 7326 (excluded: 0 )
- Final events: 160 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for Epilepsy/Seizure ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 7326 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, glp1_idx, su_dpp4_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       3980             2.25                 3980
2         1       1606             2.38                 1606
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 5586 out of 7326 
Patients with baseline HbA1c data: 7326 
Patients with weighted mean HbA1c data: 5586 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.11 SD: 2.02 
Weighted Mean HbA1c - Mean: 7.7 SD: 1.75 
Correlation between baseline and weighted mean: 0.762 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 6968 
Total events: 141 

Diagnostic after HbA1c filtering:
Remaining patients: 6968 
Remaining events: 141 
Events by treatment: 
   
       0    1
  0 4946  121
  1 1881   20

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
              Estimate Std. Error  t value     Pr(>|t|)
(Intercept)  9.3121340 0.12274587 75.86515 0.000000e+00
treatment   -0.3684148 0.04457093 -8.26581 1.733636e-16
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                  Estimate Std. Error   z value     Pr(>|z|)
treatment      -0.80315812  0.2328659 -3.449016 0.0005626339
hba1c_mean_6mo  0.08458911  0.0590541  1.432400 0.1520292821

=== IPWT Mediation Analysis Summary for Epilepsy/Seizure ===
A path (Treatment -> HbA1c): -0.3684148 p = 1.733636e-16 
B path (HbA1c -> Outcome): 0.08458911 p = 0.1520293 
C path (Direct Effect): -0.8031581 p = 0.0005626339 
Indirect Effect (A*B): -0.03116388 p = 0.1581369 (Sobel test)
Total Effect (C + A*B): -0.834322 

--- HbA1c Mediation Analysis End for Epilepsy/Seizure ---

========= HbA1c Trajectory Analysis: GLP1 vs SU_DPP4 - Epilepsy/Seizure =========
Rows: 1126922 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): person_id, A1c
date (1): date_of_measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Baseline HbA1c means (unweighted):
# A tibble: 2 × 3
  treatment unweighted_baseline n_baseline
      <dbl>               <dbl>      <int>
1         0                8.24       5362
2         1                7.74       1964


Linear Mixed Model Results (unweighted, adjusted for baseline HbA1c):
                         Estimate  Std. Error       df    t value     Pr(>|t|)
(Intercept)            1.31593059 0.032301449 8829.733  40.739058 0.000000e+00
baseline_a1c           0.82255684 0.003735105 8648.089 220.223196 0.000000e+00
years_since           -0.31977614 0.020195371 5509.213 -15.834130 2.948973e-55
treatment             -0.09316217 0.017216445 8534.810  -5.411232 6.428946e-08
years_since:treatment -0.06588508 0.036878462 5324.344  -1.786546 7.406774e-02

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 33374' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 33374)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 33374' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 33374)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 33374' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 33374)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 33374' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 33374)' or larger];
but be warned that this may result in large computation time and memory use.



==== HbA1c Trajectory LMM Results for Epilepsy/Seizure (IPWT) ====
                         Estimate  Std. Error     Pr(>|t|)
(Intercept)            1.31593059 0.032301449 0.000000e+00
baseline_a1c           0.82255684 0.003735105 0.000000e+00
years_since           -0.31977614 0.020195371 2.948973e-55
treatment             -0.09316217 0.017216445 6.428946e-08
years_since:treatment -0.06588508 0.036878462 7.406774e-02
# A tibble: 5 × 9
  effect term     estimate std.error statistic    df  p.value conf.low conf.high
  <chr>  <chr>       <dbl>     <dbl>     <dbl> <dbl>    <dbl>    <dbl>     <dbl>
1 fixed  (Interc…   1.32     0.0323      40.7  8830. 0           1.25    1.38   
2 fixed  baselin…   0.823    0.00374    220.   8648. 0           0.815   0.830  
3 fixed  years_s…  -0.320    0.0202     -15.8  5509. 2.95e-55   -0.359  -0.280  
4 fixed  treatme…  -0.0932   0.0172      -5.41 8535. 6.43e- 8   -0.127  -0.0594 
5 fixed  years_s…  -0.0659   0.0369      -1.79 5324. 7.41e- 2   -0.138   0.00641

Estimated marginal means by time and treatment:
years_since = 0:
 treatment emmean     SE  df asymp.LCL asymp.UCL
         0  8.030 0.0092 Inf     8.012     8.048
         1  7.937 0.0145 Inf     7.908     7.965

years_since = 1:
 treatment emmean     SE  df asymp.LCL asymp.UCL
         0  7.710 0.0194 Inf     7.672     7.748
         1  7.551 0.0298 Inf     7.493     7.610

years_since = 2:
 treatment emmean     SE  df asymp.LCL asymp.UCL
         0  7.390 0.0385 Inf     7.315     7.466
         1  7.166 0.0589 Inf     7.050     7.281

Degrees-of-freedom method: asymptotic 
Confidence level used: 0.95 

Treatment Effect (Baseline HbA1c difference): -0.093 (p = 6.43e-08 )
Time×Treatment Interaction (HbA1c change over time): -0.066 (p = 0.0741 )

Cohort sizes for HbA1c trajectory analysis:
# A tibble: 2 × 3
  treatment     n weighted_n
      <dbl> <int>      <dbl>
1         0  5362      3884.
2         1  1964      3442.

========= IPWT Analysis: GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 9746 
Treatment distribution: 7262 2484 

Raw outcome variable ( epilepsy_or_seizure_start_date ) summary:
Total patients with outcome dates: 714 
Total patients without outcome dates: 9032 
Outcome date range: 4253 to 19624 
===========================

Before excluding pre-existing Early-onset Epilepsy/Seizure patients: 9746 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Epilepsy/Seizure diagnosed BEFORE index date (excluding): 474 
Patients eligible for analysis: 9272 
=======================================
After excluding pre-existing Early-onset Epilepsy/Seizure patients: 9272 (excluded: 474 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 240 
Treatment distribution after exclusion: 6914 2358 
Outcome date range after exclusion: 17630 to 19624 
Outcomes occurring AFTER index date: 234 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                9218                      3                 87.0
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  8250                     31                 221.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 9272 
Patients with outcome dates: 240 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: epilepsy_or_seizure_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: TRUE 
- Input data rows: 9272 
- Patients with outcome dates: 240 
- Outcome date range: 17630 to 19624 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 7785 
- Raw events (before late-onset filter): 172 
- Events after time >= 0 filter: 24 
- Patients filtered out due to event_time < 0: 1056 
- Early-onset applied: events with age < 50: 24 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2098 
- Mean event_time: 978.8768 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 51                                 172 
No event - administrative censoring 
                               7993 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 8216 
Patients with events (event = 1): 24 
Patients without events (event = 0): 8192 
Event distribution by treatment:
   
       0    1
  0 6100   18
  1 2092    6

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   578.0   955.0   978.9  1425.0  2098.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 172 
Final events: 24 
Early onset filter applied (age < 50)
Events with age_at_event < 50: 24 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  6118     33.8   7.90       32.6          49
2         1  2098     37.5   8.28       36.2           4

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          28    579       1492    1688     1154      1128   49
  1           3     59        300     534      509       689    4

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  6118       8.24     2.06          7.8           717
2         1  2098       7.74     1.86          7.4           132

Total sample size: 8216 
Total events: 24 

Index Year Distribution:

2018 2019 2020 2021 
2371 2323 1659 1863 
Note: Dropping 890 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          5362              35.0
2         1          1964              35.6

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        15.0       0.00387
 2         0 Normal            325.        0.0836 
 3         0 Overweight        853.        0.220  
 4         0 Obese I          1032.        0.266  
 5         0 Obese II          760.        0.196  
 6         0 Obese III         900.        0.232  
 7         1 Underweight        11.5       0.00336
 8         1 Normal            135.        0.0391 
 9         1 Overweight        621.        0.180  
10         1 Obese I          1006.        0.292  
11         1 Obese II          855.        0.248  
12         1 Obese III         813.        0.236  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            5362                8.13
2         1            1964                8.06
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_GLP1_vs_SU_DPP4_Early-onset_Epilepsy_Seizure.csv 

Standardized Mean Differences - Before Weighting (Top 10):
         variable std_diff
1      index_year  -0.8887
2    baseline_bmi   0.4405
3  baseline_hba1c  -0.2532
4          income  -0.1702
5             age  -0.1419
6             mc1  -0.1146
7            CCB1  -0.1108
8           RAAS1  -0.1030
9      Biguanide1  -0.1021
10       Insulin1   0.0968

Standardized Mean Differences - After Weighting (Top 10):
            variable std_diff
1         index_year  -0.0946
2       baseline_bmi   0.0767
3          Diuretic1  -0.0586
4               TZD1  -0.0473
5             income  -0.0473
6                rd1  -0.0423
7               CCB1  -0.0422
8                age  -0.0417
9            Statin1  -0.0377
10 raceethnicity_cat  -0.0371

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5361  0.5758  0.6914  1.0000  0.9857  6.9025 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  5362     17      3884.            11.4  0.00317       0.00293
2         1  1964      6      3442.            13.5  0.00305       0.00393

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 7326, number of events= 23 

            coef exp(coef) se(coef) robust se     z Pr(>|z|)
treatment 0.2117    1.2358   0.4023    0.5445 0.389    0.697

          exp(coef) exp(-coef) lower .95 upper .95
treatment     1.236     0.8092    0.4251     3.593

Concordance= 0.53  (se = 0.069 )
Likelihood ratio test= 0.28  on 1 df,   p=0.6
Wald test            = 0.15  on 1 df,   p=0.7
Score (logrank) test = 0.28  on 1 df,   p=0.6,   Robust = 0.13  p=0.7

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
index_year                   -0.8887    -0.0946     0.8887     0.0946
baseline_bmi                  0.4405     0.0767     0.4405     0.0767
baseline_hba1c               -0.2532    -0.0330     0.2532     0.0330
income                       -0.1702    -0.0473     0.1702     0.0473
age                          -0.1419    -0.0417     0.1419     0.0417
mc1                          -0.1146    -0.0291     0.1146     0.0291
CCB1                         -0.1108    -0.0422     0.1108     0.0422
RAAS1                        -0.1030    -0.0159     0.1030     0.0159
Biguanide1                   -0.1021    -0.0200     0.1021     0.0200
Insulin1                      0.0968     0.0150     0.0968     0.0150
cpd1                          0.0859     0.0103     0.0859     0.0103
Statin1                      -0.0843    -0.0377     0.0843     0.0377
Diuretic1                    -0.0808    -0.0586     0.0808     0.0586
cvd1                         -0.0729    -0.0273     0.0729     0.0273
TZD1                         -0.0683    -0.0473     0.0683     0.0473
rd1                          -0.0660    -0.0423     0.0660     0.0423
ctd1                          0.0593     0.0176     0.0593     0.0176
BB1                          -0.0591    -0.0182     0.0591     0.0182
OtherHTN1                    -0.0444    -0.0149     0.0444     0.0149
Anticoagulant1               -0.0432    -0.0280     0.0432     0.0280
mld1                          0.0406     0.0171     0.0406     0.0171
chf1                         -0.0395    -0.0215     0.0395     0.0215
SGLT21                        0.0385     0.0154     0.0385     0.0154
Antiplatelet1                -0.0375     0.0056     0.0375     0.0056
pud1                         -0.0348     0.0004     0.0348     0.0004
pvd1                         -0.0275    -0.0241     0.0275     0.0241
sex_cat                      -0.0231     0.0241     0.0231     0.0241
cancer1                      -0.0193    -0.0035     0.0193     0.0035
mi1                          -0.0161    -0.0246     0.0161     0.0246
ph1                           0.0141     0.0248     0.0141     0.0248
MRA1                          0.0129    -0.0111     0.0129     0.0111
education                    -0.0115    -0.0187     0.0115     0.0187
dem1                          0.0103    -0.0254     0.0103     0.0254
msld1                        -0.0096    -0.0110     0.0096     0.0110
raceethnicity_cat            -0.0079    -0.0371     0.0079     0.0371
Ezetimibe1                    0.0050    -0.0093     0.0050     0.0093
hiv1                          0.0018     0.0036     0.0018     0.0036
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 9
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 28
Mean |SMD| before: 0.0929
Mean |SMD| after: 0.0269
Maximum |SMD| before: 0.8887 (index_year)
Maximum |SMD| after: 0.0946 (index_year)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_GLP1_vs_SU_DPP4_Early-onset_Epilepsy_Seizure.csv 


Debug: weighted_df columns: person_id glp1_idx su_dpp4_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 7326 
Debug: event_time_months range: 0 68.92247 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_GLP1_vs_SU_DPP4_Early-onset_Epilepsy_Seizure.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure :
- Initial cohort (T2DM): 9746 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 8216 (excluded: 1056 )
- After age filtering: 7326 (excluded: 0 )
- Final events: 23 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for Early-onset Epilepsy/Seizure ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 7326 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, glp1_idx, su_dpp4_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       3980             2.25                 3980
2         1       1606             2.38                 1606
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 5586 out of 7326 
Patients with baseline HbA1c data: 7326 
Patients with weighted mean HbA1c data: 5586 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.11 SD: 2.02 
Weighted Mean HbA1c - Mean: 7.7 SD: 1.75 
Correlation between baseline and weighted mean: 0.762 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 6968 
Total events: 141 

Diagnostic after HbA1c filtering:
Remaining patients: 6968 
Remaining events: 141 
Events by treatment: 
   
       0    1
  0 4946  121
  1 1881   20

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
              Estimate Std. Error  t value     Pr(>|t|)
(Intercept)  9.3121340 0.12274587 75.86515 0.000000e+00
treatment   -0.3684148 0.04457093 -8.26581 1.733636e-16
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                  Estimate Std. Error   z value     Pr(>|z|)
treatment      -0.80315812  0.2328659 -3.449016 0.0005626339
hba1c_mean_6mo  0.08458911  0.0590541  1.432400 0.1520292821

=== IPWT Mediation Analysis Summary for Early-onset Epilepsy/Seizure ===
A path (Treatment -> HbA1c): -0.3684148 p = 1.733636e-16 
B path (HbA1c -> Outcome): 0.08458911 p = 0.1520293 
C path (Direct Effect): -0.8031581 p = 0.0005626339 
Indirect Effect (A*B): -0.03116388 p = 0.1581369 (Sobel test)
Total Effect (C + A*B): -0.834322 

--- HbA1c Mediation Analysis End for Early-onset Epilepsy/Seizure ---

========= HbA1c Trajectory Analysis: GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure =========
Rows: 1126922 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): person_id, A1c
date (1): date_of_measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Baseline HbA1c means (unweighted):
# A tibble: 2 × 3
  treatment unweighted_baseline n_baseline
      <dbl>               <dbl>      <int>
1         0                8.24       5362
2         1                7.74       1964


Linear Mixed Model Results (unweighted, adjusted for baseline HbA1c):
                         Estimate  Std. Error       df    t value     Pr(>|t|)
(Intercept)            1.31593059 0.032301449 8829.733  40.739058 0.000000e+00
baseline_a1c           0.82255684 0.003735105 8648.089 220.223196 0.000000e+00
years_since           -0.31977614 0.020195371 5509.213 -15.834130 2.948973e-55
treatment             -0.09316217 0.017216445 8534.810  -5.411232 6.428946e-08
years_since:treatment -0.06588508 0.036878462 5324.344  -1.786546 7.406774e-02

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 33374' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 33374)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 33374' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 33374)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 33374' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 33374)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 33374' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 33374)' or larger];
but be warned that this may result in large computation time and memory use.



==== HbA1c Trajectory LMM Results for Early-onset Epilepsy/Seizure (IPWT) ====
                         Estimate  Std. Error     Pr(>|t|)
(Intercept)            1.31593059 0.032301449 0.000000e+00
baseline_a1c           0.82255684 0.003735105 0.000000e+00
years_since           -0.31977614 0.020195371 2.948973e-55
treatment             -0.09316217 0.017216445 6.428946e-08
years_since:treatment -0.06588508 0.036878462 7.406774e-02
# A tibble: 5 × 9
  effect term     estimate std.error statistic    df  p.value conf.low conf.high
  <chr>  <chr>       <dbl>     <dbl>     <dbl> <dbl>    <dbl>    <dbl>     <dbl>
1 fixed  (Interc…   1.32     0.0323      40.7  8830. 0           1.25    1.38   
2 fixed  baselin…   0.823    0.00374    220.   8648. 0           0.815   0.830  
3 fixed  years_s…  -0.320    0.0202     -15.8  5509. 2.95e-55   -0.359  -0.280  
4 fixed  treatme…  -0.0932   0.0172      -5.41 8535. 6.43e- 8   -0.127  -0.0594 
5 fixed  years_s…  -0.0659   0.0369      -1.79 5324. 7.41e- 2   -0.138   0.00641

Estimated marginal means by time and treatment:
years_since = 0:
 treatment emmean     SE  df asymp.LCL asymp.UCL
         0  8.030 0.0092 Inf     8.012     8.048
         1  7.937 0.0145 Inf     7.908     7.965

years_since = 1:
 treatment emmean     SE  df asymp.LCL asymp.UCL
         0  7.710 0.0194 Inf     7.672     7.748
         1  7.551 0.0298 Inf     7.493     7.610

years_since = 2:
 treatment emmean     SE  df asymp.LCL asymp.UCL
         0  7.390 0.0385 Inf     7.315     7.466
         1  7.166 0.0589 Inf     7.050     7.281

Degrees-of-freedom method: asymptotic 
Confidence level used: 0.95 

Treatment Effect (Baseline HbA1c difference): -0.093 (p = 6.43e-08 )
Time×Treatment Interaction (HbA1c change over time): -0.066 (p = 0.0741 )

Cohort sizes for HbA1c trajectory analysis:
# A tibble: 2 × 3
  treatment     n weighted_n
      <dbl> <int>      <dbl>
1         0  5362      3884.
2         1  1964      3442.

========= IPWT Analysis: GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 9746 
Treatment distribution: 7262 2484 

Raw outcome variable ( epilepsy_or_seizure_start_date ) summary:
Total patients with outcome dates: 714 
Total patients without outcome dates: 9032 
Outcome date range: 4253 to 19624 
===========================

Before excluding pre-existing Late-onset Epilepsy/Seizure patients: 9746 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Epilepsy/Seizure diagnosed BEFORE index date (excluding): 474 
Patients eligible for analysis: 9272 
=======================================
After excluding pre-existing Late-onset Epilepsy/Seizure patients: 9272 (excluded: 474 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 240 
Treatment distribution after exclusion: 6914 2358 
Outcome date range after exclusion: 17630 to 19624 
Outcomes occurring AFTER index date: 234 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                9218                      3                 87.0
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  8250                     31                 221.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 9272 
Patients with outcome dates: 240 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: epilepsy_or_seizure_start_date 
- data_cut_date: 2023-10-01 
- late_onset: TRUE 
- early_onset: FALSE 
- Input data rows: 9272 
- Patients with outcome dates: 240 
- Outcome date range: 17630 to 19624 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 7785 
- Raw events (before late-onset filter): 172 
- Events after time >= 0 filter: 148 
- Patients filtered out due to event_time < 0: 1056 
- Late-onset applied: events with age >= 50: 148 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2098 
- Mean event_time: 978.8768 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 51                                 172 
No event - administrative censoring 
                               7993 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 8216 
Patients with events (event = 1): 148 
Patients without events (event = 0): 8068 
Event distribution by treatment:
   
       0    1
  0 5989  129
  1 2079   19

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   578.0   955.0   978.9  1425.0  2098.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 172 
Final events: 148 
Late onset filter applied (age >= 50)
Events with age_at_event >= 50: 148 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  6118     33.8   7.90       32.6          49
2         1  2098     37.5   8.28       36.2           4

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          28    579       1492    1688     1154      1128   49
  1           3     59        300     534      509       689    4

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  6118       8.24     2.06          7.8           717
2         1  2098       7.74     1.86          7.4           132

Total sample size: 8216 
Total events: 148 

Index Year Distribution:

2018 2019 2020 2021 
2371 2323 1659 1863 
Note: Dropping 890 rows with missing values in covariates
After age filtering (>= 50 ): samples = 6387 , events = 135 

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          4730              34.3
2         1          1657              35.0

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        11.8       0.00349
 2         0 Normal            297.        0.0880 
 3         0 Overweight        778.        0.230  
 4         0 Obese I           935.        0.277  
 5         0 Obese II          667.        0.198  
 6         0 Obese III         686.        0.203  
 7         1 Underweight        11.5       0.00388
 8         1 Normal            125.        0.0418 
 9         1 Overweight        568.        0.191  
10         1 Obese I           896.        0.301  
11         1 Obese II          745.        0.250  
12         1 Obese III         631.        0.212  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            4730                8.05
2         1            1657                7.99
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_GLP1_vs_SU_DPP4_Late-onset_Epilepsy_Seizure.csv 

Standardized Mean Differences - Before Weighting (Top 10):
         variable std_diff
1      index_year  -0.8887
2    baseline_bmi   0.4405
3  baseline_hba1c  -0.2532
4          income  -0.1702
5             age  -0.1419
6             mc1  -0.1146
7            CCB1  -0.1108
8           RAAS1  -0.1030
9      Biguanide1  -0.1021
10       Insulin1   0.0968

Standardized Mean Differences - After Weighting (Top 10):
            variable std_diff
1         index_year  -0.0946
2       baseline_bmi   0.0767
3          Diuretic1  -0.0586
4               TZD1  -0.0473
5             income  -0.0473
6                rd1  -0.0423
7               CCB1  -0.0422
8                age  -0.0417
9            Statin1  -0.0377
10 raceethnicity_cat  -0.0371

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5361  0.5720  0.6827  0.9942  0.9771  6.9025 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  4730    117      3374.            76.6   0.0247       0.0227 
2         1  1657     18      2977.            29.4   0.0109       0.00988

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 7326, number of events= 137 

             coef exp(coef) se(coef) robust se    z Pr(>|z|)    
treatment -0.9184    0.3992   0.2166    0.2701 -3.4 0.000675 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.3992      2.505    0.2351    0.6778

Concordance= 0.596  (se = 0.028 )
Likelihood ratio test= 20.07  on 1 df,   p=7e-06
Wald test            = 11.56  on 1 df,   p=7e-04
Score (logrank) test = 19.27  on 1 df,   p=1e-05,   Robust = 18.58  p=2e-05

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
index_year                   -0.8887    -0.0946     0.8887     0.0946
baseline_bmi                  0.4405     0.0767     0.4405     0.0767
baseline_hba1c               -0.2532    -0.0330     0.2532     0.0330
income                       -0.1702    -0.0473     0.1702     0.0473
age                          -0.1419    -0.0417     0.1419     0.0417
mc1                          -0.1146    -0.0291     0.1146     0.0291
CCB1                         -0.1108    -0.0422     0.1108     0.0422
RAAS1                        -0.1030    -0.0159     0.1030     0.0159
Biguanide1                   -0.1021    -0.0200     0.1021     0.0200
Insulin1                      0.0968     0.0150     0.0968     0.0150
cpd1                          0.0859     0.0103     0.0859     0.0103
Statin1                      -0.0843    -0.0377     0.0843     0.0377
Diuretic1                    -0.0808    -0.0586     0.0808     0.0586
cvd1                         -0.0729    -0.0273     0.0729     0.0273
TZD1                         -0.0683    -0.0473     0.0683     0.0473
rd1                          -0.0660    -0.0423     0.0660     0.0423
ctd1                          0.0593     0.0176     0.0593     0.0176
BB1                          -0.0591    -0.0182     0.0591     0.0182
OtherHTN1                    -0.0444    -0.0149     0.0444     0.0149
Anticoagulant1               -0.0432    -0.0280     0.0432     0.0280
mld1                          0.0406     0.0171     0.0406     0.0171
chf1                         -0.0395    -0.0215     0.0395     0.0215
SGLT21                        0.0385     0.0154     0.0385     0.0154
Antiplatelet1                -0.0375     0.0056     0.0375     0.0056
pud1                         -0.0348     0.0004     0.0348     0.0004
pvd1                         -0.0275    -0.0241     0.0275     0.0241
sex_cat                      -0.0231     0.0241     0.0231     0.0241
cancer1                      -0.0193    -0.0035     0.0193     0.0035
mi1                          -0.0161    -0.0246     0.0161     0.0246
ph1                           0.0141     0.0248     0.0141     0.0248
MRA1                          0.0129    -0.0111     0.0129     0.0111
education                    -0.0115    -0.0187     0.0115     0.0187
dem1                          0.0103    -0.0254     0.0103     0.0254
msld1                        -0.0096    -0.0110     0.0096     0.0110
raceethnicity_cat            -0.0079    -0.0371     0.0079     0.0371
Ezetimibe1                    0.0050    -0.0093     0.0050     0.0093
hiv1                          0.0018     0.0036     0.0018     0.0036
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 9
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 28
Mean |SMD| before: 0.0929
Mean |SMD| after: 0.0269
Maximum |SMD| before: 0.8887 (index_year)
Maximum |SMD| after: 0.0946 (index_year)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_GLP1_vs_SU_DPP4_Late-onset_Epilepsy_Seizure.csv 


Debug: weighted_df columns: person_id glp1_idx su_dpp4_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 6387 
Debug: event_time_months range: 0 68.92247 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_GLP1_vs_SU_DPP4_Late-onset_Epilepsy_Seizure.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure :
- Initial cohort (T2DM): 9746 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 8216 (excluded: 1056 )
- After age filtering: 6387 (excluded: 939 )
- Final events: 135 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for Late-onset Epilepsy/Seizure ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 6387 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, glp1_idx, su_dpp4_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       3501             2.27                 3501
2         1       1371             2.42                 1371
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 4872 out of 6387 
Patients with baseline HbA1c data: 6387 
Patients with weighted mean HbA1c data: 4872 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.04 SD: 1.96 
Weighted Mean HbA1c - Mean: 7.65 SD: 1.68 
Correlation between baseline and weighted mean: 0.755 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 6088 
Total events: 119 

Diagnostic after HbA1c filtering:
Remaining patients: 6088 
Remaining events: 119 
Events by treatment: 
   
       0    1
  0 4377  103
  1 1592   16

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
              Estimate Std. Error   t value    Pr(>|t|)
(Intercept)  9.9238124 0.17341533 57.225694 0.00000e+00
treatment   -0.3252479 0.04578166 -7.104329 1.39179e-12
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                  Estimate Std. Error    z value     Pr(>|z|)
treatment      -0.84659714 0.25388011 -3.3346336 0.0008541187
hba1c_mean_6mo  0.03156618 0.07062485  0.4469557 0.6549070321

=== IPWT Mediation Analysis Summary for Late-onset Epilepsy/Seizure ===
A path (Treatment -> HbA1c): -0.3252479 p = 1.39179e-12 
B path (HbA1c -> Outcome): 0.03156618 p = 0.654907 
C path (Direct Effect): -0.8465971 p = 0.0008541187 
Indirect Effect (A*B): -0.01026683 p = 0.6555439 (Sobel test)
Total Effect (C + A*B): -0.856864 

--- HbA1c Mediation Analysis End for Late-onset Epilepsy/Seizure ---

========= HbA1c Trajectory Analysis: GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure =========
Rows: 1126922 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): person_id, A1c
date (1): date_of_measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Baseline HbA1c means (unweighted):
# A tibble: 2 × 3
  treatment unweighted_baseline n_baseline
      <dbl>               <dbl>      <int>
1         0                8.16       4730
2         1                7.71       1657


Linear Mixed Model Results (unweighted, adjusted for baseline HbA1c):
                         Estimate  Std. Error       df    t value      Pr(>|t|)
(Intercept)            1.34271195 0.034235556 7579.133  39.219809 1.750731e-306
baseline_a1c           0.81796825 0.004005653 7393.997 204.203456  0.000000e+00
years_since           -0.31964572 0.020645459 4940.542 -15.482616  7.785047e-53
treatment             -0.07884433 0.018008130 7299.684  -4.378263  1.212974e-05
years_since:treatment -0.05920907 0.038117322 4745.880  -1.553338  1.204092e-01

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 29487' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 29487)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 29487' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 29487)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 29487' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 29487)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 29487' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 29487)' or larger];
but be warned that this may result in large computation time and memory use.



==== HbA1c Trajectory LMM Results for Late-onset Epilepsy/Seizure (IPWT) ====
                         Estimate  Std. Error      Pr(>|t|)
(Intercept)            1.34271195 0.034235556 1.750731e-306
baseline_a1c           0.81796825 0.004005653  0.000000e+00
years_since           -0.31964572 0.020645459  7.785047e-53
treatment             -0.07884433 0.018008130  1.212974e-05
years_since:treatment -0.05920907 0.038117322  1.204092e-01
# A tibble: 5 × 9
  effect term    estimate std.error statistic    df   p.value conf.low conf.high
  <chr>  <chr>      <dbl>     <dbl>     <dbl> <dbl>     <dbl>    <dbl>     <dbl>
1 fixed  (Inter…   1.34     0.0342      39.2  7579. 1.75e-306    1.28     1.41  
2 fixed  baseli…   0.818    0.00401    204.   7394. 0            0.810    0.826 
3 fixed  years_…  -0.320    0.0206     -15.5  4941. 7.79e- 53   -0.360   -0.279 
4 fixed  treatm…  -0.0788   0.0180      -4.38 7300. 1.21e-  5   -0.114   -0.0435
5 fixed  years_…  -0.0592   0.0381      -1.55 4746. 1.20e-  1   -0.134    0.0155

Estimated marginal means by time and treatment:
years_since = 0:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.972 0.00952 Inf     7.954     7.991
         1  7.893 0.01530 Inf     7.864     7.923

years_since = 1:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.653 0.01990 Inf     7.614     7.692
         1  7.515 0.03100 Inf     7.454     7.575

years_since = 2:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.333 0.03940 Inf     7.256     7.410
         1  7.136 0.06110 Inf     7.016     7.256

Degrees-of-freedom method: asymptotic 
Confidence level used: 0.95 

Treatment Effect (Baseline HbA1c difference): -0.079 (p = 1.21e-05 )
Time×Treatment Interaction (HbA1c change over time): -0.059 (p = 0.12 )

Cohort sizes for HbA1c trajectory analysis:
# A tibble: 2 × 3
  treatment     n weighted_n
      <dbl> <int>      <dbl>
1         0  4730      3374.
2         1  1657      2977.

========= IPWT Analysis: GLP1 vs SU_DPP4 - ADRD =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 9746 
Treatment distribution: 7262 2484 

Raw outcome variable ( adrd_start_date ) summary:
Total patients with outcome dates: 588 
Total patients without outcome dates: 9158 
Outcome date range: 5598 to 19629 
===========================

Before excluding pre-existing ADRD patients: 9746 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
ADRD diagnosed BEFORE index date (excluding): 263 
Patients eligible for analysis: 9483 
=======================================
After excluding pre-existing ADRD patients: 9483 (excluded: 263 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 325 
Treatment distribution after exclusion: 7085 2398 
Outcome date range after exclusion: 17618 to 19629 
Outcomes occurring AFTER index date: 322 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                9428                      3                 87.0
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  8449                     32                 223.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 9483 
Patients with outcome dates: 325 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: adrd_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: FALSE 
- Input data rows: 9483 
- Patients with outcome dates: 325 
- Outcome date range: 17618 to 19629 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 7955 
- Raw events (before late-onset filter): 243 
- Events after time >= 0 filter: 243 
- Patients filtered out due to event_time < 0: 1094 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2098 
- Mean event_time: 977.3139 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 57                                 243 
No event - administrative censoring 
                               8089 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 8389 
Patients with events (event = 1): 243 
Patients without events (event = 0): 8146 
Event distribution by treatment:
   
       0    1
  0 6057  203
  1 2089   40

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   576.0   953.0   977.3  1422.0  2098.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 243 
Final events: 243 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  6260     33.9   7.97       32.7          50
2         1  2129     37.6   8.37       36.3           4

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          29    594       1514    1722     1182      1169   50
  1           4     58        305     533      518       707    4

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  6260       8.23     2.06          7.7           725
2         1  2129       7.75     1.87          7.4           134

Total sample size: 8389 
Total events: 243 

Index Year Distribution:

2018 2019 2020 2021 
2439 2358 1712 1880 
Excluding 'dem' covariate for ADRD outcome analysis
Note: Dropping 902 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          5494              35.1
2         1          1993              35.8

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        15.7       0.00394
 2         0 Normal            332.        0.0834 
 3         0 Overweight        867.        0.218  
 4         0 Obese I          1057.        0.266  
 5         0 Obese II          778.        0.196  
 6         0 Obese III         929.        0.233  
 7         1 Underweight        13.2       0.00376
 8         1 Normal            133.        0.0378 
 9         1 Overweight        629.        0.179  
10         1 Obese I          1008.        0.287  
11         1 Obese II          875.        0.249  
12         1 Obese III         850.        0.242  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            5494                8.12
2         1            1993                8.06
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_GLP1_vs_SU_DPP4_ADRD.csv 

Standardized Mean Differences - Before Weighting (Top 10):
         variable std_diff
1      index_year  -0.8807
2    baseline_bmi   0.4385
3  baseline_hba1c  -0.2457
4          income  -0.1638
5             age  -0.1478
6            CCB1  -0.1137
7             mc1  -0.1068
8      Biguanide1  -0.1052
9           RAAS1  -0.0991
10       Insulin1   0.0972

Standardized Mean Differences - After Weighting (Top 10):
            variable std_diff
1         index_year  -0.1007
2       baseline_bmi   0.0826
3          Diuretic1  -0.0527
4               TZD1  -0.0482
5                rd1  -0.0439
6             income  -0.0431
7               CCB1  -0.0411
8                age  -0.0407
9  raceethnicity_cat  -0.0367
10           Statin1  -0.0362

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5375  0.5769  0.6911  1.0000  0.9868  6.7663 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  5494    190      3979.           126.    0.0346        0.0318
2         1  1993     39      3508.            70.8   0.0196        0.0202

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 7487, number of events= 229 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)  
treatment -0.5115    0.5996   0.1486    0.2074 -2.466   0.0136 *
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.5996      1.668    0.3993    0.9003

Concordance= 0.561  (se = 0.024 )
Likelihood ratio test= 12.3  on 1 df,   p=5e-04
Wald test            = 6.08  on 1 df,   p=0.01
Score (logrank) test = 12.11  on 1 df,   p=5e-04,   Robust = 8.26  p=0.004

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: GLP1 vs SU_DPP4 - ADRD 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
index_year                   -0.8807    -0.1007     0.8807     0.1007
baseline_bmi                  0.4385     0.0826     0.4385     0.0826
baseline_hba1c               -0.2457    -0.0301     0.2457     0.0301
income                       -0.1638    -0.0431     0.1638     0.0431
age                          -0.1478    -0.0407     0.1478     0.0407
CCB1                         -0.1137    -0.0411     0.1137     0.0411
mc1                          -0.1068    -0.0201     0.1068     0.0201
Biguanide1                   -0.1052    -0.0199     0.1052     0.0199
RAAS1                        -0.0991    -0.0143     0.0991     0.0143
Insulin1                      0.0972     0.0166     0.0972     0.0166
Diuretic1                    -0.0814    -0.0527     0.0814     0.0527
Statin1                      -0.0789    -0.0362     0.0789     0.0362
TZD1                         -0.0775    -0.0482     0.0775     0.0482
cpd1                          0.0766     0.0093     0.0766     0.0093
rd1                          -0.0749    -0.0439     0.0749     0.0439
cvd1                         -0.0694    -0.0294     0.0694     0.0294
BB1                          -0.0687    -0.0219     0.0687     0.0219
ctd1                          0.0577     0.0162     0.0577     0.0162
Anticoagulant1               -0.0489    -0.0303     0.0489     0.0303
pvd1                         -0.0465    -0.0287     0.0465     0.0287
mld1                          0.0462     0.0204     0.0462     0.0204
chf1                         -0.0460    -0.0209     0.0460     0.0209
OtherHTN1                    -0.0458    -0.0190     0.0458     0.0190
SGLT21                        0.0395     0.0144     0.0395     0.0144
pud1                         -0.0355     0.0089     0.0355     0.0089
Antiplatelet1                -0.0354     0.0053     0.0354     0.0053
mi1                          -0.0213    -0.0234     0.0213     0.0234
msld1                        -0.0180    -0.0146     0.0180     0.0146
ph1                           0.0161     0.0211     0.0161     0.0211
sex_cat                      -0.0136     0.0217     0.0136     0.0217
cancer1                      -0.0055    -0.0026     0.0055     0.0026
Ezetimibe1                    0.0035    -0.0087     0.0035     0.0087
MRA1                          0.0018    -0.0148     0.0018     0.0148
education                    -0.0014    -0.0181     0.0014     0.0181
raceethnicity_cat            -0.0013    -0.0367     0.0013     0.0367
hiv1                         -0.0003     0.0017     0.0003     0.0017
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 8
Variables with |SMD| > 0.1 after IPTW: 1
Variables improved (reduced |SMD|): 28
Mean |SMD| before: 0.0947
Mean |SMD| after: 0.0272
Maximum |SMD| before: 0.8807 (index_year)
Maximum |SMD| after: 0.1007 (index_year)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_GLP1_vs_SU_DPP4_ADRD.csv 


Debug: weighted_df columns: person_id glp1_idx su_dpp4_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 7487 
Debug: event_time_months range: 0 68.92247 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_GLP1_vs_SU_DPP4_ADRD.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for GLP1 vs SU_DPP4 - ADRD :
- Initial cohort (T2DM): 9746 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 8389 (excluded: 1094 )
- After age filtering: 7487 (excluded: 0 )
- Final events: 229 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for ADRD ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 7487 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, glp1_idx, su_dpp4_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       4058             2.24                 4058
2         1       1624             2.38                 1624
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 5682 out of 7487 
Patients with baseline HbA1c data: 7487 
Patients with weighted mean HbA1c data: 5682 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.1 SD: 2.02 
Weighted Mean HbA1c - Mean: 7.7 SD: 1.75 
Correlation between baseline and weighted mean: 0.763 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 7120 
Total events: 208 

Diagnostic after HbA1c filtering:
Remaining patients: 7120 
Remaining events: 208 
Events by treatment: 
   
       0    1
  0 5016  170
  1 1896   38

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
              Estimate Std. Error   t value     Pr(>|t|)
(Intercept)  9.3061545 0.12123111 76.763752 0.000000e+00
treatment   -0.3778766 0.04406696 -8.575056 1.275773e-17
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                  Estimate Std. Error   z value  Pr(>|z|)
treatment      -0.22650864 0.17206303 -1.316428 0.1880303
hba1c_mean_6mo  0.07680244 0.05523749  1.390404 0.1644061

=== IPWT Mediation Analysis Summary for ADRD ===
A path (Treatment -> HbA1c): -0.3778766 p = 1.275773e-17 
B path (HbA1c -> Outcome): 0.07680244 p = 0.1644061 
C path (Direct Effect): -0.2265086 p = 0.1880303 
Indirect Effect (A*B): -0.02902185 p = 0.1699143 (Sobel test)
Total Effect (C + A*B): -0.2555305 

--- HbA1c Mediation Analysis End for ADRD ---

========= HbA1c Trajectory Analysis: GLP1 vs SU_DPP4 - ADRD =========
Rows: 1126922 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): person_id, A1c
date (1): date_of_measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Baseline HbA1c means (unweighted):
# A tibble: 2 × 3
  treatment unweighted_baseline n_baseline
      <dbl>               <dbl>      <int>
1         0                8.23       5494
2         1                7.74       1993


Linear Mixed Model Results (unweighted, adjusted for baseline HbA1c):
                         Estimate Std. Error       df    t value     Pr(>|t|)
(Intercept)            1.31299707 0.03182370 9004.196  41.258461 0.000000e+00
baseline_a1c           0.82283357 0.00368488 8810.469 223.299992 0.000000e+00
years_since           -0.31779131 0.02001138 5642.967 -15.880529 1.363468e-55
treatment             -0.09586456 0.01701192 8700.133  -5.635139 1.803711e-08
years_since:treatment -0.06489132 0.03663160 5442.306  -1.771457 7.654066e-02

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 33963' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 33963)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 33963' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 33963)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 33963' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 33963)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 33963' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 33963)' or larger];
but be warned that this may result in large computation time and memory use.



==== HbA1c Trajectory LMM Results for ADRD (IPWT) ====
                         Estimate Std. Error     Pr(>|t|)
(Intercept)            1.31299707 0.03182370 0.000000e+00
baseline_a1c           0.82283357 0.00368488 0.000000e+00
years_since           -0.31779131 0.02001138 1.363468e-55
treatment             -0.09586456 0.01701192 1.803711e-08
years_since:treatment -0.06489132 0.03663160 7.654066e-02
# A tibble: 5 × 9
  effect term     estimate std.error statistic    df  p.value conf.low conf.high
  <chr>  <chr>       <dbl>     <dbl>     <dbl> <dbl>    <dbl>    <dbl>     <dbl>
1 fixed  (Interc…   1.31     0.0318      41.3  9004. 0           1.25    1.38   
2 fixed  baselin…   0.823    0.00368    223.   8810. 0           0.816   0.830  
3 fixed  years_s…  -0.318    0.0200     -15.9  5643. 1.36e-55   -0.357  -0.279  
4 fixed  treatme…  -0.0959   0.0170      -5.64 8700. 1.80e- 8   -0.129  -0.0625 
5 fixed  years_s…  -0.0649   0.0366      -1.77 5442. 7.65e- 2   -0.137   0.00692

Estimated marginal means by time and treatment:
years_since = 0:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  8.027 0.00906 Inf     8.009     8.045
         1  7.931 0.01440 Inf     7.903     7.960

years_since = 1:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.709 0.01920 Inf     7.672     7.747
         1  7.549 0.02960 Inf     7.491     7.607

years_since = 2:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.392 0.03820 Inf     7.317     7.467
         1  7.166 0.05860 Inf     7.051     7.281

Degrees-of-freedom method: asymptotic 
Confidence level used: 0.95 

Treatment Effect (Baseline HbA1c difference): -0.096 (p = 1.8e-08 )
Time×Treatment Interaction (HbA1c change over time): -0.065 (p = 0.0765 )

Cohort sizes for HbA1c trajectory analysis:
# A tibble: 2 × 3
  treatment     n weighted_n
      <dbl> <int>      <dbl>
1         0  5494      3979.
2         1  1993      3508.

========= IPWT Analysis: GLP1 vs SU_DPP4 - stroke =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 9746 
Treatment distribution: 7262 2484 

Raw outcome variable ( stroke_start_date ) summary:
Total patients with outcome dates: 1184 
Total patients without outcome dates: 8562 
Outcome date range: 9123 to 19629 
===========================

Before excluding pre-existing stroke patients: 9746 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Stroke diagnosed BEFORE index date (excluding): 747 
Patients eligible for analysis: 8999 
=======================================
After excluding pre-existing stroke patients: 8999 (excluded: 747 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 437 
Treatment distribution after exclusion: 6727 2272 
Outcome date range after exclusion: 17554 to 19629 
Outcomes occurring AFTER index date: 415 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                8945                      3                 88.0
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  7979                     31                 223.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 8999 
Patients with outcome dates: 437 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: stroke_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: FALSE 
- Input data rows: 8999 
- Patients with outcome dates: 437 
- Outcome date range: 17554 to 19629 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 7541 
- Raw events (before late-onset filter): 315 
- Events after time >= 0 filter: 315 
- Patients filtered out due to event_time < 0: 1030 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2098 
- Mean event_time: 968.8576 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 83                                 315 
No event - administrative censoring 
                               7571 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 7969 
Patients with events (event = 1): 315 
Patients without events (event = 0): 7654 
Event distribution by treatment:
   
       0    1
  0 5688  261
  1 1966   54

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   568.0   941.0   968.9  1417.0  2098.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 315 
Final events: 315 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  5949     33.9   7.98       32.7          49
2         1  2020     37.7   8.36       36.5           4

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          27    569       1427    1631     1124      1122   49
  1           3     54        275     495      506       683    4

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  5949       8.25     2.07          7.8           716
2         1  2020       7.73     1.86          7.3           130

Total sample size: 7969 
Total events: 315 

Index Year Distribution:

2018 2019 2020 2021 
2340 2232 1604 1793 
Excluding 'cvd' covariate for Stroke outcome analysis
Note: Dropping 887 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          5194              35.2
2         1          1888              35.8

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        14.2       0.00378
 2         0 Normal            315.        0.0839 
 3         0 Overweight        807.        0.215  
 4         0 Obese I           992.        0.264  
 5         0 Obese II          734.        0.196  
 6         0 Obese III         892.        0.238  
 7         1 Underweight        11.9       0.00357
 8         1 Normal            126.        0.0378 
 9         1 Overweight        590.        0.177  
10         1 Obese I           949.        0.285  
11         1 Obese II          848.        0.255  
12         1 Obese III         803.        0.241  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            5194                8.13
2         1            1888                8.06
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_GLP1_vs_SU_DPP4_stroke.csv 

Standardized Mean Differences - Before Weighting (Top 10):
         variable std_diff
1      index_year  -0.8807
2    baseline_bmi   0.4577
3  baseline_hba1c  -0.2651
4          income  -0.1607
5             age  -0.1506
6            CCB1  -0.1026
7           RAAS1  -0.0950
8             mc1  -0.0934
9        Insulin1   0.0874
10     Biguanide1  -0.0872

Standardized Mean Differences - After Weighting (Top 10):
            variable std_diff
1         index_year   0.0966
2       baseline_bmi   0.0751
3               TZD1  -0.0524
4                rd1  -0.0501
5          Diuretic1  -0.0490
6             income  -0.0441
7  raceethnicity_cat  -0.0397
8               pvd1  -0.0396
9               CCB1  -0.0387
10    Anticoagulant1  -0.0384

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5366  0.5755  0.6872  1.0000  0.9826  6.9290 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  5194    242      3754.            160.   0.0466        0.0426
2         1  1888     54      3328.            117.   0.0286        0.0351

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 7082, number of events= 296 

             coef exp(coef) se(coef) robust se     z Pr(>|z|)
treatment -0.2424    0.7847   0.1223    0.1909 -1.27    0.204

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.7847      1.274    0.5397     1.141

Concordance= 0.553  (se = 0.021 )
Likelihood ratio test= 3.97  on 1 df,   p=0.05
Wald test            = 1.61  on 1 df,   p=0.2
Score (logrank) test = 3.95  on 1 df,   p=0.05,   Robust = 1.88  p=0.2

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: GLP1 vs SU_DPP4 - stroke 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
index_year                   -0.8807     0.0966     0.8807     0.0966
baseline_bmi                  0.4577     0.0751     0.4577     0.0751
baseline_hba1c               -0.2651    -0.0334     0.2651     0.0334
income                       -0.1607    -0.0441     0.1607     0.0441
age                          -0.1506    -0.0338     0.1506     0.0338
CCB1                         -0.1026    -0.0387     0.1026     0.0387
RAAS1                        -0.0950    -0.0135     0.0950     0.0135
mc1                          -0.0934    -0.0239     0.0934     0.0239
Insulin1                      0.0874     0.0137     0.0874     0.0137
Biguanide1                   -0.0872    -0.0296     0.0872     0.0296
Statin1                      -0.0867    -0.0325     0.0867     0.0325
TZD1                         -0.0855    -0.0524     0.0855     0.0524
rd1                          -0.0804    -0.0501     0.0804     0.0501
cpd1                          0.0767     0.0140     0.0767     0.0140
ctd1                          0.0706     0.0054     0.0706     0.0054
Diuretic1                    -0.0697    -0.0490     0.0697     0.0490
BB1                          -0.0636    -0.0217     0.0636     0.0217
Anticoagulant1               -0.0555    -0.0384     0.0555     0.0384
pvd1                         -0.0520    -0.0396     0.0520     0.0396
OtherHTN1                    -0.0461    -0.0175     0.0461     0.0175
chf1                         -0.0454    -0.0194     0.0454     0.0194
mld1                          0.0378     0.0150     0.0378     0.0150
mi1                          -0.0349    -0.0244     0.0349     0.0244
SGLT21                        0.0325     0.0130     0.0325     0.0130
Antiplatelet1                -0.0316     0.0103     0.0316     0.0103
pud1                         -0.0288     0.0017     0.0288     0.0017
sex_cat                      -0.0264     0.0227     0.0264     0.0227
msld1                        -0.0198    -0.0225     0.0198     0.0225
education                    -0.0178    -0.0175     0.0178     0.0175
dem1                          0.0167    -0.0204     0.0167     0.0204
cancer1                      -0.0108     0.0014     0.0108     0.0014
MRA1                          0.0107    -0.0106     0.0107     0.0106
raceethnicity_cat            -0.0068    -0.0397     0.0068     0.0397
Ezetimibe1                   -0.0068    -0.0068     0.0068     0.0068
hiv1                         -0.0041    -0.0059     0.0041     0.0059
ph1                          -0.0031     0.0058     0.0031     0.0058
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 6
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 31
Mean |SMD| before: 0.0945
Mean |SMD| after: 0.0267
Maximum |SMD| before: 0.8807 (index_year)
Maximum |SMD| after: 0.0966 (index_year)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_GLP1_vs_SU_DPP4_stroke.csv 


Debug: weighted_df columns: person_id glp1_idx su_dpp4_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 7082 
Debug: event_time_months range: 0 68.92247 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_GLP1_vs_SU_DPP4_stroke.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for GLP1 vs SU_DPP4 - stroke :
- Initial cohort (T2DM): 9746 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 7969 (excluded: 1030 )
- After age filtering: 7082 (excluded: 0 )
- Final events: 296 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for stroke ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 7082 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, glp1_idx, su_dpp4_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       3854             2.25                 3854
2         1       1536             2.37                 1536
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 5390 out of 7082 
Patients with baseline HbA1c data: 7082 
Patients with weighted mean HbA1c data: 5390 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.11 SD: 2.03 
Weighted Mean HbA1c - Mean: 7.71 SD: 1.76 
Correlation between baseline and weighted mean: 0.766 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 6713 
Total events: 254 

Diagnostic after HbA1c filtering:
Remaining patients: 6713 
Remaining events: 254 
Events by treatment: 
   
       0    1
  0 4679  205
  1 1780   49

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
              Estimate Std. Error   t value     Pr(>|t|)
(Intercept)  9.2348646 0.12384385 74.568617 0.000000e+00
treatment   -0.3971979 0.04530916 -8.766394 2.470007e-18
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                Estimate Std. Error   z value     Pr(>|z|)
treatment      0.1099148 0.14675198 0.7489836 4.538671e-01
hba1c_mean_6mo 0.2349508 0.03802919 6.1781708 6.484854e-10

=== IPWT Mediation Analysis Summary for stroke ===
A path (Treatment -> HbA1c): -0.3971979 p = 2.470007e-18 
B path (HbA1c -> Outcome): 0.2349508 p = 6.484854e-10 
C path (Direct Effect): 0.1099148 p = 0.4538671 
Indirect Effect (A*B): -0.09332198 p = 4.417063e-07 (Sobel test)
Total Effect (C + A*B): 0.01659286 

--- HbA1c Mediation Analysis End for stroke ---

========= HbA1c Trajectory Analysis: GLP1 vs SU_DPP4 - stroke =========
Rows: 1126922 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl  (2): person_id, A1c
date (1): date_of_measurement

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Baseline HbA1c means (unweighted):
# A tibble: 2 × 3
  treatment unweighted_baseline n_baseline
      <dbl>               <dbl>      <int>
1         0                8.25       5194
2         1                7.73       1888


Linear Mixed Model Results (unweighted, adjusted for baseline HbA1c):
                         Estimate  Std. Error       df    t value      Pr(>|t|)
(Intercept)            1.31688374 0.032796663 8589.500  40.152979 2.964394e-323
baseline_a1c           0.82224608 0.003787246 8395.663 217.109244  0.000000e+00
years_since           -0.32442711 0.020741168 5415.450 -15.641699  5.659700e-54
treatment             -0.10098059 0.017523502 8281.573  -5.762581  8.580318e-09
years_since:treatment -0.04792065 0.037977843 5228.188  -1.261806  2.070751e-01

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 32078' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 32078)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 32078' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 32078)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'pbkrtest.limit = 32078' (or larger)
[or, globally, 'set emm_options(pbkrtest.limit = 32078)' or larger];
but be warned that this may result in large computation time and memory use.

Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
To enable adjustments, add the argument 'lmerTest.limit = 32078' (or larger)
[or, globally, 'set emm_options(lmerTest.limit = 32078)' or larger];
but be warned that this may result in large computation time and memory use.



==== HbA1c Trajectory LMM Results for stroke (IPWT) ====
                         Estimate  Std. Error      Pr(>|t|)
(Intercept)            1.31688374 0.032796663 2.964394e-323
baseline_a1c           0.82224608 0.003787246  0.000000e+00
years_since           -0.32442711 0.020741168  5.659700e-54
treatment             -0.10098059 0.017523502  8.580318e-09
years_since:treatment -0.04792065 0.037977843  2.070751e-01
# A tibble: 5 × 9
  effect term    estimate std.error statistic    df   p.value conf.low conf.high
  <chr>  <chr>      <dbl>     <dbl>     <dbl> <dbl>     <dbl>    <dbl>     <dbl>
1 fixed  (Inter…   1.32     0.0328      40.2  8590. 2.96e-323    1.25     1.38  
2 fixed  baseli…   0.822    0.00379    217.   8396. 0            0.815    0.830 
3 fixed  years_…  -0.324    0.0207     -15.6  5415. 5.66e- 54   -0.365   -0.284 
4 fixed  treatm…  -0.101    0.0175      -5.76 8282. 8.58e-  9   -0.135   -0.0666
5 fixed  years_…  -0.0479   0.0380      -1.26 5228. 2.07e-  1   -0.122    0.0265

Estimated marginal means by time and treatment:
years_since = 0:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  8.035 0.00933 Inf     8.017     8.053
         1  7.934 0.01480 Inf     7.905     7.963

years_since = 1:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.710 0.01990 Inf     7.671     7.750
         1  7.562 0.03070 Inf     7.501     7.622

years_since = 2:
 treatment emmean      SE  df asymp.LCL asymp.UCL
         0  7.386 0.03960 Inf     7.308     7.464
         1  7.189 0.06070 Inf     7.070     7.308

Degrees-of-freedom method: asymptotic 
Confidence level used: 0.95 

Treatment Effect (Baseline HbA1c difference): -0.101 (p = 8.58e-09 )
Time×Treatment Interaction (HbA1c change over time): -0.048 (p = 0.207 )

Cohort sizes for HbA1c trajectory analysis:
# A tibble: 2 × 3
  treatment     n weighted_n
      <dbl> <int>      <dbl>
1         0  5194      3754.
2         1  1888      3328.

========= IPWT Analysis: SGLT2 vs SU_DPP4 - Epilepsy/Seizure =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 10384 
Treatment distribution: 6176 4208 

Raw outcome variable ( epilepsy_or_seizure_start_date ) summary:
Total patients with outcome dates: 809 
Total patients without outcome dates: 9575 
Outcome date range: 4253 to 19631 
===========================

Before excluding pre-existing Epilepsy/Seizure patients: 10384 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Epilepsy/Seizure diagnosed BEFORE index date (excluding): 561 
Patients eligible for analysis: 9823 
=======================================
After excluding pre-existing Epilepsy/Seizure patients: 9823 (excluded: 561 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 248 
Treatment distribution after exclusion: 5855 3968 
Outcome date range after exclusion: 17722 to 19631 
Outcomes occurring AFTER index date: 245 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                9758                      3                 99.3
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  8772                     28                 216.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 9823 
Patients with outcome dates: 248 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: epilepsy_or_seizure_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: FALSE 
- Input data rows: 9823 
- Patients with outcome dates: 248 
- Outcome date range: 17722 to 19631 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 8192 
- Raw events (before late-onset filter): 180 
- Events after time >= 0 filter: 180 
- Patients filtered out due to event_time < 0: 1208 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2098 
- Mean event_time: 973.5436 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 48                                 180 
No event - administrative censoring 
                               8387 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 8615 
Patients with events (event = 1): 180 
Patients without events (event = 0): 8435 
Event distribution by treatment:
   
       0    1
  0 5027  117
  1 3408   63

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   579.0   944.0   973.5  1416.0  2098.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 180 
Final events: 180 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  5144     33.9   7.96       32.8          38
2         1  3471     34.9   7.68       33.9          26

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          23    476       1221    1428      980       978   38
  1          14    203        725     964      793       746   26

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  5144       8.18     2.08          7.7           615
2         1  3471       8.16     1.78          7.9           226

Total sample size: 8615 
Total events: 180 

Index Year Distribution:

2018 2019 2020 2021 
2429 2357 1839 1990 
Note: Dropping 898 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          4497              34.4
2         1          3220              34.5

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        16.7       0.00431
 2         0 Normal            346.        0.0896 
 3         0 Overweight        870.        0.225  
 4         0 Obese I          1060.        0.274  
 5         0 Obese II          767.        0.198  
 6         0 Obese III         805.        0.208  
 7         1 Underweight        15.0       0.00389
 8         1 Normal            244.        0.0633 
 9         1 Overweight        865.        0.225  
10         1 Obese I          1113.        0.289  
11         1 Obese II          851.        0.221  
12         1 Obese III         764.        0.198  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            4497                8.19
2         1            3220                8.20
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_SGLT2_vs_SU_DPP4_Epilepsy_Seizure.csv 

Standardized Mean Differences - Before Weighting (Top 10):
       variable std_diff
1    index_year   0.5809
2      Insulin1   0.2027
3          chf1   0.2023
4           mi1   0.1841
5         GLP11   0.1332
6  baseline_bmi   0.1275
7          mld1   0.1003
8          pvd1   0.0977
9           age   0.0911
10          rd1   0.0874

Standardized Mean Differences - After Weighting (Top 10):
         variable std_diff
1       OtherHTN1  -0.0124
2          income  -0.0120
3    baseline_bmi   0.0101
4         sex_cat   0.0093
5            MRA1   0.0089
6             mc1  -0.0085
7  baseline_hba1c   0.0080
8            CCB1  -0.0079
9            mld1   0.0076
10            mi1   0.0076

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5767  0.6900  0.8390  1.0000  1.1263  2.9886 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  4497    107      3864.            89.0   0.0238        0.0230
2         1  3220     58      3853.            73.0   0.0180        0.0190

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 7717, number of events= 165 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)  
treatment -0.2924    0.7465   0.1579    0.1777 -1.645      0.1 .
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.7465       1.34    0.5269     1.058

Concordance= 0.541  (se = 0.023 )
Likelihood ratio test= 3.45  on 1 df,   p=0.06
Wald test            = 2.71  on 1 df,   p=0.1
Score (logrank) test = 3.45  on 1 df,   p=0.06,   Robust = 2.89  p=0.09

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: SGLT2 vs SU_DPP4 - Epilepsy/Seizure 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
index_year                    0.5809    -0.0074     0.5809     0.0074
Insulin1                      0.2027     0.0025     0.2027     0.0025
chf1                          0.2023    -0.0003     0.2023     0.0003
mi1                           0.1841     0.0076     0.1841     0.0076
GLP11                         0.1332     0.0050     0.1332     0.0050
baseline_bmi                  0.1275     0.0101     0.1275     0.0101
mld1                          0.1003     0.0076     0.1003     0.0076
pvd1                          0.0977    -0.0007     0.0977     0.0007
age                           0.0911    -0.0055     0.0911     0.0055
rd1                           0.0874    -0.0056     0.0874     0.0056
cpd1                          0.0873    -0.0015     0.0873     0.0015
cancer1                       0.0834     0.0009     0.0834     0.0009
OtherHTN1                    -0.0830    -0.0124     0.0830     0.0124
ph1                           0.0631    -0.0046     0.0631     0.0046
Statin1                       0.0620    -0.0012     0.0620     0.0012
cvd1                          0.0521    -0.0033     0.0521     0.0033
raceethnicity_cat             0.0483    -0.0017     0.0483     0.0017
Biguanide1                   -0.0483    -0.0032     0.0483     0.0032
CCB1                         -0.0476    -0.0079     0.0476     0.0079
BB1                           0.0473    -0.0014     0.0473     0.0014
pud1                          0.0426     0.0069     0.0426     0.0069
mc1                          -0.0422    -0.0085     0.0422     0.0085
income                       -0.0380    -0.0120     0.0380     0.0120
MRA1                          0.0340     0.0089     0.0340     0.0089
Ezetimibe1                    0.0287    -0.0052     0.0287     0.0052
RAAS1                         0.0263    -0.0060     0.0263     0.0060
hiv1                          0.0258     0.0034     0.0258     0.0034
ctd1                          0.0233     0.0041     0.0233     0.0041
msld1                         0.0224    -0.0032     0.0224     0.0032
Anticoagulant1                0.0215    -0.0012     0.0215     0.0012
dem1                         -0.0208     0.0012     0.0208     0.0012
Antiplatelet1                 0.0192    -0.0057     0.0192     0.0057
TZD1                         -0.0185    -0.0010     0.0185     0.0010
baseline_hba1c               -0.0126     0.0080     0.0126     0.0080
Diuretic1                     0.0086    -0.0061     0.0086     0.0061
education                     0.0051    -0.0036     0.0051     0.0036
sex_cat                       0.0013     0.0093     0.0013     0.0093
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 7
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 36
Mean |SMD| before: 0.0762
Mean |SMD| after: 0.0050
Maximum |SMD| before: 0.5809 (index_year)
Maximum |SMD| after: 0.0124 (OtherHTN1)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_SGLT2_vs_SU_DPP4_Epilepsy_Seizure.csv 


Debug: weighted_df columns: person_id sglt2_idx su_dpp4_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 7717 
Debug: event_time_months range: 0 68.92247 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_SGLT2_vs_SU_DPP4_Epilepsy_Seizure.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for SGLT2 vs SU_DPP4 - Epilepsy/Seizure :
- Initial cohort (T2DM): 10384 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 8615 (excluded: 1208 )
- After age filtering: 7717 (excluded: 0 )
- Final events: 165 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for Epilepsy/Seizure ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 7717 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, sglt2_idx, su_dpp4_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       3285             2.20                 3285
2         1       2602             2.48                 2602
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 5887 out of 7717 
Patients with baseline HbA1c data: 7717 
Patients with weighted mean HbA1c data: 5887 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.17 SD: 1.96 
Weighted Mean HbA1c - Mean: 7.79 SD: 1.7 
Correlation between baseline and weighted mean: 0.751 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 7328 
Total events: 150 

Diagnostic after HbA1c filtering:
Remaining patients: 7328 
Remaining events: 150 
Events by treatment: 
   
       0    1
  0 4139   95
  1 3039   55

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
               Estimate Std. Error    t value  Pr(>|t|)
(Intercept)  9.49284516 0.12031483 78.9000431 0.0000000
treatment   -0.02065693 0.04282142 -0.4823973 0.6295425
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                  Estimate Std. Error    z value   Pr(>|z|)
treatment      -0.13487308 0.18503471 -0.7289069 0.46605861
hba1c_mean_6mo  0.08481641 0.05134353  1.6519395 0.09854689

=== IPWT Mediation Analysis Summary for Epilepsy/Seizure ===
A path (Treatment -> HbA1c): -0.02065693 p = 0.6295425 
B path (HbA1c -> Outcome): 0.08481641 p = 0.09854689 
C path (Direct Effect): -0.1348731 p = 0.4660586 
Indirect Effect (A*B): -0.001752047 p = 0.6433231 (Sobel test)
Total Effect (C + A*B): -0.1366251 

--- HbA1c Mediation Analysis End for Epilepsy/Seizure ---

========= IPWT Analysis: SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 10384 
Treatment distribution: 6176 4208 

Raw outcome variable ( epilepsy_or_seizure_start_date ) summary:
Total patients with outcome dates: 809 
Total patients without outcome dates: 9575 
Outcome date range: 4253 to 19631 
===========================

Before excluding pre-existing Early-onset Epilepsy/Seizure patients: 10384 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Epilepsy/Seizure diagnosed BEFORE index date (excluding): 561 
Patients eligible for analysis: 9823 
=======================================
After excluding pre-existing Early-onset Epilepsy/Seizure patients: 9823 (excluded: 561 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 248 
Treatment distribution after exclusion: 5855 3968 
Outcome date range after exclusion: 17722 to 19631 
Outcomes occurring AFTER index date: 245 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                9758                      3                 99.3
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  8772                     28                 216.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 9823 
Patients with outcome dates: 248 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: epilepsy_or_seizure_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: TRUE 
- Input data rows: 9823 
- Patients with outcome dates: 248 
- Outcome date range: 17722 to 19631 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 8192 
- Raw events (before late-onset filter): 180 
- Events after time >= 0 filter: 21 
- Patients filtered out due to event_time < 0: 1208 
- Early-onset applied: events with age < 50: 21 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2098 
- Mean event_time: 973.5436 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 48                                 180 
No event - administrative censoring 
                               8387 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 8615 
Patients with events (event = 1): 21 
Patients without events (event = 0): 8594 
Event distribution by treatment:
   
       0    1
  0 5130   14
  1 3464    7

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   579.0   944.0   973.5  1416.0  2098.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 180 
Final events: 21 
Early onset filter applied (age < 50)
Events with age_at_event < 50: 21 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  5144     33.9   7.96       32.8          38
2         1  3471     34.9   7.68       33.9          26

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          23    476       1221    1428      980       978   38
  1          14    203        725     964      793       746   26

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  5144       8.18     2.08          7.7           615
2         1  3471       8.16     1.78          7.9           226

Total sample size: 8615 
Total events: 21 

Index Year Distribution:

2018 2019 2020 2021 
2429 2357 1839 1990 
Note: Dropping 898 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          4497              34.4
2         1          3220              34.5

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        16.7       0.00431
 2         0 Normal            346.        0.0896 
 3         0 Overweight        870.        0.225  
 4         0 Obese I          1060.        0.274  
 5         0 Obese II          767.        0.198  
 6         0 Obese III         805.        0.208  
 7         1 Underweight        15.0       0.00389
 8         1 Normal            244.        0.0633 
 9         1 Overweight        865.        0.225  
10         1 Obese I          1113.        0.289  
11         1 Obese II          851.        0.221  
12         1 Obese III         764.        0.198  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            4497                8.19
2         1            3220                8.20
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_SGLT2_vs_SU_DPP4_Early-onset_Epilepsy_Seizure.csv 

Standardized Mean Differences - Before Weighting (Top 10):
       variable std_diff
1    index_year   0.5809
2      Insulin1   0.2027
3          chf1   0.2023
4           mi1   0.1841
5         GLP11   0.1332
6  baseline_bmi   0.1275
7          mld1   0.1003
8          pvd1   0.0977
9           age   0.0911
10          rd1   0.0874

Standardized Mean Differences - After Weighting (Top 10):
         variable std_diff
1       OtherHTN1  -0.0124
2          income  -0.0120
3    baseline_bmi   0.0101
4         sex_cat   0.0093
5            MRA1   0.0089
6             mc1  -0.0085
7  baseline_hba1c   0.0080
8            CCB1  -0.0079
9            mld1   0.0076
10            mi1   0.0076

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5767  0.6900  0.8390  1.0000  1.1263  2.9886 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  4497     13      3864.            9.87  0.00289       0.00255
2         1  3220      7      3853.           10.0   0.00217       0.00260

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 7717, number of events= 20 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)
treatment -0.0703    0.9321   0.4486    0.5145 -0.137    0.891

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.9321      1.073      0.34     2.555

Concordance= 0.503  (se = 0.067 )
Likelihood ratio test= 0.02  on 1 df,   p=0.9
Wald test            = 0.02  on 1 df,   p=0.9
Score (logrank) test = 0.02  on 1 df,   p=0.9,   Robust = 0.02  p=0.9

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
index_year                    0.5809    -0.0074     0.5809     0.0074
Insulin1                      0.2027     0.0025     0.2027     0.0025
chf1                          0.2023    -0.0003     0.2023     0.0003
mi1                           0.1841     0.0076     0.1841     0.0076
GLP11                         0.1332     0.0050     0.1332     0.0050
baseline_bmi                  0.1275     0.0101     0.1275     0.0101
mld1                          0.1003     0.0076     0.1003     0.0076
pvd1                          0.0977    -0.0007     0.0977     0.0007
age                           0.0911    -0.0055     0.0911     0.0055
rd1                           0.0874    -0.0056     0.0874     0.0056
cpd1                          0.0873    -0.0015     0.0873     0.0015
cancer1                       0.0834     0.0009     0.0834     0.0009
OtherHTN1                    -0.0830    -0.0124     0.0830     0.0124
ph1                           0.0631    -0.0046     0.0631     0.0046
Statin1                       0.0620    -0.0012     0.0620     0.0012
cvd1                          0.0521    -0.0033     0.0521     0.0033
raceethnicity_cat             0.0483    -0.0017     0.0483     0.0017
Biguanide1                   -0.0483    -0.0032     0.0483     0.0032
CCB1                         -0.0476    -0.0079     0.0476     0.0079
BB1                           0.0473    -0.0014     0.0473     0.0014
pud1                          0.0426     0.0069     0.0426     0.0069
mc1                          -0.0422    -0.0085     0.0422     0.0085
income                       -0.0380    -0.0120     0.0380     0.0120
MRA1                          0.0340     0.0089     0.0340     0.0089
Ezetimibe1                    0.0287    -0.0052     0.0287     0.0052
RAAS1                         0.0263    -0.0060     0.0263     0.0060
hiv1                          0.0258     0.0034     0.0258     0.0034
ctd1                          0.0233     0.0041     0.0233     0.0041
msld1                         0.0224    -0.0032     0.0224     0.0032
Anticoagulant1                0.0215    -0.0012     0.0215     0.0012
dem1                         -0.0208     0.0012     0.0208     0.0012
Antiplatelet1                 0.0192    -0.0057     0.0192     0.0057
TZD1                         -0.0185    -0.0010     0.0185     0.0010
baseline_hba1c               -0.0126     0.0080     0.0126     0.0080
Diuretic1                     0.0086    -0.0061     0.0086     0.0061
education                     0.0051    -0.0036     0.0051     0.0036
sex_cat                       0.0013     0.0093     0.0013     0.0093
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 7
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 36
Mean |SMD| before: 0.0762
Mean |SMD| after: 0.0050
Maximum |SMD| before: 0.5809 (index_year)
Maximum |SMD| after: 0.0124 (OtherHTN1)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_SGLT2_vs_SU_DPP4_Early-onset_Epilepsy_Seizure.csv 


Debug: weighted_df columns: person_id sglt2_idx su_dpp4_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 7717 
Debug: event_time_months range: 0 68.92247 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_SGLT2_vs_SU_DPP4_Early-onset_Epilepsy_Seizure.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure :
- Initial cohort (T2DM): 10384 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 8615 (excluded: 1208 )
- After age filtering: 7717 (excluded: 0 )
- Final events: 20 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for Early-onset Epilepsy/Seizure ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 7717 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, sglt2_idx, su_dpp4_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       3285             2.20                 3285
2         1       2602             2.48                 2602
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 5887 out of 7717 
Patients with baseline HbA1c data: 7717 
Patients with weighted mean HbA1c data: 5887 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.17 SD: 1.96 
Weighted Mean HbA1c - Mean: 7.79 SD: 1.7 
Correlation between baseline and weighted mean: 0.751 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 7328 
Total events: 150 

Diagnostic after HbA1c filtering:
Remaining patients: 7328 
Remaining events: 150 
Events by treatment: 
   
       0    1
  0 4139   95
  1 3039   55

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
               Estimate Std. Error    t value  Pr(>|t|)
(Intercept)  9.49284516 0.12031483 78.9000431 0.0000000
treatment   -0.02065693 0.04282142 -0.4823973 0.6295425
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                  Estimate Std. Error    z value   Pr(>|z|)
treatment      -0.13487308 0.18503471 -0.7289069 0.46605861
hba1c_mean_6mo  0.08481641 0.05134353  1.6519395 0.09854689

=== IPWT Mediation Analysis Summary for Early-onset Epilepsy/Seizure ===
A path (Treatment -> HbA1c): -0.02065693 p = 0.6295425 
B path (HbA1c -> Outcome): 0.08481641 p = 0.09854689 
C path (Direct Effect): -0.1348731 p = 0.4660586 
Indirect Effect (A*B): -0.001752047 p = 0.6433231 (Sobel test)
Total Effect (C + A*B): -0.1366251 

--- HbA1c Mediation Analysis End for Early-onset Epilepsy/Seizure ---

========= IPWT Analysis: SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 10384 
Treatment distribution: 6176 4208 

Raw outcome variable ( epilepsy_or_seizure_start_date ) summary:
Total patients with outcome dates: 809 
Total patients without outcome dates: 9575 
Outcome date range: 4253 to 19631 
===========================

Before excluding pre-existing Late-onset Epilepsy/Seizure patients: 10384 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Epilepsy/Seizure diagnosed BEFORE index date (excluding): 561 
Patients eligible for analysis: 9823 
=======================================
After excluding pre-existing Late-onset Epilepsy/Seizure patients: 9823 (excluded: 561 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 248 
Treatment distribution after exclusion: 5855 3968 
Outcome date range after exclusion: 17722 to 19631 
Outcomes occurring AFTER index date: 245 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                9758                      3                 99.3
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  8772                     28                 216.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 9823 
Patients with outcome dates: 248 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: epilepsy_or_seizure_start_date 
- data_cut_date: 2023-10-01 
- late_onset: TRUE 
- early_onset: FALSE 
- Input data rows: 9823 
- Patients with outcome dates: 248 
- Outcome date range: 17722 to 19631 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 8192 
- Raw events (before late-onset filter): 180 
- Events after time >= 0 filter: 159 
- Patients filtered out due to event_time < 0: 1208 
- Late-onset applied: events with age >= 50: 159 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2098 
- Mean event_time: 973.5436 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 48                                 180 
No event - administrative censoring 
                               8387 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 8615 
Patients with events (event = 1): 159 
Patients without events (event = 0): 8456 
Event distribution by treatment:
   
       0    1
  0 5041  103
  1 3415   56

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   579.0   944.0   973.5  1416.0  2098.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 180 
Final events: 159 
Late onset filter applied (age >= 50)
Events with age_at_event >= 50: 159 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  5144     33.9   7.96       32.8          38
2         1  3471     34.9   7.68       33.9          26

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          23    476       1221    1428      980       978   38
  1          14    203        725     964      793       746   26

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  5144       8.18     2.08          7.7           615
2         1  3471       8.16     1.78          7.9           226

Total sample size: 8615 
Total events: 159 

Index Year Distribution:

2018 2019 2020 2021 
2429 2357 1839 1990 
Note: Dropping 898 rows with missing values in covariates
After age filtering (>= 50 ): samples = 6823 , events = 142 

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          3934              33.9
2         1          2889              34.1

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        13.5       0.00397
 2         0 Normal            317.        0.0932 
 3         0 Overweight        797.        0.234  
 4         0 Obese I           971.        0.285  
 5         0 Obese II          676.        0.199  
 6         0 Obese III         629.        0.185  
 7         1 Underweight        15.0       0.00440
 8         1 Normal            216.        0.0633 
 9         1 Overweight        801.        0.235  
10         1 Obese I          1021.        0.300  
11         1 Obese II          738.        0.216  
12         1 Obese III         618.        0.181  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            3934                8.10
2         1            2889                8.16
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_SGLT2_vs_SU_DPP4_Late-onset_Epilepsy_Seizure.csv 

Standardized Mean Differences - Before Weighting (Top 10):
       variable std_diff
1    index_year   0.5809
2      Insulin1   0.2027
3          chf1   0.2023
4           mi1   0.1841
5         GLP11   0.1332
6  baseline_bmi   0.1275
7          mld1   0.1003
8          pvd1   0.0977
9           age   0.0911
10          rd1   0.0874

Standardized Mean Differences - After Weighting (Top 10):
         variable std_diff
1       OtherHTN1  -0.0124
2          income  -0.0120
3    baseline_bmi   0.0101
4         sex_cat   0.0093
5            MRA1   0.0089
6             mc1  -0.0085
7  baseline_hba1c   0.0080
8            CCB1  -0.0079
9            mld1   0.0076
10            mi1   0.0076

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5767  0.6913  0.8390  0.9985  1.1267  2.9886 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  3934     92      3404.            77.7   0.0234        0.0228
2         1  2889     50      3409.            60.2   0.0173        0.0177

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 7717, number of events= 145 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)  
treatment -0.3237    0.7235   0.1689    0.1890 -1.712   0.0868 .
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.7235      1.382    0.4995     1.048

Concordance= 0.547  (se = 0.024 )
Likelihood ratio test= 3.7  on 1 df,   p=0.05
Wald test            = 2.93  on 1 df,   p=0.09
Score (logrank) test = 3.71  on 1 df,   p=0.05,   Robust = 3.14  p=0.08

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
index_year                    0.5809    -0.0074     0.5809     0.0074
Insulin1                      0.2027     0.0025     0.2027     0.0025
chf1                          0.2023    -0.0003     0.2023     0.0003
mi1                           0.1841     0.0076     0.1841     0.0076
GLP11                         0.1332     0.0050     0.1332     0.0050
baseline_bmi                  0.1275     0.0101     0.1275     0.0101
mld1                          0.1003     0.0076     0.1003     0.0076
pvd1                          0.0977    -0.0007     0.0977     0.0007
age                           0.0911    -0.0055     0.0911     0.0055
rd1                           0.0874    -0.0056     0.0874     0.0056
cpd1                          0.0873    -0.0015     0.0873     0.0015
cancer1                       0.0834     0.0009     0.0834     0.0009
OtherHTN1                    -0.0830    -0.0124     0.0830     0.0124
ph1                           0.0631    -0.0046     0.0631     0.0046
Statin1                       0.0620    -0.0012     0.0620     0.0012
cvd1                          0.0521    -0.0033     0.0521     0.0033
raceethnicity_cat             0.0483    -0.0017     0.0483     0.0017
Biguanide1                   -0.0483    -0.0032     0.0483     0.0032
CCB1                         -0.0476    -0.0079     0.0476     0.0079
BB1                           0.0473    -0.0014     0.0473     0.0014
pud1                          0.0426     0.0069     0.0426     0.0069
mc1                          -0.0422    -0.0085     0.0422     0.0085
income                       -0.0380    -0.0120     0.0380     0.0120
MRA1                          0.0340     0.0089     0.0340     0.0089
Ezetimibe1                    0.0287    -0.0052     0.0287     0.0052
RAAS1                         0.0263    -0.0060     0.0263     0.0060
hiv1                          0.0258     0.0034     0.0258     0.0034
ctd1                          0.0233     0.0041     0.0233     0.0041
msld1                         0.0224    -0.0032     0.0224     0.0032
Anticoagulant1                0.0215    -0.0012     0.0215     0.0012
dem1                         -0.0208     0.0012     0.0208     0.0012
Antiplatelet1                 0.0192    -0.0057     0.0192     0.0057
TZD1                         -0.0185    -0.0010     0.0185     0.0010
baseline_hba1c               -0.0126     0.0080     0.0126     0.0080
Diuretic1                     0.0086    -0.0061     0.0086     0.0061
education                     0.0051    -0.0036     0.0051     0.0036
sex_cat                       0.0013     0.0093     0.0013     0.0093
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 7
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 36
Mean |SMD| before: 0.0762
Mean |SMD| after: 0.0050
Maximum |SMD| before: 0.5809 (index_year)
Maximum |SMD| after: 0.0124 (OtherHTN1)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_SGLT2_vs_SU_DPP4_Late-onset_Epilepsy_Seizure.csv 


Debug: weighted_df columns: person_id sglt2_idx su_dpp4_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 6823 
Debug: event_time_months range: 0 68.92247 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_SGLT2_vs_SU_DPP4_Late-onset_Epilepsy_Seizure.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure :
- Initial cohort (T2DM): 10384 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 8615 (excluded: 1208 )
- After age filtering: 6823 (excluded: 894 )
- Final events: 142 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for Late-onset Epilepsy/Seizure ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 6823 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, sglt2_idx, su_dpp4_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       2863             2.22                 2863
2         1       2350             2.50                 2350
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 5213 out of 6823 
Patients with baseline HbA1c data: 6823 
Patients with weighted mean HbA1c data: 5213 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.1 SD: 1.91 
Weighted Mean HbA1c - Mean: 7.73 SD: 1.64 
Correlation between baseline and weighted mean: 0.747 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 6497 
Total events: 130 

Diagnostic after HbA1c filtering:
Remaining patients: 6497 
Remaining events: 130 
Events by treatment: 
   
       0    1
  0 3634   81
  1 2733   49

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
              Estimate Std. Error    t value  Pr(>|t|)
(Intercept) 9.89466122 0.16684427 59.3047712 0.0000000
treatment   0.02398596 0.04383617  0.5471728 0.5842844
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                 Estimate Std. Error    z value   Pr(>|z|)
treatment      -0.1525676 0.19976995 -0.7637165 0.44503623
hba1c_mean_6mo  0.1062669 0.05584202  1.9029916 0.05704164

=== IPWT Mediation Analysis Summary for Late-onset Epilepsy/Seizure ===
A path (Treatment -> HbA1c): 0.02398596 p = 0.5842844 
B path (HbA1c -> Outcome): 0.1062669 p = 0.05704164 
C path (Direct Effect): -0.1525676 p = 0.4450362 
Indirect Effect (A*B): 0.002548913 p = 0.5989811 (Sobel test)
Total Effect (C + A*B): -0.1500187 

--- HbA1c Mediation Analysis End for Late-onset Epilepsy/Seizure ---

========= IPWT Analysis: SGLT2 vs SU_DPP4 - ADRD =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 10384 
Treatment distribution: 6176 4208 

Raw outcome variable ( adrd_start_date ) summary:
Total patients with outcome dates: 688 
Total patients without outcome dates: 9696 
Outcome date range: 5598 to 19619 
===========================

Before excluding pre-existing ADRD patients: 10384 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
ADRD diagnosed BEFORE index date (excluding): 315 
Patients eligible for analysis: 10069 
=======================================
After excluding pre-existing ADRD patients: 10069 (excluded: 315 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 373 
Treatment distribution after exclusion: 6021 4048 
Outcome date range after exclusion: 17618 to 19619 
Outcomes occurring AFTER index date: 367 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1               10001                      3                 99.1
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  9009                     28                 219.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 10069 
Patients with outcome dates: 373 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: adrd_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: FALSE 
- Input data rows: 10069 
- Patients with outcome dates: 373 
- Outcome date range: 17618 to 19619 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 8386 
- Raw events (before late-onset filter): 286 
- Events after time >= 0 filter: 286 
- Patients filtered out due to event_time < 0: 1253 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2098 
- Mean event_time: 971.5911 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 61                                 286 
No event - administrative censoring 
                               8469 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 8816 
Patients with events (event = 1): 286 
Patients without events (event = 0): 8530 
Event distribution by treatment:
   
       0    1
  0 5111  170
  1 3419  116

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   574.0   941.0   971.6  1413.0  2098.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 286 
Final events: 286 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  5281     34.0   8.02       32.8          39
2         1  3535     34.9   7.67       33.9          28

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          24    487       1239    1457     1016      1019   39
  1          14    213        734     978      809       759   28

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  5281       8.17     2.07         7.70           621
2         1  3535       8.18     1.80         7.9            226

Total sample size: 8816 
Total events: 286 

Index Year Distribution:

2018 2019 2020 2021 
2513 2408 1869 2026 
Excluding 'dem' covariate for ADRD outcome analysis
Note: Dropping 907 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          4627              34.4
2         1          3282              34.5

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        17.5       0.00441
 2         0 Normal            356.        0.0898 
 3         0 Overweight        885.        0.223  
 4         0 Obese I          1087.        0.274  
 5         0 Obese II          794.        0.200  
 6         0 Obese III         825.        0.208  
 7         1 Underweight        16.8       0.00425
 8         1 Normal            259.        0.0655 
 9         1 Overweight        867.        0.220  
10         1 Obese I          1134.        0.287  
11         1 Obese II          876.        0.222  
12         1 Obese III         792.        0.201  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            4627                8.19
2         1            3282                8.21
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_SGLT2_vs_SU_DPP4_ADRD.csv 

Standardized Mean Differences - Before Weighting (Top 10):
       variable std_diff
1    index_year   0.5672
2      Insulin1   0.2022
3          chf1   0.1925
4           mi1   0.1839
5         GLP11   0.1358
6  baseline_bmi   0.1109
7          mld1   0.1055
8          pvd1   0.0910
9           age   0.0888
10      cancer1   0.0816

Standardized Mean Differences - After Weighting (Top 10):
         variable std_diff
1            CCB1  -0.0115
2  baseline_hba1c   0.0114
3       OtherHTN1  -0.0112
4          income  -0.0108
5    baseline_bmi   0.0107
6            mld1   0.0095
7             mc1  -0.0094
8      index_year  -0.0092
9         sex_cat   0.0087
10            mi1   0.0085

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5781  0.6915  0.8408  1.0000  1.1287  2.9552 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  4627    159      3964.            140.   0.0344        0.0354
2         1  3282    116      3945.            126.   0.0353        0.0319

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 7909, number of events= 275 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)
treatment -0.1991    0.8194   0.1228    0.1297 -1.535    0.125

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.8194       1.22    0.6355     1.057

Concordance= 0.525  (se = 0.017 )
Likelihood ratio test= 2.64  on 1 df,   p=0.1
Wald test            = 2.36  on 1 df,   p=0.1
Score (logrank) test = 2.64  on 1 df,   p=0.1,   Robust = 2.39  p=0.1

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: SGLT2 vs SU_DPP4 - ADRD 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
index_year                    0.5672    -0.0092     0.5672     0.0092
Insulin1                      0.2022     0.0037     0.2022     0.0037
chf1                          0.1925    -0.0004     0.1925     0.0004
mi1                           0.1839     0.0085     0.1839     0.0085
GLP11                         0.1358     0.0063     0.1358     0.0063
baseline_bmi                  0.1109     0.0107     0.1109     0.0107
mld1                          0.1055     0.0095     0.1055     0.0095
pvd1                          0.0910    -0.0005     0.0910     0.0005
age                           0.0888    -0.0068     0.0888     0.0068
cancer1                       0.0816     0.0015     0.0816     0.0015
cpd1                          0.0797    -0.0022     0.0797     0.0022
OtherHTN1                    -0.0781    -0.0112     0.0781     0.0112
rd1                           0.0764    -0.0078     0.0764     0.0078
Statin1                       0.0670    -0.0019     0.0670     0.0019
ph1                           0.0621    -0.0046     0.0621     0.0046
CCB1                         -0.0561    -0.0115     0.0561     0.0115
cvd1                          0.0535    -0.0015     0.0535     0.0015
BB1                           0.0440    -0.0010     0.0440     0.0010
Biguanide1                   -0.0434    -0.0033     0.0434     0.0033
mc1                          -0.0428    -0.0094     0.0428     0.0094
raceethnicity_cat             0.0406    -0.0033     0.0406     0.0033
MRA1                          0.0357     0.0069     0.0357     0.0069
Ezetimibe1                    0.0329    -0.0055     0.0329     0.0055
pud1                          0.0316     0.0036     0.0316     0.0036
income                       -0.0290    -0.0108     0.0290     0.0108
TZD1                         -0.0273    -0.0011     0.0273     0.0011
hiv1                          0.0265     0.0046     0.0265     0.0046
RAAS1                         0.0254    -0.0053     0.0254     0.0053
Anticoagulant1                0.0180    -0.0013     0.0180     0.0013
ctd1                          0.0179     0.0022     0.0179     0.0022
education                     0.0179    -0.0039     0.0179     0.0039
Antiplatelet1                 0.0165    -0.0064     0.0165     0.0064
sex_cat                      -0.0096     0.0087     0.0096     0.0087
Diuretic1                     0.0075    -0.0060     0.0075     0.0060
msld1                         0.0073    -0.0005     0.0073     0.0005
baseline_hba1c                0.0062     0.0114     0.0062     0.0114
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 7
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 35
Mean |SMD| before: 0.0753
Mean |SMD| after: 0.0054
Maximum |SMD| before: 0.5672 (index_year)
Maximum |SMD| after: 0.0115 (CCB1)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_SGLT2_vs_SU_DPP4_ADRD.csv 


Debug: weighted_df columns: person_id sglt2_idx su_dpp4_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 7909 
Debug: event_time_months range: 0 68.92247 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_SGLT2_vs_SU_DPP4_ADRD.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for SGLT2 vs SU_DPP4 - ADRD :
- Initial cohort (T2DM): 10384 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 8816 (excluded: 1253 )
- After age filtering: 7909 (excluded: 0 )
- Final events: 275 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for ADRD ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 7909 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, sglt2_idx, su_dpp4_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       3360             2.19                 3360
2         1       2648             2.48                 2648
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 6008 out of 7909 
Patients with baseline HbA1c data: 7909 
Patients with weighted mean HbA1c data: 6008 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.18 SD: 1.97 
Weighted Mean HbA1c - Mean: 7.8 SD: 1.7 
Correlation between baseline and weighted mean: 0.75 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 7505 
Total events: 249 

Diagnostic after HbA1c filtering:
Remaining patients: 7505 
Remaining events: 249 
Events by treatment: 
   
       0    1
  0 4208  139
  1 3048  110

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
               Estimate Std. Error    t value  Pr(>|t|)
(Intercept)  9.49147175 0.11957568 79.3762754 0.0000000
treatment   -0.02452773 0.04268348 -0.5746422 0.5655558
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                 Estimate Std. Error   z value   Pr(>|z|)
treatment      0.13077945 0.14789976 0.8842438 0.37656460
hba1c_mean_6mo 0.09800697 0.04618307 2.1221409 0.03382591

=== IPWT Mediation Analysis Summary for ADRD ===
A path (Treatment -> HbA1c): -0.02452773 p = 0.5655558 
B path (HbA1c -> Outcome): 0.09800697 p = 0.03382591 
C path (Direct Effect): 0.1307794 p = 0.3765646 
Indirect Effect (A*B): -0.002403889 p = 0.5791227 (Sobel test)
Total Effect (C + A*B): 0.1283756 

--- HbA1c Mediation Analysis End for ADRD ---

========= IPWT Analysis: SGLT2 vs SU_DPP4 - stroke =========

=== INITIAL COHORT DEBUG ===
Total patients after DM filter: 10384 
Treatment distribution: 6176 4208 

Raw outcome variable ( stroke_start_date ) summary:
Total patients with outcome dates: 1361 
Total patients without outcome dates: 9023 
Outcome date range: 9123 to 19629 
===========================

Before excluding pre-existing stroke patients: 10384 

=== DEBUGGING DATE-BASED EXCLUSIONS ===
Stroke diagnosed BEFORE index date (excluding): 899 
Patients eligible for analysis: 9485 
=======================================
After excluding pre-existing stroke patients: 9485 (excluded: 899 patients)

=== AFTER EXCLUSION DEBUG ===
Patients with outcome dates after exclusion: 462 
Treatment distribution after exclusion: 5726 3759 
Outcome date range after exclusion: 17554 to 19629 
Outcomes occurring AFTER index date: 440 
=============================

Baseline BMI Selection Summary:
# A tibble: 1 × 4
  n_patients_with_bmi median_days_from_index mean_days_from_index
                <int>                  <dbl>                <dbl>
1                9424                      3                 99.1
# ℹ 1 more variable: max_days_from_index <dbl>

Baseline HbA1c Selection Summary:
# A tibble: 1 × 4
  n_patients_with_hba1c median_days_from_index mean_days_from_index
                  <int>                  <dbl>                <dbl>
1                  8441                     28                 220.
# ℹ 1 more variable: max_days_from_index <dbl>

=== BEFORE FOLLOWUP_AND_EVENT ===
Total patients going into followup_and_event: 9485 
Patients with outcome dates: 462 

--- DEBUG followup_and_event function ---
Input parameters:
- outcome_var: stroke_start_date 
- data_cut_date: 2023-10-01 
- late_onset: FALSE 
- early_onset: FALSE 
- Input data rows: 9485 
- Patients with outcome dates: 462 
- Outcome date range: 17554 to 19629 

DEBUG intermediate calculations:
- Crossover dates available: 0 
- EHR end dates available: 7888 
- Raw events (before late-onset filter): 334 
- Events after time >= 0 filter: 334 
- Patients filtered out due to event_time < 0: 1173 

Event time distribution:
- Min event_time: 0 
- Max event_time: 2098 
- Mean event_time: 965.4506 

Censoring reasons:

              Event after censoring                      Event occurred 
                                 86                                 334 
No event - administrative censoring 
                               7892 
--- END DEBUG followup_and_event ---


=== AFTER FOLLOWUP_AND_EVENT ===
Total patients after followup_and_event: 8312 
Patients with events (event = 1): 334 
Patients without events (event = 0): 7978 
Event distribution by treatment:
   
       0    1
  0 4807  221
  1 3171  113

Event time summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   568.0   938.0   965.5  1407.2  2098.0 
Patients with negative event_time (should be 0): 0 

Raw events vs final events:
Raw events: 334 
Final events: 334 
=============================

Baseline BMI Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_bmi sd_bmi median_bmi missing_bmi
      <dbl> <int>    <dbl>  <dbl>      <dbl>       <int>
1         0  5028     34.0   8.03       32.9          37
2         1  3284     35.0   7.73       34.1          23

Baseline BMI Category Distribution (Before Weighting):
   
    Underweight Normal Overweight Obese I Obese II Obese III <NA>
  0          23    468       1175    1384      962       979   37
  1          15    193        676     888      766       723   23

Baseline HbA1c Comparison (Before Weighting):
# A tibble: 2 × 6
  treatment     n mean_hba1c sd_hba1c median_hba1c missing_hba1c
      <dbl> <int>      <dbl>    <dbl>        <dbl>         <int>
1         0  5028       8.19     2.09          7.7           610
2         1  3284       8.17     1.80          7.9           223

Total sample size: 8312 
Total events: 334 

Index Year Distribution:

2018 2019 2020 2021 
2400 2270 1755 1887 
Excluding 'cvd' covariate for Stroke outcome analysis
Note: Dropping 886 rows with missing values in covariates

Baseline BMI Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_bmi_calc mean_bmi_weighted
      <dbl>         <int>             <dbl>
1         0          4387              34.5
2         1          3039              34.6

Baseline BMI Category Distribution (After IPWT Weighting - Weighted Proportions):
# A tibble: 12 × 4
   treatment bmi_category weighted_n weighted_prop
       <dbl> <fct>             <dbl>         <dbl>
 1         0 Underweight        16.2       0.00437
 2         0 Normal            336.        0.0905 
 3         0 Overweight        823.        0.221  
 4         0 Obese I          1010.        0.272  
 5         0 Obese II          738.        0.199  
 6         0 Obese III         793.        0.213  
 7         1 Underweight        17.8       0.00480
 8         1 Normal            241.        0.0649 
 9         1 Overweight        816.        0.220  
10         1 Obese I          1050.        0.283  
11         1 Obese II          828.        0.223  
12         1 Obese III         757.        0.204  

Baseline HbA1c Comparison (After IPWT Weighting):
# A tibble: 2 × 3
  treatment n_in_hba1c_calc mean_hba1c_weighted
      <dbl>           <int>               <dbl>
1         0            4387                8.20
2         1            3039                8.22
Error creating weighted characteristics table: unused arguments (treatment_group, weighting, n, formatted_val) 
Saved cohort data to bucket: ipwt_cohort_SGLT2_vs_SU_DPP4_stroke.csv 

Standardized Mean Differences - Before Weighting (Top 10):
       variable std_diff
1    index_year   0.5776
2      Insulin1   0.1887
3          chf1   0.1698
4           mi1   0.1551
5         GLP11   0.1352
6  baseline_bmi   0.1253
7          mld1   0.1023
8       cancer1   0.0907
9           age   0.0833
10         cpd1   0.0729

Standardized Mean Differences - After Weighting (Top 10):
         variable std_diff
1          income  -0.0107
2  baseline_hba1c   0.0106
3             mc1  -0.0098
4            CCB1  -0.0093
5       OtherHTN1  -0.0092
6    baseline_bmi   0.0087
7             mi1   0.0087
8             rd1  -0.0077
9      Ezetimibe1  -0.0075
10            age  -0.0075

IPWT Weight Summary:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.5772  0.6877  0.8351  1.0000  1.1313  3.0453 

Weighted Event Counts:
# A tibble: 2 × 7
  treatment     n events weighted_n weighted_events raw_rate weighted_rate
      <dbl> <int>  <int>      <dbl>           <dbl>    <dbl>         <dbl>
1         0  4387    207      3717.            177.   0.0472        0.0477
2         1  3039    109      3709.            134.   0.0359        0.0362

Weighted Cox Results:
Call:
coxph(formula = Surv(event_time, event) ~ treatment, data = df_complete, 
    weights = ipw_std)

  n= 7426, number of events= 316 

             coef exp(coef) se(coef) robust se      z Pr(>|z|)   
treatment -0.3758    0.6867   0.1145    0.1279 -2.938   0.0033 **
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

          exp(coef) exp(-coef) lower .95 upper .95
treatment    0.6867      1.456    0.5344    0.8824

Concordance= 0.556  (se = 0.016 )
Likelihood ratio test= 10.9  on 1 df,   p=0.001
Wald test            = 8.63  on 1 df,   p=0.003
Score (logrank) test = 10.91  on 1 df,   p=0.001,   Robust = 9.28  p=0.002

  (Note: the likelihood ratio and score tests assume independence of
     observations within a cluster, the Wald and robust score tests do not).

 ================================================================================ 
STANDARDIZED MEAN DIFFERENCES TABLE: SGLT2 vs SU_DPP4 - stroke 
================================================================================ 
Variable                      Before      After Abs_Before Abs_After
--------------------------------------------------------------------------- 
index_year                    0.5776     0.0061     0.5776     0.0061
Insulin1                      0.1887     0.0029     0.1887     0.0029
chf1                          0.1698    -0.0023     0.1698     0.0023
mi1                           0.1551     0.0087     0.1551     0.0087
GLP11                         0.1352     0.0033     0.1352     0.0033
baseline_bmi                  0.1253     0.0087     0.1253     0.0087
mld1                          0.1023     0.0070     0.1023     0.0070
cancer1                       0.0907     0.0012     0.0907     0.0012
age                           0.0833    -0.0075     0.0833     0.0075
cpd1                          0.0729    -0.0039     0.0729     0.0039
pvd1                          0.0727    -0.0029     0.0727     0.0029
OtherHTN1                    -0.0712    -0.0092     0.0712     0.0092
rd1                           0.0665    -0.0077     0.0665     0.0077
Statin1                       0.0578    -0.0017     0.0578     0.0017
CCB1                         -0.0538    -0.0093     0.0538     0.0093
Biguanide1                   -0.0505    -0.0033     0.0505     0.0033
raceethnicity_cat             0.0478    -0.0031     0.0478     0.0031
mc1                          -0.0401    -0.0098     0.0401     0.0098
BB1                           0.0384    -0.0007     0.0384     0.0007
income                       -0.0376    -0.0107     0.0376     0.0107
MRA1                          0.0359     0.0074     0.0359     0.0074
Ezetimibe1                    0.0310    -0.0075     0.0310     0.0075
TZD1                         -0.0307    -0.0034     0.0307     0.0034
RAAS1                         0.0261    -0.0067     0.0261     0.0067
ctd1                          0.0260     0.0007     0.0260     0.0007
Diuretic1                     0.0243    -0.0056     0.0243     0.0056
hiv1                          0.0232     0.0041     0.0232     0.0041
dem1                         -0.0221     0.0017     0.0221     0.0017
Antiplatelet1                 0.0192    -0.0060     0.0192     0.0060
sex_cat                      -0.0161     0.0060     0.0161     0.0060
pud1                          0.0148     0.0043     0.0148     0.0043
baseline_hba1c               -0.0105     0.0106     0.0105     0.0106
Anticoagulant1                0.0080     0.0009     0.0080     0.0009
ph1                          -0.0038    -0.0066     0.0038     0.0066
education                     0.0031    -0.0055     0.0031     0.0055
msld1                        -0.0008     0.0000     0.0008     0.0000
--------------------------------------------------------------------------- 
Summary Statistics:
Variables with |SMD| > 0.1 before IPTW: 7
Variables with |SMD| > 0.1 after IPTW: 0
Variables improved (reduced |SMD|): 33
Mean |SMD| before: 0.0704
Mean |SMD| after: 0.0052
Maximum |SMD| before: 0.5776 (index_year)
Maximum |SMD| after: 0.0107 (income)
================================================================================ 
SMD comparison table saved to: smd_comparison_table_SGLT2_vs_SU_DPP4_stroke.csv 


Debug: weighted_df columns: person_id sglt2_idx su_dpp4_idx index_date treatment date_of_birth race ethnicity sex ins1 ins2 aname1 aname2 aname3 aname4 aname5 aname6 aname7 aname8 raceethnicity age age_group age_group_code sex_cat race_cat ethnicity_cat raceethnicity_cat insurance insurance_2 income education cigs cigs_frequency smoking alcohol alcohol_freq avg_daily_drink heavy_drink_freq missing_alcohol_data insurance_category avg_daily_drink_value alcohol_freq_value weekly_alcohol_grams alcohol_exclusion epilepsy_or_seizure_start_date epilepsy_or_seizure mci_start_date mci adrd_start_date adrd stroke_start_date stroke EHRminDT EHRmaxDT first_survey_date Anticoagulant Antiplatelet BB Biguanide CCB DPP4 Diuretic Ezetimibe GLP1 MRA OtherHTN PCSK9 RAAS SGLT2 SU Statin TZD Insulin mi chf pvd cvd dem cpd ctd pud mld dm dmc ph rd cancer msld mc hiv dob age_at_end baseline_bmi baseline_hba1c index_year bmi_category crossover_date outcome_date ehr_end censor_date event_time raw_event age_at_event event ps ipw ipw_trimmed ipw_std 
Debug: weighted_df rows: 7426 
Debug: event_time_months range: 0 68.92247 
Debug: cum_incidence_fit created with direct Surv() call
Debug: surv_plot created successfully
Debug: Attempting to save plot as: ipwt_survival_SGLT2_vs_SU_DPP4_stroke.png 

Debug: Plot saved successfully

=== Generating Study Flowchart ===
Study flow summary for SGLT2 vs SU_DPP4 - stroke :
- Initial cohort (T2DM): 10384 
- After pre-existing exclusion: (excluded: )
- After follow-up requirements: 8312 (excluded: 1173 )
- After age filtering: 7426 (excluded: 0 )
- Final events: 316 
Error generating flowchart: could not find function "export_svg" 

--- HbA1c Mediation Analysis for stroke ---

Calculating 1-year weighted mean HbA1c for mediation analysis
Total patients in IPWT cohort: 7426 
Using weighted mean HbA1c calculation with weights: ipw_std 

=== Calculating 1-Year Weighted Mean HbA1c ===
DEBUG: Available columns in cohort: person_id, sglt2_idx, su_dpp4_idx, index_date, treatment, date_of_birth, race, ethnicity, sex, ins1, ins2, aname1, aname2, aname3, aname4, aname5, aname6, aname7, aname8, raceethnicity, age, age_group, age_group_code, sex_cat, race_cat, ethnicity_cat, raceethnicity_cat, insurance, insurance_2, income, education, cigs, cigs_frequency, smoking, alcohol, alcohol_freq, avg_daily_drink, heavy_drink_freq, missing_alcohol_data, insurance_category, avg_daily_drink_value, alcohol_freq_value, weekly_alcohol_grams, alcohol_exclusion, epilepsy_or_seizure_start_date, epilepsy_or_seizure, mci_start_date, mci, adrd_start_date, adrd, stroke_start_date, stroke, EHRminDT, EHRmaxDT, first_survey_date, Anticoagulant, Antiplatelet, BB, Biguanide, CCB, DPP4, Diuretic, Ezetimibe, GLP1, MRA, OtherHTN, PCSK9, RAAS, SGLT2, SU, Statin, TZD, Insulin, mi, chf, pvd, cvd, dem, cpd, ctd, pud, mld, dm, dmc, ph, rd, cancer, msld, mc, hiv, dob, age_at_end, baseline_bmi, baseline_hba1c, index_year, bmi_category, crossover_date, outcome_date, ehr_end, censor_date, event_time, raw_event, age_at_event, event, ps, ipw, ipw_trimmed, ipw_std 
DEBUG: Looking for weight variable: ipw_std 
DEBUG: Weight variable ipw_std found successfully.

HbA1c measurement summary:
# A tibble: 2 × 7
  treatment n_patients avg_measurements patients_with_1_plus
      <dbl>      <int>            <dbl>                <int>
1         0       3196             2.19                 3196
2         1       2442             2.47                 2442
# ℹ 3 more variables: patients_with_2_plus <int>, mean_weighted_hba1c <dbl>,
#   sd_weighted_hba1c <dbl>

Patients with weighted mean HbA1c: 5638 out of 7426 
Patients with baseline HbA1c data: 7426 
Patients with weighted mean HbA1c data: 5638 

--- HbA1c Distribution Comparison ---
Baseline HbA1c - Mean: 8.18 SD: 1.98 
Weighted Mean HbA1c - Mean: 7.8 SD: 1.71 
Correlation between baseline and weighted mean: 0.751 

Diagnostic after outcome redefinition but before HbA1c filtering:
Total patients: 7023 
Total events: 271 

Diagnostic after HbA1c filtering:
Remaining patients: 7023 
Remaining events: 271 
Events by treatment: 
   
       0    1
  0 3934  172
  1 2818   99

Mediation analysis with IPWT approach:

중재자 모델 공식: hba1c_mean_6mo ~ treatment + age + sex_cat + raceethnicity_cat 
중재자 모델 성공! (가중치 적용됨)

중재자 모델 요약:
               Estimate Std. Error   t value Pr(>|t|)
(Intercept)  9.54403677 0.12255858 77.873267 0.000000
treatment   -0.05046762 0.04412438 -1.143758 0.252775
Warning message in eval(family$initialize):
“non-integer #successes in a binomial glm!”

결과 모델 공식: event ~ treatment + hba1c_mean_6mo + age + sex_cat + raceethnicity_cat 
결과 모델 성공! (가중치 적용됨)

결과 모델 요약:
                  Estimate Std. Error   z value   Pr(>|z|)
treatment      -0.17346252 0.14372968 -1.206866 0.22748361
hba1c_mean_6mo  0.08403023 0.04172132  2.014083 0.04400077

=== IPWT Mediation Analysis Summary for stroke ===
A path (Treatment -> HbA1c): -0.05046762 p = 0.252775 
B path (HbA1c -> Outcome): 0.08403023 p = 0.04400077 
C path (Direct Effect): -0.1734625 p = 0.2274836 
Indirect Effect (A*B): -0.004240805 p = 0.3199422 (Sobel test)
Total Effect (C + A*B): -0.1777033 

--- HbA1c Mediation Analysis End for stroke ---

=== IPWT Mediation Analysis Summary Table ===
                                                  method       comparison
GLP1 vs SGLT2 - Epilepsy/Seizure.1                  IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Epilepsy/Seizure.2                  IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Epilepsy/Seizure.3                  IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Epilepsy/Seizure.4                  IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1      IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2      IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3      IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4      IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1       IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2       IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3       IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4       IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - ADRD.1                              IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - ADRD.2                              IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - ADRD.3                              IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - ADRD.4                              IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - stroke.1                            IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - stroke.2                            IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - stroke.3                            IPWT    GLP1 vs SGLT2
GLP1 vs SGLT2 - stroke.4                            IPWT    GLP1 vs SGLT2
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1                IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2                IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3                IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4                IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1    IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2    IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3    IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4    IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1     IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2     IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3     IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4     IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - ADRD.1                            IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - ADRD.2                            IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - ADRD.3                            IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - ADRD.4                            IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - stroke.1                          IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - stroke.2                          IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - stroke.3                          IPWT  GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - stroke.4                          IPWT  GLP1 vs SU_DPP4
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1               IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2               IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3               IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4               IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1   IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2   IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3   IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4   IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1    IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2    IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3    IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4    IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - ADRD.1                           IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - ADRD.2                           IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - ADRD.3                           IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - ADRD.4                           IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - stroke.1                         IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - stroke.2                         IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - stroke.3                         IPWT SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - stroke.4                         IPWT SGLT2 vs SU_DPP4
                                                                       outcome
GLP1 vs SGLT2 - Epilepsy/Seizure.1                            Epilepsy/Seizure
GLP1 vs SGLT2 - Epilepsy/Seizure.2                            Epilepsy/Seizure
GLP1 vs SGLT2 - Epilepsy/Seizure.3                            Epilepsy/Seizure
GLP1 vs SGLT2 - Epilepsy/Seizure.4                            Epilepsy/Seizure
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1    Early-onset Epilepsy/Seizure
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2    Early-onset Epilepsy/Seizure
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3    Early-onset Epilepsy/Seizure
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4    Early-onset Epilepsy/Seizure
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1      Late-onset Epilepsy/Seizure
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2      Late-onset Epilepsy/Seizure
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3      Late-onset Epilepsy/Seizure
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4      Late-onset Epilepsy/Seizure
GLP1 vs SGLT2 - ADRD.1                                                    ADRD
GLP1 vs SGLT2 - ADRD.2                                                    ADRD
GLP1 vs SGLT2 - ADRD.3                                                    ADRD
GLP1 vs SGLT2 - ADRD.4                                                    ADRD
GLP1 vs SGLT2 - stroke.1                                                stroke
GLP1 vs SGLT2 - stroke.2                                                stroke
GLP1 vs SGLT2 - stroke.3                                                stroke
GLP1 vs SGLT2 - stroke.4                                                stroke
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1                          Epilepsy/Seizure
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2                          Epilepsy/Seizure
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3                          Epilepsy/Seizure
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4                          Epilepsy/Seizure
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1  Early-onset Epilepsy/Seizure
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2  Early-onset Epilepsy/Seizure
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3  Early-onset Epilepsy/Seizure
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4  Early-onset Epilepsy/Seizure
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1    Late-onset Epilepsy/Seizure
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2    Late-onset Epilepsy/Seizure
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3    Late-onset Epilepsy/Seizure
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4    Late-onset Epilepsy/Seizure
GLP1 vs SU_DPP4 - ADRD.1                                                  ADRD
GLP1 vs SU_DPP4 - ADRD.2                                                  ADRD
GLP1 vs SU_DPP4 - ADRD.3                                                  ADRD
GLP1 vs SU_DPP4 - ADRD.4                                                  ADRD
GLP1 vs SU_DPP4 - stroke.1                                              stroke
GLP1 vs SU_DPP4 - stroke.2                                              stroke
GLP1 vs SU_DPP4 - stroke.3                                              stroke
GLP1 vs SU_DPP4 - stroke.4                                              stroke
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1                         Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2                         Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3                         Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4                         Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1 Early-onset Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2 Early-onset Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3 Early-onset Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4 Early-onset Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1   Late-onset Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2   Late-onset Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3   Late-onset Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4   Late-onset Epilepsy/Seizure
SGLT2 vs SU_DPP4 - ADRD.1                                                 ADRD
SGLT2 vs SU_DPP4 - ADRD.2                                                 ADRD
SGLT2 vs SU_DPP4 - ADRD.3                                                 ADRD
SGLT2 vs SU_DPP4 - ADRD.4                                                 ADRD
SGLT2 vs SU_DPP4 - stroke.1                                             stroke
SGLT2 vs SU_DPP4 - stroke.2                                             stroke
SGLT2 vs SU_DPP4 - stroke.3                                             stroke
SGLT2 vs SU_DPP4 - stroke.4                                             stroke
                                                                                                              effect
GLP1 vs SGLT2 - Epilepsy/Seizure.1                Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SGLT2 - Epilepsy/Seizure.2                                                      Direct Effect of Semaglutide
GLP1 vs SGLT2 - Epilepsy/Seizure.3                                                 Indirect Effect mediated by HbA1c
GLP1 vs SGLT2 - Epilepsy/Seizure.4                                                        A Path (Treatment → HbA1c)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1    Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2                                          Direct Effect of Semaglutide
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3                                     Indirect Effect mediated by HbA1c
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4                                            A Path (Treatment → HbA1c)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1     Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2                                           Direct Effect of Semaglutide
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3                                      Indirect Effect mediated by HbA1c
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4                                             A Path (Treatment → HbA1c)
GLP1 vs SGLT2 - ADRD.1                            Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SGLT2 - ADRD.2                                                                  Direct Effect of Semaglutide
GLP1 vs SGLT2 - ADRD.3                                                             Indirect Effect mediated by HbA1c
GLP1 vs SGLT2 - ADRD.4                                                                    A Path (Treatment → HbA1c)
GLP1 vs SGLT2 - stroke.1                          Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SGLT2 - stroke.2                                                                Direct Effect of Semaglutide
GLP1 vs SGLT2 - stroke.3                                                           Indirect Effect mediated by HbA1c
GLP1 vs SGLT2 - stroke.4                                                                  A Path (Treatment → HbA1c)
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1              Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2                                                    Direct Effect of Semaglutide
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3                                               Indirect Effect mediated by HbA1c
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4                                                      A Path (Treatment → HbA1c)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1  Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2                                        Direct Effect of Semaglutide
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3                                   Indirect Effect mediated by HbA1c
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4                                          A Path (Treatment → HbA1c)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1   Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2                                         Direct Effect of Semaglutide
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3                                    Indirect Effect mediated by HbA1c
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4                                           A Path (Treatment → HbA1c)
GLP1 vs SU_DPP4 - ADRD.1                          Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SU_DPP4 - ADRD.2                                                                Direct Effect of Semaglutide
GLP1 vs SU_DPP4 - ADRD.3                                                           Indirect Effect mediated by HbA1c
GLP1 vs SU_DPP4 - ADRD.4                                                                  A Path (Treatment → HbA1c)
GLP1 vs SU_DPP4 - stroke.1                        Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SU_DPP4 - stroke.2                                                              Direct Effect of Semaglutide
GLP1 vs SU_DPP4 - stroke.3                                                         Indirect Effect mediated by HbA1c
GLP1 vs SU_DPP4 - stroke.4                                                                A Path (Treatment → HbA1c)
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1             Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2                                                   Direct Effect of Semaglutide
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3                                              Indirect Effect mediated by HbA1c
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4                                                     A Path (Treatment → HbA1c)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1 Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2                                       Direct Effect of Semaglutide
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3                                  Indirect Effect mediated by HbA1c
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4                                         A Path (Treatment → HbA1c)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1  Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2                                        Direct Effect of Semaglutide
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3                                   Indirect Effect mediated by HbA1c
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4                                          A Path (Treatment → HbA1c)
SGLT2 vs SU_DPP4 - ADRD.1                         Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
SGLT2 vs SU_DPP4 - ADRD.2                                                               Direct Effect of Semaglutide
SGLT2 vs SU_DPP4 - ADRD.3                                                          Indirect Effect mediated by HbA1c
SGLT2 vs SU_DPP4 - ADRD.4                                                                 A Path (Treatment → HbA1c)
SGLT2 vs SU_DPP4 - stroke.1                       Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
SGLT2 vs SU_DPP4 - stroke.2                                                             Direct Effect of Semaglutide
SGLT2 vs SU_DPP4 - stroke.3                                                        Indirect Effect mediated by HbA1c
SGLT2 vs SU_DPP4 - stroke.4                                                               A Path (Treatment → HbA1c)
                                                     beta     se
GLP1 vs SGLT2 - Epilepsy/Seizure.1                -0.7296 0.2844
GLP1 vs SGLT2 - Epilepsy/Seizure.2                -0.6777 0.2836
GLP1 vs SGLT2 - Epilepsy/Seizure.3                -0.0519 0.0215
GLP1 vs SGLT2 - Epilepsy/Seizure.4                -0.2725 0.0480
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1    -0.7296 0.2844
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2    -0.6777 0.2836
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3    -0.0519 0.0215
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4    -0.2725 0.0480
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1     -0.7782 0.3071
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2     -0.7516 0.3062
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3     -0.0266 0.0230
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4     -0.2633 0.0493
GLP1 vs SGLT2 - ADRD.1                            -0.2881 0.1970
GLP1 vs SGLT2 - ADRD.2                            -0.2390 0.1961
GLP1 vs SGLT2 - ADRD.3                            -0.0491 0.0191
GLP1 vs SGLT2 - ADRD.4                            -0.2870 0.0475
GLP1 vs SGLT2 - stroke.1                           0.2581 0.1797
GLP1 vs SGLT2 - stroke.2                           0.3142 0.1789
GLP1 vs SGLT2 - stroke.3                          -0.0561 0.0168
GLP1 vs SGLT2 - stroke.4                          -0.2612 0.0493
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1              -0.8343 0.2339
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2              -0.8032 0.2329
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3              -0.0312 0.0221
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4              -0.3684 0.0446
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1  -0.8343 0.2339
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2  -0.8032 0.2329
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3  -0.0312 0.0221
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4  -0.3684 0.0446
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1   -0.8569 0.2549
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2   -0.8466 0.2539
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3   -0.0103 0.0230
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4   -0.3252 0.0458
GLP1 vs SU_DPP4 - ADRD.1                          -0.2555 0.1734
GLP1 vs SU_DPP4 - ADRD.2                          -0.2265 0.1721
GLP1 vs SU_DPP4 - ADRD.3                          -0.0290 0.0211
GLP1 vs SU_DPP4 - ADRD.4                          -0.3779 0.0441
GLP1 vs SU_DPP4 - stroke.1                         0.0166 0.1479
GLP1 vs SU_DPP4 - stroke.2                         0.1099 0.1468
GLP1 vs SU_DPP4 - stroke.3                        -0.0933 0.0185
GLP1 vs SU_DPP4 - stroke.4                        -0.3972 0.0453
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1             -0.1366 0.1851
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2             -0.1349 0.1850
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3             -0.0018 0.0038
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4             -0.0207 0.0428
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1 -0.1366 0.1851
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2 -0.1349 0.1850
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3 -0.0018 0.0038
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4 -0.0207 0.0428
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1  -0.1500 0.1998
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2  -0.1526 0.1998
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3   0.0025 0.0048
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4   0.0240 0.0438
SGLT2 vs SU_DPP4 - ADRD.1                          0.1284 0.1480
SGLT2 vs SU_DPP4 - ADRD.2                          0.1308 0.1479
SGLT2 vs SU_DPP4 - ADRD.3                         -0.0024 0.0043
SGLT2 vs SU_DPP4 - ADRD.4                         -0.0245 0.0427
SGLT2 vs SU_DPP4 - stroke.1                       -0.1777 0.1438
SGLT2 vs SU_DPP4 - stroke.2                       -0.1735 0.1437
SGLT2 vs SU_DPP4 - stroke.3                       -0.0042 0.0043
SGLT2 vs SU_DPP4 - stroke.4                       -0.0505 0.0441
                                                           beta_se    hr
GLP1 vs SGLT2 - Epilepsy/Seizure.1                -0.7296 (0.2844) 0.482
GLP1 vs SGLT2 - Epilepsy/Seizure.2                -0.6777 (0.2836) 0.508
GLP1 vs SGLT2 - Epilepsy/Seizure.3                -0.0519 (0.0215) 0.949
GLP1 vs SGLT2 - Epilepsy/Seizure.4                -0.2725 (0.0480)   N/A
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1    -0.7296 (0.2844) 0.482
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2    -0.6777 (0.2836) 0.508
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3    -0.0519 (0.0215) 0.949
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4    -0.2725 (0.0480)   N/A
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1     -0.7782 (0.3071) 0.459
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2     -0.7516 (0.3062) 0.472
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3     -0.0266 (0.0230) 0.974
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4     -0.2633 (0.0493)   N/A
GLP1 vs SGLT2 - ADRD.1                            -0.2881 (0.1970) 0.750
GLP1 vs SGLT2 - ADRD.2                            -0.2390 (0.1961) 0.787
GLP1 vs SGLT2 - ADRD.3                            -0.0491 (0.0191) 0.952
GLP1 vs SGLT2 - ADRD.4                            -0.2870 (0.0475)   N/A
GLP1 vs SGLT2 - stroke.1                           0.2581 (0.1797) 1.294
GLP1 vs SGLT2 - stroke.2                           0.3142 (0.1789) 1.369
GLP1 vs SGLT2 - stroke.3                          -0.0561 (0.0168) 0.945
GLP1 vs SGLT2 - stroke.4                          -0.2612 (0.0493)   N/A
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1              -0.8343 (0.2339) 0.434
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2              -0.8032 (0.2329) 0.448
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3              -0.0312 (0.0221) 0.969
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4              -0.3684 (0.0446)   N/A
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1  -0.8343 (0.2339) 0.434
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2  -0.8032 (0.2329) 0.448
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3  -0.0312 (0.0221) 0.969
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4  -0.3684 (0.0446)   N/A
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1   -0.8569 (0.2549) 0.424
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2   -0.8466 (0.2539) 0.429
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3   -0.0103 (0.0230) 0.990
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4   -0.3252 (0.0458)   N/A
GLP1 vs SU_DPP4 - ADRD.1                          -0.2555 (0.1734) 0.775
GLP1 vs SU_DPP4 - ADRD.2                          -0.2265 (0.1721) 0.797
GLP1 vs SU_DPP4 - ADRD.3                          -0.0290 (0.0211) 0.971
GLP1 vs SU_DPP4 - ADRD.4                          -0.3779 (0.0441)   N/A
GLP1 vs SU_DPP4 - stroke.1                         0.0166 (0.1479) 1.017
GLP1 vs SU_DPP4 - stroke.2                         0.1099 (0.1468) 1.116
GLP1 vs SU_DPP4 - stroke.3                        -0.0933 (0.0185) 0.911
GLP1 vs SU_DPP4 - stroke.4                        -0.3972 (0.0453)   N/A
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1             -0.1366 (0.1851) 0.872
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2             -0.1349 (0.1850) 0.874
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3             -0.0018 (0.0038) 0.998
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4             -0.0207 (0.0428)   N/A
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1 -0.1366 (0.1851) 0.872
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2 -0.1349 (0.1850) 0.874
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3 -0.0018 (0.0038) 0.998
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4 -0.0207 (0.0428)   N/A
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1  -0.1500 (0.1998) 0.861
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2  -0.1526 (0.1998) 0.859
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3   0.0025 (0.0048) 1.003
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4   0.0240 (0.0438)   N/A
SGLT2 vs SU_DPP4 - ADRD.1                          0.1284 (0.1480) 1.137
SGLT2 vs SU_DPP4 - ADRD.2                          0.1308 (0.1479) 1.140
SGLT2 vs SU_DPP4 - ADRD.3                         -0.0024 (0.0043) 0.998
SGLT2 vs SU_DPP4 - ADRD.4                         -0.0245 (0.0427)   N/A
SGLT2 vs SU_DPP4 - stroke.1                       -0.1777 (0.1438) 0.837
SGLT2 vs SU_DPP4 - stroke.2                       -0.1735 (0.1437) 0.841
SGLT2 vs SU_DPP4 - stroke.3                       -0.0042 (0.0043) 0.996
SGLT2 vs SU_DPP4 - stroke.4                       -0.0505 (0.0441)   N/A
                                                  hr_lower hr_upper
GLP1 vs SGLT2 - Epilepsy/Seizure.1                   0.276    0.842
GLP1 vs SGLT2 - Epilepsy/Seizure.2                   0.291    0.885
GLP1 vs SGLT2 - Epilepsy/Seizure.3                   0.910    0.990
GLP1 vs SGLT2 - Epilepsy/Seizure.4                     N/A      N/A
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1       0.276    0.842
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2       0.291    0.885
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3       0.910    0.990
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4         N/A      N/A
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1        0.252    0.838
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2        0.259    0.859
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3        0.931    1.019
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4          N/A      N/A
GLP1 vs SGLT2 - ADRD.1                               0.510    1.103
GLP1 vs SGLT2 - ADRD.2                               0.536    1.156
GLP1 vs SGLT2 - ADRD.3                               0.917    0.988
GLP1 vs SGLT2 - ADRD.4                                 N/A      N/A
GLP1 vs SGLT2 - stroke.1                             0.910    1.841
GLP1 vs SGLT2 - stroke.2                             0.964    1.944
GLP1 vs SGLT2 - stroke.3                             0.915    0.977
GLP1 vs SGLT2 - stroke.4                               N/A      N/A
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1                 0.275    0.687
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2                 0.284    0.707
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3                 0.928    1.012
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4                   N/A      N/A
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1     0.275    0.687
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2     0.284    0.707
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3     0.928    1.012
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4       N/A      N/A
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1      0.258    0.700
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2      0.261    0.705
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3      0.946    1.035
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4        N/A      N/A
GLP1 vs SU_DPP4 - ADRD.1                             0.551    1.088
GLP1 vs SU_DPP4 - ADRD.2                             0.569    1.117
GLP1 vs SU_DPP4 - ADRD.3                             0.932    1.013
GLP1 vs SU_DPP4 - ADRD.4                               N/A      N/A
GLP1 vs SU_DPP4 - stroke.1                           0.761    1.359
GLP1 vs SU_DPP4 - stroke.2                           0.837    1.488
GLP1 vs SU_DPP4 - stroke.3                           0.878    0.944
GLP1 vs SU_DPP4 - stroke.4                             N/A      N/A
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1                0.607    1.254
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2                0.608    1.256
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3                0.991    1.006
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4                  N/A      N/A
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1    0.607    1.254
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2    0.608    1.256
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3    0.991    1.006
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4      N/A      N/A
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1     0.582    1.273
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2     0.580    1.270
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3     0.993    1.012
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4       N/A      N/A
SGLT2 vs SU_DPP4 - ADRD.1                            0.851    1.520
SGLT2 vs SU_DPP4 - ADRD.2                            0.853    1.523
SGLT2 vs SU_DPP4 - ADRD.3                            0.989    1.006
SGLT2 vs SU_DPP4 - ADRD.4                              N/A      N/A
SGLT2 vs SU_DPP4 - stroke.1                          0.632    1.110
SGLT2 vs SU_DPP4 - stroke.2                          0.634    1.114
SGLT2 vs SU_DPP4 - stroke.3                          0.987    1.004
SGLT2 vs SU_DPP4 - stroke.4                            N/A      N/A
                                                                    hr_95ci
GLP1 vs SGLT2 - Epilepsy/Seizure.1                      0.482 (0.276-0.842)
GLP1 vs SGLT2 - Epilepsy/Seizure.2                      0.508 (0.291-0.885)
GLP1 vs SGLT2 - Epilepsy/Seizure.3                      0.949 (0.910-0.990)
GLP1 vs SGLT2 - Epilepsy/Seizure.4                -0.2725 (-0.3665--0.1785)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1          0.482 (0.276-0.842)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2          0.508 (0.291-0.885)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3          0.949 (0.910-0.990)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4    -0.2725 (-0.3665--0.1785)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1           0.459 (0.252-0.838)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2           0.472 (0.259-0.859)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3           0.974 (0.931-1.019)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4     -0.2633 (-0.3598--0.1667)
GLP1 vs SGLT2 - ADRD.1                                  0.750 (0.510-1.103)
GLP1 vs SGLT2 - ADRD.2                                  0.787 (0.536-1.156)
GLP1 vs SGLT2 - ADRD.3                                  0.952 (0.917-0.988)
GLP1 vs SGLT2 - ADRD.4                            -0.2870 (-0.3801--0.1938)
GLP1 vs SGLT2 - stroke.1                                1.294 (0.910-1.841)
GLP1 vs SGLT2 - stroke.2                                1.369 (0.964-1.944)
GLP1 vs SGLT2 - stroke.3                                0.945 (0.915-0.977)
GLP1 vs SGLT2 - stroke.4                          -0.2612 (-0.3578--0.1646)
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1                    0.434 (0.275-0.687)
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2                    0.448 (0.284-0.707)
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3                    0.969 (0.928-1.012)
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4              -0.3684 (-0.4558--0.2811)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1        0.434 (0.275-0.687)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2        0.448 (0.284-0.707)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3        0.969 (0.928-1.012)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4  -0.3684 (-0.4558--0.2811)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1         0.424 (0.258-0.700)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2         0.429 (0.261-0.705)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3         0.990 (0.946-1.035)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4   -0.3252 (-0.4150--0.2355)
GLP1 vs SU_DPP4 - ADRD.1                                0.775 (0.551-1.088)
GLP1 vs SU_DPP4 - ADRD.2                                0.797 (0.569-1.117)
GLP1 vs SU_DPP4 - ADRD.3                                0.971 (0.932-1.013)
GLP1 vs SU_DPP4 - ADRD.4                          -0.3779 (-0.4642--0.2915)
GLP1 vs SU_DPP4 - stroke.1                              1.017 (0.761-1.359)
GLP1 vs SU_DPP4 - stroke.2                              1.116 (0.837-1.488)
GLP1 vs SU_DPP4 - stroke.3                              0.911 (0.878-0.944)
GLP1 vs SU_DPP4 - stroke.4                        -0.3972 (-0.4860--0.3084)
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1                   0.872 (0.607-1.254)
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2                   0.874 (0.608-1.256)
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3                   0.998 (0.991-1.006)
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4              -0.0207 (-0.1046-0.0633)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1       0.872 (0.607-1.254)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2       0.874 (0.608-1.256)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3       0.998 (0.991-1.006)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4  -0.0207 (-0.1046-0.0633)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1        0.861 (0.582-1.273)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2        0.859 (0.580-1.270)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3        1.003 (0.993-1.012)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4    0.0240 (-0.0619-0.1099)
SGLT2 vs SU_DPP4 - ADRD.1                               1.137 (0.851-1.520)
SGLT2 vs SU_DPP4 - ADRD.2                               1.140 (0.853-1.523)
SGLT2 vs SU_DPP4 - ADRD.3                               0.998 (0.989-1.006)
SGLT2 vs SU_DPP4 - ADRD.4                          -0.0245 (-0.1082-0.0591)
SGLT2 vs SU_DPP4 - stroke.1                             0.837 (0.632-1.110)
SGLT2 vs SU_DPP4 - stroke.2                             0.841 (0.634-1.114)
SGLT2 vs SU_DPP4 - stroke.3                             0.996 (0.987-1.004)
SGLT2 vs SU_DPP4 - stroke.4                        -0.0505 (-0.1370-0.0360)
                                                  p_value
GLP1 vs SGLT2 - Epilepsy/Seizure.1                 0.0103
GLP1 vs SGLT2 - Epilepsy/Seizure.2                 0.0169
GLP1 vs SGLT2 - Epilepsy/Seizure.3                 0.0159
GLP1 vs SGLT2 - Epilepsy/Seizure.4                 0.0000
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1     0.0103
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2     0.0169
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3     0.0159
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4     0.0000
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1      0.0113
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2      0.0141
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3      0.2484
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4      0.0000
GLP1 vs SGLT2 - ADRD.1                             0.1436
GLP1 vs SGLT2 - ADRD.2                             0.2229
GLP1 vs SGLT2 - ADRD.3                             0.0102
GLP1 vs SGLT2 - ADRD.4                             0.0000
GLP1 vs SGLT2 - stroke.1                           0.1508
GLP1 vs SGLT2 - stroke.2                           0.0790
GLP1 vs SGLT2 - stroke.3                           0.0008
GLP1 vs SGLT2 - stroke.4                           0.0000
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1               0.0004
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2               0.0006
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3               0.1581
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4               0.0000
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1   0.0004
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2   0.0006
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3   0.1581
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4   0.0000
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1    0.0008
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2    0.0009
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3    0.6555
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4    0.0000
GLP1 vs SU_DPP4 - ADRD.1                           0.1405
GLP1 vs SU_DPP4 - ADRD.2                           0.1880
GLP1 vs SU_DPP4 - ADRD.3                           0.1699
GLP1 vs SU_DPP4 - ADRD.4                           0.0000
GLP1 vs SU_DPP4 - stroke.1                         0.9107
GLP1 vs SU_DPP4 - stroke.2                         0.4539
GLP1 vs SU_DPP4 - stroke.3                         0.0000
GLP1 vs SU_DPP4 - stroke.4                         0.0000
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1              0.4604
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2              0.4661
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3              0.6433
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4              0.6295
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1  0.4604
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2  0.4661
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3  0.6433
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4  0.6295
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1   0.4528
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2   0.4450
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3   0.5990
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4   0.5843
SGLT2 vs SU_DPP4 - ADRD.1                          0.3856
SGLT2 vs SU_DPP4 - ADRD.2                          0.3766
SGLT2 vs SU_DPP4 - ADRD.3                          0.5791
SGLT2 vs SU_DPP4 - ADRD.4                          0.5656
SGLT2 vs SU_DPP4 - stroke.1                        0.2165
SGLT2 vs SU_DPP4 - stroke.2                        0.2275
SGLT2 vs SU_DPP4 - stroke.3                        0.3199
SGLT2 vs SU_DPP4 - stroke.4                        0.2528

=== Mediation Results for Epilepsy/Seizure ===
                                            comparison
GLP1 vs SGLT2 - Epilepsy/Seizure.1       GLP1 vs SGLT2
GLP1 vs SGLT2 - Epilepsy/Seizure.2       GLP1 vs SGLT2
GLP1 vs SGLT2 - Epilepsy/Seizure.3       GLP1 vs SGLT2
GLP1 vs SGLT2 - Epilepsy/Seizure.4       GLP1 vs SGLT2
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4   GLP1 vs SU_DPP4
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4 SGLT2 vs SU_DPP4
                                                                                                  effect
GLP1 vs SGLT2 - Epilepsy/Seizure.1    Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SGLT2 - Epilepsy/Seizure.2                                          Direct Effect of Semaglutide
GLP1 vs SGLT2 - Epilepsy/Seizure.3                                     Indirect Effect mediated by HbA1c
GLP1 vs SGLT2 - Epilepsy/Seizure.4                                            A Path (Treatment → HbA1c)
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1  Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2                                        Direct Effect of Semaglutide
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3                                   Indirect Effect mediated by HbA1c
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4                                          A Path (Treatment → HbA1c)
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1 Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2                                       Direct Effect of Semaglutide
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3                                  Indirect Effect mediated by HbA1c
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4                                         A Path (Treatment → HbA1c)
                                               beta_se
GLP1 vs SGLT2 - Epilepsy/Seizure.1    -0.7296 (0.2844)
GLP1 vs SGLT2 - Epilepsy/Seizure.2    -0.6777 (0.2836)
GLP1 vs SGLT2 - Epilepsy/Seizure.3    -0.0519 (0.0215)
GLP1 vs SGLT2 - Epilepsy/Seizure.4    -0.2725 (0.0480)
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1  -0.8343 (0.2339)
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2  -0.8032 (0.2329)
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3  -0.0312 (0.0221)
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4  -0.3684 (0.0446)
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1 -0.1366 (0.1851)
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2 -0.1349 (0.1850)
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3 -0.0018 (0.0038)
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4 -0.0207 (0.0428)
                                                        hr_95ci p_value
GLP1 vs SGLT2 - Epilepsy/Seizure.1          0.482 (0.276-0.842)  0.0103
GLP1 vs SGLT2 - Epilepsy/Seizure.2          0.508 (0.291-0.885)  0.0169
GLP1 vs SGLT2 - Epilepsy/Seizure.3          0.949 (0.910-0.990)  0.0159
GLP1 vs SGLT2 - Epilepsy/Seizure.4    -0.2725 (-0.3665--0.1785)  0.0000
GLP1 vs SU_DPP4 - Epilepsy/Seizure.1        0.434 (0.275-0.687)  0.0004
GLP1 vs SU_DPP4 - Epilepsy/Seizure.2        0.448 (0.284-0.707)  0.0006
GLP1 vs SU_DPP4 - Epilepsy/Seizure.3        0.969 (0.928-1.012)  0.1581
GLP1 vs SU_DPP4 - Epilepsy/Seizure.4  -0.3684 (-0.4558--0.2811)  0.0000
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.1       0.872 (0.607-1.254)  0.4604
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.2       0.874 (0.608-1.256)  0.4661
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.3       0.998 (0.991-1.006)  0.6433
SGLT2 vs SU_DPP4 - Epilepsy/Seizure.4  -0.0207 (-0.1046-0.0633)  0.6295

=== Mediation Results for Early-onset Epilepsy/Seizure ===
                                                        comparison
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1       GLP1 vs SGLT2
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2       GLP1 vs SGLT2
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3       GLP1 vs SGLT2
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4       GLP1 vs SGLT2
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4   GLP1 vs SU_DPP4
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4 SGLT2 vs SU_DPP4
                                                                                                              effect
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1    Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2                                          Direct Effect of Semaglutide
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3                                     Indirect Effect mediated by HbA1c
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4                                            A Path (Treatment → HbA1c)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1  Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2                                        Direct Effect of Semaglutide
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3                                   Indirect Effect mediated by HbA1c
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4                                          A Path (Treatment → HbA1c)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1 Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2                                       Direct Effect of Semaglutide
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3                                  Indirect Effect mediated by HbA1c
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4                                         A Path (Treatment → HbA1c)
                                                           beta_se
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1    -0.7296 (0.2844)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2    -0.6777 (0.2836)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3    -0.0519 (0.0215)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4    -0.2725 (0.0480)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1  -0.8343 (0.2339)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2  -0.8032 (0.2329)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3  -0.0312 (0.0221)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4  -0.3684 (0.0446)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1 -0.1366 (0.1851)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2 -0.1349 (0.1850)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3 -0.0018 (0.0038)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4 -0.0207 (0.0428)
                                                                    hr_95ci
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1          0.482 (0.276-0.842)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2          0.508 (0.291-0.885)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3          0.949 (0.910-0.990)
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4    -0.2725 (-0.3665--0.1785)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1        0.434 (0.275-0.687)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2        0.448 (0.284-0.707)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3        0.969 (0.928-1.012)
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4  -0.3684 (-0.4558--0.2811)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1       0.872 (0.607-1.254)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2       0.874 (0.608-1.256)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3       0.998 (0.991-1.006)
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4  -0.0207 (-0.1046-0.0633)
                                                  p_value
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.1     0.0103
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.2     0.0169
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.3     0.0159
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure.4     0.0000
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1   0.0004
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2   0.0006
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3   0.1581
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4   0.0000
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.1  0.4604
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.2  0.4661
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.3  0.6433
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure.4  0.6295

=== Mediation Results for Late-onset Epilepsy/Seizure ===
                                                       comparison
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1       GLP1 vs SGLT2
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2       GLP1 vs SGLT2
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3       GLP1 vs SGLT2
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4       GLP1 vs SGLT2
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4   GLP1 vs SU_DPP4
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4 SGLT2 vs SU_DPP4
                                                                                                             effect
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1    Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2                                          Direct Effect of Semaglutide
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3                                     Indirect Effect mediated by HbA1c
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4                                            A Path (Treatment → HbA1c)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1  Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2                                        Direct Effect of Semaglutide
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3                                   Indirect Effect mediated by HbA1c
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4                                          A Path (Treatment → HbA1c)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1 Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2                                       Direct Effect of Semaglutide
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3                                  Indirect Effect mediated by HbA1c
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4                                         A Path (Treatment → HbA1c)
                                                          beta_se
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1    -0.7782 (0.3071)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2    -0.7516 (0.3062)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3    -0.0266 (0.0230)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4    -0.2633 (0.0493)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1  -0.8569 (0.2549)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2  -0.8466 (0.2539)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3  -0.0103 (0.0230)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4  -0.3252 (0.0458)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1 -0.1500 (0.1998)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2 -0.1526 (0.1998)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3  0.0025 (0.0048)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4  0.0240 (0.0438)
                                                                   hr_95ci
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1          0.459 (0.252-0.838)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2          0.472 (0.259-0.859)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3          0.974 (0.931-1.019)
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4    -0.2633 (-0.3598--0.1667)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1        0.424 (0.258-0.700)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2        0.429 (0.261-0.705)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3        0.990 (0.946-1.035)
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4  -0.3252 (-0.4150--0.2355)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1       0.861 (0.582-1.273)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2       0.859 (0.580-1.270)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3       1.003 (0.993-1.012)
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4   0.0240 (-0.0619-0.1099)
                                                 p_value
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.1     0.0113
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.2     0.0141
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.3     0.2484
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure.4     0.0000
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1   0.0008
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2   0.0009
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3   0.6555
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4   0.0000
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.1  0.4528
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.2  0.4450
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.3  0.5990
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure.4  0.5843

=== Mediation Results for ADRD ===
                                comparison
GLP1 vs SGLT2 - ADRD.1       GLP1 vs SGLT2
GLP1 vs SGLT2 - ADRD.2       GLP1 vs SGLT2
GLP1 vs SGLT2 - ADRD.3       GLP1 vs SGLT2
GLP1 vs SGLT2 - ADRD.4       GLP1 vs SGLT2
GLP1 vs SU_DPP4 - ADRD.1   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - ADRD.2   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - ADRD.3   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - ADRD.4   GLP1 vs SU_DPP4
SGLT2 vs SU_DPP4 - ADRD.1 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - ADRD.2 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - ADRD.3 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - ADRD.4 SGLT2 vs SU_DPP4
                                                                                      effect
GLP1 vs SGLT2 - ADRD.1    Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SGLT2 - ADRD.2                                          Direct Effect of Semaglutide
GLP1 vs SGLT2 - ADRD.3                                     Indirect Effect mediated by HbA1c
GLP1 vs SGLT2 - ADRD.4                                            A Path (Treatment → HbA1c)
GLP1 vs SU_DPP4 - ADRD.1  Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SU_DPP4 - ADRD.2                                        Direct Effect of Semaglutide
GLP1 vs SU_DPP4 - ADRD.3                                   Indirect Effect mediated by HbA1c
GLP1 vs SU_DPP4 - ADRD.4                                          A Path (Treatment → HbA1c)
SGLT2 vs SU_DPP4 - ADRD.1 Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
SGLT2 vs SU_DPP4 - ADRD.2                                       Direct Effect of Semaglutide
SGLT2 vs SU_DPP4 - ADRD.3                                  Indirect Effect mediated by HbA1c
SGLT2 vs SU_DPP4 - ADRD.4                                         A Path (Treatment → HbA1c)
                                   beta_se                   hr_95ci p_value
GLP1 vs SGLT2 - ADRD.1    -0.2881 (0.1970)       0.750 (0.510-1.103)  0.1436
GLP1 vs SGLT2 - ADRD.2    -0.2390 (0.1961)       0.787 (0.536-1.156)  0.2229
GLP1 vs SGLT2 - ADRD.3    -0.0491 (0.0191)       0.952 (0.917-0.988)  0.0102
GLP1 vs SGLT2 - ADRD.4    -0.2870 (0.0475) -0.2870 (-0.3801--0.1938)  0.0000
GLP1 vs SU_DPP4 - ADRD.1  -0.2555 (0.1734)       0.775 (0.551-1.088)  0.1405
GLP1 vs SU_DPP4 - ADRD.2  -0.2265 (0.1721)       0.797 (0.569-1.117)  0.1880
GLP1 vs SU_DPP4 - ADRD.3  -0.0290 (0.0211)       0.971 (0.932-1.013)  0.1699
GLP1 vs SU_DPP4 - ADRD.4  -0.3779 (0.0441) -0.3779 (-0.4642--0.2915)  0.0000
SGLT2 vs SU_DPP4 - ADRD.1  0.1284 (0.1480)       1.137 (0.851-1.520)  0.3856
SGLT2 vs SU_DPP4 - ADRD.2  0.1308 (0.1479)       1.140 (0.853-1.523)  0.3766
SGLT2 vs SU_DPP4 - ADRD.3 -0.0024 (0.0043)       0.998 (0.989-1.006)  0.5791
SGLT2 vs SU_DPP4 - ADRD.4 -0.0245 (0.0427)  -0.0245 (-0.1082-0.0591)  0.5656

=== Mediation Results for stroke ===
                                  comparison
GLP1 vs SGLT2 - stroke.1       GLP1 vs SGLT2
GLP1 vs SGLT2 - stroke.2       GLP1 vs SGLT2
GLP1 vs SGLT2 - stroke.3       GLP1 vs SGLT2
GLP1 vs SGLT2 - stroke.4       GLP1 vs SGLT2
GLP1 vs SU_DPP4 - stroke.1   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - stroke.2   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - stroke.3   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - stroke.4   GLP1 vs SU_DPP4
SGLT2 vs SU_DPP4 - stroke.1 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - stroke.2 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - stroke.3 SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - stroke.4 SGLT2 vs SU_DPP4
                                                                                        effect
GLP1 vs SGLT2 - stroke.1    Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SGLT2 - stroke.2                                          Direct Effect of Semaglutide
GLP1 vs SGLT2 - stroke.3                                     Indirect Effect mediated by HbA1c
GLP1 vs SGLT2 - stroke.4                                            A Path (Treatment → HbA1c)
GLP1 vs SU_DPP4 - stroke.1  Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
GLP1 vs SU_DPP4 - stroke.2                                        Direct Effect of Semaglutide
GLP1 vs SU_DPP4 - stroke.3                                   Indirect Effect mediated by HbA1c
GLP1 vs SU_DPP4 - stroke.4                                          A Path (Treatment → HbA1c)
SGLT2 vs SU_DPP4 - stroke.1 Total Effect of Semaglutide for Prevention of Adult-Onset Epilepsy
SGLT2 vs SU_DPP4 - stroke.2                                       Direct Effect of Semaglutide
SGLT2 vs SU_DPP4 - stroke.3                                  Indirect Effect mediated by HbA1c
SGLT2 vs SU_DPP4 - stroke.4                                         A Path (Treatment → HbA1c)
                                     beta_se                   hr_95ci p_value
GLP1 vs SGLT2 - stroke.1     0.2581 (0.1797)       1.294 (0.910-1.841)  0.1508
GLP1 vs SGLT2 - stroke.2     0.3142 (0.1789)       1.369 (0.964-1.944)  0.0790
GLP1 vs SGLT2 - stroke.3    -0.0561 (0.0168)       0.945 (0.915-0.977)  0.0008
GLP1 vs SGLT2 - stroke.4    -0.2612 (0.0493) -0.2612 (-0.3578--0.1646)  0.0000
GLP1 vs SU_DPP4 - stroke.1   0.0166 (0.1479)       1.017 (0.761-1.359)  0.9107
GLP1 vs SU_DPP4 - stroke.2   0.1099 (0.1468)       1.116 (0.837-1.488)  0.4539
GLP1 vs SU_DPP4 - stroke.3  -0.0933 (0.0185)       0.911 (0.878-0.944)  0.0000
GLP1 vs SU_DPP4 - stroke.4  -0.3972 (0.0453) -0.3972 (-0.4860--0.3084)  0.0000
SGLT2 vs SU_DPP4 - stroke.1 -0.1777 (0.1438)       0.837 (0.632-1.110)  0.2165
SGLT2 vs SU_DPP4 - stroke.2 -0.1735 (0.1437)       0.841 (0.634-1.114)  0.2275
SGLT2 vs SU_DPP4 - stroke.3 -0.0042 (0.0043)       0.996 (0.987-1.004)  0.3199
SGLT2 vs SU_DPP4 - stroke.4 -0.0505 (0.0441)  -0.0505 (-0.1370-0.0360)  0.2528

=== Generating Summary Patient Flow Tables ===

Patient Flow Summary Table:
                                                      comparison
GLP1 vs SGLT2 - Epilepsy/Seizure                   GLP1 vs SGLT2
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure       GLP1 vs SGLT2
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure        GLP1 vs SGLT2
GLP1 vs SGLT2 - ADRD                               GLP1 vs SGLT2
GLP1 vs SGLT2 - stroke                             GLP1 vs SGLT2
GLP1 vs SU_DPP4 - Epilepsy/Seizure               GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure   GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure    GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - ADRD                           GLP1 vs SU_DPP4
GLP1 vs SU_DPP4 - stroke                         GLP1 vs SU_DPP4
SGLT2 vs SU_DPP4 - Epilepsy/Seizure             SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure  SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - ADRD                         SGLT2 vs SU_DPP4
SGLT2 vs SU_DPP4 - stroke                       SGLT2 vs SU_DPP4
                                                                     outcome
GLP1 vs SGLT2 - Epilepsy/Seizure                            Epilepsy/Seizure
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure    Early-onset Epilepsy/Seizure
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure      Late-onset Epilepsy/Seizure
GLP1 vs SGLT2 - ADRD                                                    ADRD
GLP1 vs SGLT2 - stroke                                                stroke
GLP1 vs SU_DPP4 - Epilepsy/Seizure                          Epilepsy/Seizure
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure  Early-onset Epilepsy/Seizure
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure    Late-onset Epilepsy/Seizure
GLP1 vs SU_DPP4 - ADRD                                                  ADRD
GLP1 vs SU_DPP4 - stroke                                              stroke
SGLT2 vs SU_DPP4 - Epilepsy/Seizure                         Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure Early-onset Epilepsy/Seizure
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure   Late-onset Epilepsy/Seizure
SGLT2 vs SU_DPP4 - ADRD                                                 ADRD
SGLT2 vs SU_DPP4 - stroke                                             stroke
                                                initial_dm excluded_preexisting
GLP1 vs SGLT2 - Epilepsy/Seizure                      7034                    0
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure          7034                    0
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure           7034                    0
GLP1 vs SGLT2 - ADRD                                  7034                    0
GLP1 vs SGLT2 - stroke                                7034                    0
GLP1 vs SU_DPP4 - Epilepsy/Seizure                    9746                    0
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure        9746                    0
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure         9746                    0
GLP1 vs SU_DPP4 - ADRD                                9746                    0
GLP1 vs SU_DPP4 - stroke                              9746                    0
SGLT2 vs SU_DPP4 - Epilepsy/Seizure                  10384                    0
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure      10384                    0
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure       10384                    0
SGLT2 vs SU_DPP4 - ADRD                              10384                    0
SGLT2 vs SU_DPP4 - stroke                            10384                    0
                                                after_preexisting
GLP1 vs SGLT2 - Epilepsy/Seizure                                0
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure                    0
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure                     0
GLP1 vs SGLT2 - ADRD                                            0
GLP1 vs SGLT2 - stroke                                          0
GLP1 vs SU_DPP4 - Epilepsy/Seizure                              0
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure                  0
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure                   0
GLP1 vs SU_DPP4 - ADRD                                          0
GLP1 vs SU_DPP4 - stroke                                        0
SGLT2 vs SU_DPP4 - Epilepsy/Seizure                             0
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure                 0
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure                  0
SGLT2 vs SU_DPP4 - ADRD                                         0
SGLT2 vs SU_DPP4 - stroke                                       0
                                                excluded_followup
GLP1 vs SGLT2 - Epilepsy/Seizure                              817
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure                  817
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure                   817
GLP1 vs SGLT2 - ADRD                                          842
GLP1 vs SGLT2 - stroke                                        789
GLP1 vs SU_DPP4 - Epilepsy/Seizure                           1056
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure               1056
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure                1056
GLP1 vs SU_DPP4 - ADRD                                       1094
GLP1 vs SU_DPP4 - stroke                                     1030
SGLT2 vs SU_DPP4 - Epilepsy/Seizure                          1208
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure              1208
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure               1208
SGLT2 vs SU_DPP4 - ADRD                                      1253
SGLT2 vs SU_DPP4 - stroke                                    1173
                                                after_followup excluded_age
GLP1 vs SGLT2 - Epilepsy/Seizure                          5839            0
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure              5839            0
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure               5839          657
GLP1 vs SGLT2 - ADRD                                      5950            0
GLP1 vs SGLT2 - stroke                                    5577            0
GLP1 vs SU_DPP4 - Epilepsy/Seizure                        8216            0
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure            8216            0
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure             8216          939
GLP1 vs SU_DPP4 - ADRD                                    8389            0
GLP1 vs SU_DPP4 - stroke                                  7969            0
SGLT2 vs SU_DPP4 - Epilepsy/Seizure                       8615            0
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure           8615            0
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure            8615          894
SGLT2 vs SU_DPP4 - ADRD                                   8816            0
SGLT2 vs SU_DPP4 - stroke                                 8312            0
                                                final_cohort total_events
GLP1 vs SGLT2 - Epilepsy/Seizure                        5375           89
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure            5375           13
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure             4718           75
GLP1 vs SGLT2 - ADRD                                    5478          158
GLP1 vs SGLT2 - stroke                                  5121          171
GLP1 vs SU_DPP4 - Epilepsy/Seizure                      7326          160
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure          7326           23
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure           6387          135
GLP1 vs SU_DPP4 - ADRD                                  7487          229
GLP1 vs SU_DPP4 - stroke                                7082          296
SGLT2 vs SU_DPP4 - Epilepsy/Seizure                     7717          165
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure         7717           20
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure          6823          142
SGLT2 vs SU_DPP4 - ADRD                                 7909          275
SGLT2 vs SU_DPP4 - stroke                               7426          316
                                                event_rate
GLP1 vs SGLT2 - Epilepsy/Seizure                      1.66
GLP1 vs SGLT2 - Early-onset Epilepsy/Seizure          0.24
GLP1 vs SGLT2 - Late-onset Epilepsy/Seizure           1.59
GLP1 vs SGLT2 - ADRD                                  2.88
GLP1 vs SGLT2 - stroke                                3.34
GLP1 vs SU_DPP4 - Epilepsy/Seizure                    2.18
GLP1 vs SU_DPP4 - Early-onset Epilepsy/Seizure        0.31
GLP1 vs SU_DPP4 - Late-onset Epilepsy/Seizure         2.11
GLP1 vs SU_DPP4 - ADRD                                3.06
GLP1 vs SU_DPP4 - stroke                              4.18
SGLT2 vs SU_DPP4 - Epilepsy/Seizure                   2.14
SGLT2 vs SU_DPP4 - Early-onset Epilepsy/Seizure       0.26
SGLT2 vs SU_DPP4 - Late-onset Epilepsy/Seizure        2.08
SGLT2 vs SU_DPP4 - ADRD                               3.48
SGLT2 vs SU_DPP4 - stroke                             4.26

==== IPWT 분석 결과 요약 ====
   method       comparison                      outcome effect_measure
1    IPWT    GLP1 vs SGLT2             Epilepsy/Seizure   Hazard Ratio
2    IPWT    GLP1 vs SGLT2 Early-onset Epilepsy/Seizure   Hazard Ratio
3    IPWT    GLP1 vs SGLT2  Late-onset Epilepsy/Seizure   Hazard Ratio
4    IPWT    GLP1 vs SGLT2                         ADRD   Hazard Ratio
5    IPWT    GLP1 vs SGLT2                       stroke   Hazard Ratio
6    IPWT  GLP1 vs SU_DPP4             Epilepsy/Seizure   Hazard Ratio
7    IPWT  GLP1 vs SU_DPP4 Early-onset Epilepsy/Seizure   Hazard Ratio
8    IPWT  GLP1 vs SU_DPP4  Late-onset Epilepsy/Seizure   Hazard Ratio
9    IPWT  GLP1 vs SU_DPP4                         ADRD   Hazard Ratio
10   IPWT  GLP1 vs SU_DPP4                       stroke   Hazard Ratio
11   IPWT SGLT2 vs SU_DPP4             Epilepsy/Seizure   Hazard Ratio
12   IPWT SGLT2 vs SU_DPP4 Early-onset Epilepsy/Seizure   Hazard Ratio
13   IPWT SGLT2 vs SU_DPP4  Late-onset Epilepsy/Seizure   Hazard Ratio
14   IPWT SGLT2 vs SU_DPP4                         ADRD   Hazard Ratio
15   IPWT SGLT2 vs SU_DPP4                       stroke   Hazard Ratio
    estimate  lower_ci  upper_ci      p_value n_total n_events
1  0.4473393 0.2345978 0.8530020 0.0145752180    5375       89
2  0.6100855 0.1614334 2.3056219 0.4663154979    5375       13
3  0.4175681 0.1989981 0.8762050 0.0209188527    4718       75
4  0.7235464 0.4638684 1.1285949 0.1536881260    5478      158
5  1.0895135 0.7460914 1.5910110 0.6572055577    5121      171
6  0.5070169 0.3123436 0.8230235 0.0059965059    7326      160
7  1.2357587 0.4250563 3.5926995 0.6974514932    7326       23
8  0.3991677 0.2350791 0.6777924 0.0006747098    6387      135
9  0.5995887 0.3993183 0.9003008 0.0136489050    7487      229
10 0.7847123 0.5397496 1.1408500 0.2041597832    7082      296
11 0.7465020 0.5269274 1.0575750 0.0999714229    7717      165
12 0.9321133 0.3400399 2.5550977 0.8913148395    7717       20
13 0.7234902 0.4995071 1.0479092 0.0868261894    6823      142
14 0.8194378 0.6354726 1.0566597 0.1247567570    7909      275
15 0.6867245 0.5344385 0.8824038 0.0033036872    7426      316

주의: Stroke 결과가 없습니다. outcomes 리스트에 Stroke가 포함되어 있는지 확인하세요.

